[["index.html", "Diari de les Classes de Mètodes Estadístics Aplicats (21703). Curs 2021-2022 Introducció", " Diari de les Classes de Mètodes Estadístics Aplicats (21703). Curs 2021-2022 Ferran Carrascosa Mallafrè 2022-01-12 Introducció Aquesta web té com a objectiu donar suport als continguts de les clases de teoría y seminaris del curs 2021-2022 de Mètodes Estadístics Aplicats (21703). Els continguts de la web sestructuren de la següent forma: Diari dapunts de clase de teoria Diari dapunts dels seminaris Deures del curs "],["teoria-setmana-1.html", "Capítol 1 Teoria Setmana 1 1.1 Avaluació 1.2 Bibliografia 1.3 Introducció conceptes Estadística 1.4 Gender gap, at birth 1.5 With Arbuthnotts data, collected on years 1629 to 1710 1.6 Distribució duna variable, distribució normal, altres distribucions", " Capítol 1 Teoria Setmana 1 Discussió sobre: Logística del curs: Teoria i seminaris: Horaris Canals: Aula global, Web de curs El PDA Avaluació: Participació seminaris (15%), Treball (35%), Examen Final (50%) Disseny del curs: Conceptes, dades, programari Eina de treball: R 1.1 Avaluació 1.1.1 El treball Consulta la Guía del Treball de fi de curs. Consulta a lAula global els Exemples de treballs danys anteriors. 1.1.2 Exàmens Consulta a lAula global els Exàmens danys anteriors. 1.1.3 Participació A laula dinformàtica es resoldran deures a classe. A la secció de la Llista de deures 14, es publicaràn fins a 3 problemes que shauràn dentregar de forma individual i es resoldrà a classe. 1.2 Bibliografia Mètodes aplicats a Ciències polítiques AnalizaR Datos Políticos. Bookdown. 2020. Quantitative Politics with R. Bookdown. November 2019. Lab Guide to Quantitative Research Methods in Political Science, Public Policy &amp; Public Administration. Bookdown Quantitative Research Methods for Political Science, Public Policy and Public Administration: 4th Edition With Applications in R. Bookdown General R y Estadística R Markdown: The Definitive Guide. Chapman &amp; Hall/CRC; 2020. R Graphics Cookbook, OReilly Media, Inc. 2nd ed.; 2020. Data Visualization with R. 2018. R for Data Science. OReilly; 2017. (Castellano) An Introduction to Statistical Learning with applications in R. Springer; 2017. 1.3 Introducció conceptes Estadística Introducció a lassignatura. Llibres, la nostra calculadora de butxaca. Interacció entre Teoria (preguntes), Dades, Estadística (conceptes, no fórmules). Un exemple, per començar a rodar. 1.4 Gender gap, at birth Question: Is there a gender birth rate?. At birth, probability of a boy equal to the probability of a girl? What CIA says on this issue? (Wikipedia) CIA estimates that the current world wide sex ratio at birth is 107 boys to 100 girls, 107/207= 0.5169082 1.5 With Arbuthnotts data, collected on years 1629 to 1710 John Graunt was the first person to compile data that showed an excess of male births over female births. He also noticed spatial and temporal variation in the sex ratio, but the variation in his data is not significant. John Arbuthnott was the first person to demonstrate that the excess of male births is statistically significant. John Arbuthnot (1710) used these time series data on the ratios of male to female christenings in London from 1629-1710 to carry out the first known significance test, comparing observed data to a null hypothesis. Arbuthnot, J. 1710. An argument for divine providence. Philosophical Transactions 27:186-190. dat&lt;- read.table(&quot;http://84.89.132.1/~satorra/dades/arbuthnot.txt&quot;, header=TRUE) head(dat) ## year boys girls ## 1 1629 5218 4683 ## 2 1630 4858 4457 ## 3 1631 4422 4102 ## 4 1632 4994 4590 ## 5 1633 5158 4839 ## 6 1634 5035 4820 dim(dat) ## [1] 82 3 names(dat) ## [1] &quot;year&quot; &quot;boys&quot; &quot;girls&quot; attach(dat) mean(boys) ## [1] 5907.098 mean(girls) ## [1] 5534.646 mean(boys/girls) ## [1] 1.070748 total&lt;- boys+girls plot(year,total, col=&quot;blue&quot;, main=&quot;total birth along the years&quot;) mean(boys/(boys+girls)) ## [1] 0.5169751 require(stats) # for lowess, rpois, rnorm lines(year,lowess(total,f=1/6)$y, lty=3, lwd=4) boxplot(boys, girls, names=c(&quot;boys&quot;,&quot;girls&quot;), col=c(&quot;blue&quot;,&quot;magenta&quot;)) boysrate&lt;- boys/(boys+girls) plot(year, boysrate, ylim = c(.49,.53), col=&quot;blue&quot;) abline(h=0.5, col=&quot;red&quot;, lwd=3, lty=3) t&lt;- (mean(boysrate) - 0.5)/(sd(boysrate)/sqrt(length(boysrate))) t ## [1] 21.29243 t.test(boysrate, mu=0.5) ## ## One Sample t-test ## ## data: boysrate ## t = 21.292, df = 81, p-value &lt; 2.2e-16 ## alternative hypothesis: true mean is not equal to 0.5 ## 95 percent confidence interval: ## 0.5153889 0.5185614 ## sample estimates: ## mean of x ## 0.5169751 plot(year, boysrate, ylim = c(.49,.53), col=&quot;blue&quot;, main=&quot;Boysrate values with 95% confidence bound (green lines) &quot;) abline(h=0.5, col=&quot;red&quot;, lwd=3, lty=3) # Intervals abline(h=mean(boysrate), col=&quot;blue&quot;, lwd=.8) lines(year, rep(0.5153889, length(year)) , lty = &#39;dashed&#39;, col = &#39;green&#39;, lwd=3) lines(year, rep(0.5186, length(year)) , lty = &#39;dashed&#39;, col = &#39;green&#39;, lwd=3) # add fill n&lt;- length(year) polygon(c(rev(year), year), c( rev(rep(0.5153889, n )), rep(0.5186, n )), border = NA) 1.5.1 Now with recent USAs data, present day birth records in the United States source(&quot;http://www.openintro.org/stat/data/present.R&quot;) head(present) ## year boys girls ## 1 1940 1211684 1148715 ## 2 1941 1289734 1223693 ## 3 1942 1444365 1364631 ## 4 1943 1508959 1427901 ## 5 1944 1435301 1359499 ## 6 1945 1404587 1330869 dim(present) ## [1] 63 3 mean(present$boys/(present$boys+present$girls)) ## [1] 0.512516 boysrate&lt;- present$boys/(present$boys+present$girls) t.test(boysrate, mu=0.5) ## ## One Sample t-test ## ## data: boysrate ## t = 147, df = 62, p-value &lt; 2.2e-16 ## alternative hypothesis: true mean is not equal to 0.5 ## 95 percent confidence interval: ## 0.5123458 0.5126862 ## sample estimates: ## mean of x ## 0.512516 1.6 Distribució duna variable, distribució normal, altres distribucions Distribució duna variable quantitativa (variable numérica): anàlisi de variància. library(foreign) data= read.spss( &quot;http://84.89.132.1/~satorra/dades/PAISOS.SAV&quot;, use.value.labels = TRUE, to.data.frame = TRUE ) attach(data) names(data) ## [1] &quot;IDH&quot; &quot;NIVELL&quot; &quot;PAIS&quot; &quot;ESPVIDA&quot; &quot;PIB&quot; &quot;ALFAB&quot; &quot;CONT&quot; &quot;CALORIES&quot; &quot;HABMETG&quot; &quot;DIARIS&quot; &quot;TV&quot; ## [12] &quot;SANITAT&quot; &quot;AGRICULT&quot; &quot;INDUST&quot; ESPVIDA ## [1] 46.4 52.1 47.5 39.0 50.7 53.5 44.9 50.2 55.6 43.5 47.5 56.5 45.6 47.3 51.0 46.5 60.4 46.0 47.4 65.2 50.4 55.7 48.0 66.7 48.9 ## [26] 45.0 65.5 55.0 47.6 49.4 61.5 56.0 68.5 44.5 56.0 51.5 71.9 67.7 53.7 60.5 63.6 51.0 62.7 62.1 70.4 59.4 49.3 66.3 56.0 64.7 ## [51] 67.6 55.8 64.8 63.3 69.6 57.5 68.8 51.3 67.9 69.9 66.4 65.2 70.3 69.3 66.0 73.6 71.2 70.0 58.8 67.8 69.0 67.1 71.1 76.3 66.5 ## [76] 70.9 70.0 71.5 67.5 71.5 73.6 64.9 72.8 76.0 71.3 73.8 70.2 66.3 67.6 62.9 70.8 70.5 71.7 69.0 72.5 70.8 71.6 67.5 53.5 70.0 ## [101] 72.0 72.1 75.6 69.6 71.1 77.6 74.6 69.7 71.6 77.0 73.1 75.5 75.3 76.5 77.6 78.6 70.5 74.8 77.6 76.2 74.9 77.5 77.4 77.4 76.4 ## [126] 76.9 73.8 75.7 76.2 76.0 76.0 78.2 76.9 75.3 78.2 79.5 75.7 78.0 72.0 76.1 68.5 66.0 63.1 67.1 75.3 63.7 71.1 43.5 50.2 65.2 ## [151] 56.6 57.6 52.0 53.0 46.5 51.6 55.4 47.0 74.2 48.3 summary(ESPVIDA) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 39.00 55.67 67.60 64.50 72.58 79.50 hist(ESPVIDA, col=&quot;blue&quot;) boxplot(ESPVIDA, col=&quot;blue&quot;) 1.6.1 Valor estandarditzat duna variable # variable centrads head(ESPVIDA - mean(ESPVIDA)) ## [1] -18.10437 -12.40437 -17.00437 -25.50437 -13.80437 -11.00437 # variable estandarditzada head((ESPVIDA - mean(ESPVIDA))/sd(ESPVIDA)) ## [1] -1.715521 -1.175405 -1.611288 -2.416725 -1.308065 -1.042744 # Amb R head(scale(ESPVIDA)) ## [,1] ## [1,] -1.715521 ## [2,] -1.175405 ## [3,] -1.611288 ## [4,] -2.416725 ## [5,] -1.308065 ## [6,] -1.042744 1.6.2 Distribució Normal We now investigate the probability distribution that is most central to statistics: the normal distribution. If we are confident that our data are nearly normal, that opens the door to many powerful statistical methods. Here well describe this distribution and assess the normality of our data. Bitllet de 10 marcs: Carl Friedrich Gauss (1777 - Gotinga;1855) 1.6.2.1 Distribució de notes destudiants Veure exemple enllaç. 1.6.3 Exemple amb la variable diners en butxaca (estudiants de MQ III) Dades_enq_paper (diners en butxaca, genere): datadiners&lt;-read.table(&quot;http://84.89.132.1/~satorra/dades/ECP2019diners.txt&quot;, header=TRUE) names(datadiners) ## [1] &quot;diners&quot; &quot;genere&quot; attach(datadiners) summary(diners) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 0.000 1.000 7.995 16.249 21.625 100.000 boxplot(diners) hist(diners) boxplot(diners ~ genere, col=c(&quot;blue&quot;,&quot;violet&quot;)) aggregate(diners, list(genere), mean) ## Group.1 x ## 1 0 18.30667 ## 2 1 13.30833 Diners en butxaca: distribució normal? qqnorm(datadiners$diners) qqline(datadiners$diners ,col=&quot;red&quot;, lwd=3) 1.6.3.1 Log de diners en butxaca: distribució normal? qqnorm(log(datadiners$diners+ .1)) qqline(log(datadiners$diners +.1),col=&quot;red&quot;, lwd=3) 1.6.3.2 log de diners en butxaca (no zero): distribució normal? ind&lt;- datadiners$diners &gt; 0 qqnorm(log(datadiners$diners[ind])) qqline(log(datadiners$diners[ind]),col=&quot;red&quot;, lwd=3) 1.6.4 Altres distribucions univariants Distribucions univariants en R 1.6.4.1 Variables quantitatives i qualitatives Dades Enquesta Socrative d&lt;-matrix(scan(&quot;http://84.89.132.1/~satorra/dades/ECP2019enquestasocrativeG1.txt&quot;, what=&quot;character&quot;,skip=1),ncol=20,byrow=TRUE); data&lt;-d[-1,]; colnames(data)&lt;-d[1,]; table(data[,4]); ## ## av cd mai ## 12 13 7 round(100*prop.table(table(data[,4], data[,1]),2),1); ## ## 0 1 ## av 42.1 30.8 ## cd 36.8 46.2 ## mai 21.1 23.1 pie(table(data[,4]), main=&quot;fer-se el llit&quot;) ## interess assignatura aggregate(as.numeric(data[,7]), list(data[,4]), mean) ## Group.1 x ## 1 av 6.625000 ## 2 cd 5.923077 ## 3 mai 4.571429 ## tirada de dues monedes table(data[,14]) ## ## 0 1 2 3 ## 2 11 15 4 round(prop.table(table(data[,14])),2) ## ## 0 1 2 3 ## 0.06 0.34 0.47 0.12 "],["teoria-setmana-2.html", "Capítol 2 Teoria Setmana 2 2.1 Data Wrangling 2.2 Visualización 2.3 Modelar: Regressió simple", " Capítol 2 Teoria Setmana 2 2.1 Data Wrangling Per modelar conceptes estadístics, cal domar abans les dades (data wrangling). Aquest procés té 3 parts principals. Data Wrangling. Font: G.Glolemun y H.Wickham, 2017 2.1.1 Els data frames 2.1.1.1 Gapminder Per comprendre levolució de la riquesa i lesperança de vida de les persones a nivell de país i continent calen dades. Our mission is to fight devastating ignorance with a fact-based worldview everyone can understand.  Gapminder Hans Rosling de Gapminder feb.2006, va popularitzar Trendalyzer, en una famosa conferencia TED Talk (14,6M de visualitzacions). Trendalyzer, posteriorment adquirida por Google, permetia visualitzar fins a 5 dimensions. Actualment esta disponible en el següent enllaç. library(gapminder) library(knitr) class(gapminder) ## [1] &quot;tbl_df&quot; &quot;tbl&quot; &quot;data.frame&quot; head(gapminder) ## # A tibble: 6 x 6 ## country continent year lifeExp pop gdpPercap ## &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; ## 1 Afghanistan Asia 1952 28.8 8425333 779. ## 2 Afghanistan Asia 1957 30.3 9240934 821. ## 3 Afghanistan Asia 1962 32.0 10267083 853. ## 4 Afghanistan Asia 1967 34.0 11537966 836. ## 5 Afghanistan Asia 1972 36.1 13079460 740. ## 6 Afghanistan Asia 1977 38.4 14880372 786. dim(gapminder) ## [1] 1704 6 2.1.2 Importació de dades 2.1.2.1 Dades amb separador cat(paste0(readLines(&quot;www/data/mtcars.csv&quot;, n = 6), collapse=&quot;\\n&quot;)) ## &quot;mpg&quot;,&quot;cyl&quot;,&quot;disp&quot;,&quot;hp&quot;,&quot;drat&quot;,&quot;wt&quot;,&quot;qsec&quot;,&quot;vs&quot;,&quot;am&quot;,&quot;gear&quot;,&quot;carb&quot; ## 21,6,160,110,3.9,2.62,16.46,0,1,4,4 ## 21,6,160,110,3.9,2.875,17.02,0,1,4,4 ## 22.8,4,108,93,3.85,2.32,18.61,1,1,4,1 ## 21.4,6,258,110,3.08,3.215,19.44,1,0,3,1 ## 18.7,8,360,175,3.15,3.44,17.02,0,0,3,2 mtcars &lt;- read.table(&quot;www/data/mtcars.csv&quot;, dec=&quot;.&quot;,sep=&quot;,&quot;, header=TRUE) Los parámetros especificados son: dec: El separador decimal. En Europa se acostumbra a utilizar la coma , sep: El separador de columnas. Es habitual usar también ; y  cuando es un tabulador. header: Indica si la primera fila contiene el nombre de las variables o no. En el caso de mtcars (separador por comas) es más simple usar read.csv. mtcars &lt;- read.csv(&quot;www/data/mtcars.csv&quot;) dim(mtcars) ## [1] 32 11 Cuando el csv es europeo, , decimal y ; como separador, se utiliza read.csv2(). kable(head(mtcars)) mpg cyl disp hp drat wt qsec vs am gear carb 21.0 6 160 110 3.90 2.620 16.46 0 1 4 4 21.0 6 160 110 3.90 2.875 17.02 0 1 4 4 22.8 4 108 93 3.85 2.320 18.61 1 1 4 1 21.4 6 258 110 3.08 3.215 19.44 1 0 3 1 18.7 8 360 175 3.15 3.440 17.02 0 0 3 2 18.1 6 225 105 2.76 3.460 20.22 1 0 3 1 2.1.2.2 Texto con ancho fijo cat(paste0(readLines(&quot;www/data/fwf-sample.txt&quot;, n = 6), collapse=&quot;\\n&quot;)) ## John Smith WA 418-Y11-4111 ## Mary Hartford CA 319-Z19-4341 ## Evan Nolan IL 219-532-c301 Para leer texto de ancho fijo, se utiliza read.fwf(). fwf_sample &lt;- read.fwf(&quot;www/data/fwf-sample.txt&quot;, widths=c(20,10,12) , col.names=c(&quot;name&quot;, &quot;state&quot;, &quot;ssn&quot;)) widths: Son los anchos de cada variable. col.names: Nombres de las variables. 2.1.2.3 Leer Excel library(readxl) dataXlsx &lt;- read_excel(&quot;www/data/data.xlsx&quot;) dim(dataXlsx) ## [1] 19 6 2.1.2.4 Leer SPSS library(foreign) dataSAV &lt;- read.spss(&quot;http://psych.colorado.edu/~carey/Courses/PSYC7291/DataSets/SPSS/crime.sav&quot;, to.data.frame =TRUE, use.value.labels = TRUE) dim(dataSAV) ## [1] 50 8 2.1.2.5 Leer RData Leer objetos de R. load(&quot;www/data/rStateDataSold.RData&quot;) dim(rStateDataSold) ## [1] 192 8 2.1.2.6 Guardar RData Guardar varios objetos de R. save(dataXlsx, dataSAV, rStateDataSold, file=&quot;www/temp/EjemploSave2.RData&quot;) 2.1.3 Dades ordenades Datos ordenados es un conjunto de datos que ha sido estructurado de forma que cada variable es una columna y cada observación (o caso) es una fila. - H. Wickham 2013. Journal of Statistical Software Para resaltar la importancia de esta etapa, G.Glolemun y H.Wickham, 2017 utilizan las siguiente cita y su posterior adaptación. Todas las familias felices se parecen unas a otras, pero cada familia infeliz lo es a su manera.  León Tolstoy Todos los set de datos ordenados se parecen unos a otros, pero cada set de datos desordenado lo es a su manera  Hadley Wickham En la misma referencia, se explica tres reglas que hacen que un conjunto de datos sea ordenado: Cada variable debe tener su propia columna. Cada observación debe tener su propia fila. Cada valor debe tener su propia celda. También se utiliza la siguiente figura para visualizar mejor estas reglas. Imagen: Reglas que hacen que un conjunto de datos sea ordenado: las variables están en columnas, las observaciones en filas y los valores en celdas. (Fuente: G.Glolemun y H.Wickham, 2017 Com puedes ver, la definición de tidy data, equipara las columnas de la tabla con el concepto de Variable, así como las filas a observaciones, hecho que simplifica enormemente las posteriores fases de analisis de la información. 2.1.4 Transformació El universo de Tydiverse consiste en una colección de packages de R orientados al Data Science. Se recomienda la consulta del libro online R para Ciencia de Datos. El package dplyr, al igual que ggplot2, está desarrollado por Hadley Wickham. Este paquete, supone un cambio de filosofía en la forma de trabajar con los datos y se está transformando en un nuevo estándar en R. 2.1.4.1 Dplyr: arrange, filter, select arange: Ordena los registros de un data frame. filter: Filtra a partir de un conjunto condiciones lógicas. select: Selecciona las variables. Países asiáticos con PIB per cápita inferior a 1000 $ en 2007. suppressPackageStartupMessages(library(tidyverse)) pais07Sel &lt;- gapminder %&gt;% arrange(desc(lifeExp)) %&gt;% filter(continent==&#39;Asia&#39; &amp; gdpPercap &lt; 1000 &amp; year ==2007 ) %&gt;% dplyr::select(country,lifeExp,gdpPercap) kable(pais07Sel) country lifeExp gdpPercap Myanmar 62.069 944.0000 Afghanistan 43.828 974.5803 Observa que no necesitan de comillas para referirse a las variables. También utilizan el operador %&gt;% llamado pipe. Éste sustituye el parámetro de entrada de datos. De esta forma, permite escribir las operaciones de izquierda a derecha facilitando así su lectura. 2.1.4.2 Dplyr: mutate, group_by, summarise mutate: Crea o modifica las variables del data frame. group_by: Especifica una o varias variables de agrupación. summarise: define los agregados de las variables originales. Esperanza de vida y PIB per cápita medio por continente y año. continent_year &lt;- gapminder %&gt;% arrange(continent,year) %&gt;% mutate(lifeExp_total = lifeExp * pop , gdp_total = gdpPercap * pop) %&gt;% group_by(continent,year) %&gt;% dplyr::summarize(n_countries=n() , lifeExp = sum(lifeExp_total ) / sum(pop ) , gdp_capita = sum(gdp_total) / sum(pop) , pop = sum(pop)) kable(continent_year %&gt;% head(10)) continent year n_countries lifeExp gdp_capita pop Africa 1952 52 38.79973 1311.221 237640501 Africa 1957 52 40.94031 1444.952 264837738 Africa 1962 52 43.09925 1540.599 296516865 Africa 1967 52 45.17721 1774.847 335289489 Africa 1972 52 47.21229 2063.171 379879541 Africa 1977 52 49.20883 2244.799 433061021 Africa 1982 52 51.01744 2295.192 499348587 Africa 1987 52 52.82479 2180.764 574834110 Africa 1992 52 53.37292 2071.615 659081517 Africa 1997 52 53.28327 2098.865 743832984 Para la evolución de los continentes en ggplot2, es útil el geom_path() library(ggrepel) ggplot(continent_year, aes(x=gdp_capita , y=lifeExp , color =continent)) + geom_path() + scale_x_log10() + geom_text_repel(aes(label=year), size=2, color=&quot;black&quot;) + labs(title=&quot;Evolución continentes (ponderado)&quot;) Figura 2.1: Evolución de los continentes El gráfico muestra la traza que han recorrido los continentes en sus valores medios de PIB per cápita y Esperanza de vida. Se confirma la mayor progresión de Asia. Vemos que, como América y Europa, en media tienen un comportamiento bastante paralelo. Se observa como el recorrido de África, aunque partiendo de valores muy inferiores, ha sido positiva y ha incrementado de forma similar el resto de continentes. 2.2 Visualización Un simple gráfico ha brindado más información a la mente del analista de datos que cualquier otro dispositivo. - John Tukey 2.2.1 Estructura básica ggplot2 es un sistema coherente para hacer gráficos. suppressPackageStartupMessages(library(HistData)) ggplot(data= Galton, mapping = aes(x=parent, y= child)) + geom_point() Figura 2.2: Altura padres e hijos (Galton, 1885) La altura de los padres es la media entre la altura del padre y 1.08 veces la de la madre. En los datos hay 205 padres diferentes y 928 hijos. Los datos fueron tabulados y por lo tanto discretizado. Para visualizar los datos resulta útil introducir aleatoriedad con jitter. ggplot(data= Galton, mapping = aes(x=parent, y= child)) + geom_jitter() Figura 2.3: Jitter altura padres e hijos (Galton, 1885) Los componentes mínimos son: ggplot define el conjunto de datos en el parámetro data que debería contener todas las variables del gráfico. geom_&lt;función&gt;: Define el tipo de gráfico. Por ejemplo, geom_point es un gráfico de puntos. mapping: define mapeo de parámetros estéticos (x, y) a través de la función aes(). A diferencia de plot, ggplot permite asignar el gráfico a un objeto R. p1 &lt;- ggplot(Galton, aes(x=parent, y= child)) + geom_jitter() Posteriormente, puedes añadirle otros elementos gráficos. p1 &lt;- p1 + geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;)) + geom_abline(aes(intercept = 0, slope = 1, color = &quot;Diagonal y = x&quot;)) + labs(title = &quot;Relación altura padres e hijos (Galton, 1885)&quot; ,x = &quot;Media altura padres (pulgadas)&quot;, y = &quot;Altura hijos (pulgadas)&quot;) p1 Figura 2.4: Regresión Simple y recta diagonal altura padres e hijos (Galton, 1885) Si defines el mapeo de estéticos en ggplot ya no es necesario definirlos en los geoms. 2.2.2 Otros geoms Otros ejemplos de geoms con los datos de gapminder en 2007. library(ggrepel) suppressPackageStartupMessages(library(cowplot)) paises07 &lt;- as.data.frame(gapminder %&gt;% filter(year==2007)) # paises en 2007 p1 &lt;- ggplot(paises07, aes(x=lifeExp)) + geom_histogram() p2 &lt;- ggplot(paises07, aes(x=continent, fill=continent)) + geom_bar() p3 &lt;- ggplot(paises07, aes(y=lifeExp, fill=continent)) + geom_boxplot() p4 &lt;- ggplot(paises07 %&gt;% arrange(desc(lifeExp)) %&gt;% head(25), aes(x=gdpPercap, y=lifeExp)) + geom_point() + geom_label_repel(aes(label=country), size=3) # arrange two plots into one column plot_grid(p1, p2, p3, p4, labels = c(&quot;histograma&quot;,&quot;barras&quot;,&quot;boxplot&quot;,&quot;Etiquetas&quot;), ncol = 2) 2.2.2.1 Panel de datos facet_wrap() library(datos) p00 &lt;- ggplot(paises , aes(x=pib_per_capita , y=esperanza_de_vida , color=continente , size=poblacion , label=pais))+ geom_point() + scale_x_log10() + facet_wrap(~anio)+ labs(title=&quot;Paises en 2007&quot;) p00 Figura 2.5: Más facet_wrap() y facet_grid() 2.2.2.2 Etiquetas geom_label() paises07 &lt;- paises %&gt;% filter(anio == 2007) p07 &lt;- ggplot(paises07 , aes(x=pib_per_capita , y=esperanza_de_vida , color=continente , size=poblacion))+ geom_point() + scale_x_log10() + labs(title=&quot;Paises en 2007&quot;)+ geom_label(data=paises07 %&gt;% filter(pais==&quot;China&quot;) , nudge_y=2 , aes(label=pais) , size=4 , color=&quot;black&quot;) p07 Figura 2.6: Más geom_label() 2.2.2.3 Paleta colores scale_colour_brewer() p07 &lt;- p07 + scale_colour_brewer( palette = &quot;Dark2&quot;) p07 Figura 2.7: Más paletas COLORBREWER 2.2.2.4 Zoom coord_cartesian() p07 &lt;- p07 + coord_cartesian( xlim=c(300,5000) , ylim=c(38,45)) p07 Figura 2.8: Más coord_cartesian() 2.2.2.5 Temas theme_bw() p07 &lt;- p07 + theme_bw() p07 Figura 2.9: Más en ggtheme 2.2.2.6 Gráficos interactivos ggplotly() suppressPackageStartupMessages(library(plotly)) ggplotly(p00) Figura 2.10: Más R Plotly Mueve el ratón por encima del gráfico para identificar los países. Des de la leyenda puedes filtrar los continentes que se quieren mostrar. 2.3 Modelar: Regressió simple Origen del concepte de regressió aplicat. p1 &lt;- ggplot(data= Galton, mapping = aes(x=parent, y= child)) + geom_jitter()+ geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;)) + geom_abline(aes(intercept = 0, slope = 1, color = &quot;Diagonal y = x&quot;)) + labs(title = &quot;Relación altura padres e hijos (Galton, 1885)&quot; ,x = &quot;Media altura padres (pulgadas)&quot;, y = &quot;Altura hijos (pulgadas)&quot;) p1 Figura 2.11: Regresión Simple y recta diagonal altura padres e hijos (Galton, 1885) 2.3.0.1 Ingressos i Despeses Es una relació molt comú a la natura. data= read.table(&quot;http://84.89.132.1/~satorra/dades/M2013RegressioSamp.txt&quot;, header =T) names(data) ## [1] &quot;Lrenda&quot; &quot;Ldespeses&quot; &quot;Genere&quot; &quot;Vot&quot; head(data,4) ## Lrenda Ldespeses Genere Vot ## 1 9.477 4.503 1 1 ## 2 11.435 6.147 1 0 ## 3 10.686 4.961 0 0 ## 4 10.407 3.993 0 0 p1 &lt;- ggplot(data= data, mapping = aes(x=scale(Lrenda), y= scale(Ldespeses))) + geom_point() + geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;)) + geom_abline(aes(intercept = 0, slope = 1, color = &quot;Diagonal y = x&quot;)) + labs(title = &quot;Relació Ingresos i Despeses&quot; ,x = &quot;Log Ingresos Estandarditzat&quot;, y = &quot;Log Despeses Estandarditzat&quot;) p1 Figura 2.12: Regresión Simple y recta diagonal Ingressos y Despeses cor(data$Lrenda,data$Ldespeses) ## [1] 0.4385204 2.3.0.2 PAISOS.SAV Alerta! Correlació no indica sempre causalitat. Poden existir altres factors ocults amb un efecte sobre ambdós factors. library(foreign) data &lt;- read.spss( &quot;http://84.89.132.1/~satorra/dades/PAISOS.SAV&quot;, use.value.labels = TRUE, to.data.frame = TRUE ) names(data) ## [1] &quot;IDH&quot; &quot;NIVELL&quot; &quot;PAIS&quot; &quot;ESPVIDA&quot; &quot;PIB&quot; &quot;ALFAB&quot; &quot;CONT&quot; &quot;CALORIES&quot; &quot;HABMETG&quot; &quot;DIARIS&quot; &quot;TV&quot; ## [12] &quot;SANITAT&quot; &quot;AGRICULT&quot; &quot;INDUST&quot; dim(data) ## [1] 160 14 data &lt;- data %&gt;% select(PAIS, ESPVIDA, CALORIES, PIB, HABMETG , ALFAB) data %&gt;% summary() ## PAIS ESPVIDA CALORIES PIB HABMETG ALFAB ## Length:160 Min. :39.00 Min. :1505 Min. : 70.0 Min. : 211.0 Min. :12.40 ## Class :character 1st Qu.:55.67 1st Qu.:2248 1st Qu.: 532.5 1st Qu.: 642.2 1st Qu.:54.50 ## Mode :character Median :67.60 Median :2614 Median : 1715.0 Median : 2000.0 Median :81.30 ## Mean :64.50 Mean :2661 Mean : 5778.5 Mean : 6709.6 Mean :73.39 ## 3rd Qu.:72.58 3rd Qu.:3166 3rd Qu.: 6337.5 3rd Qu.: 8901.5 3rd Qu.:94.35 ## Max. :79.50 Max. :3947 Max. :36730.0 Max. :50000.0 Max. :99.00 ## NA&#39;s :8 NA&#39;s :22 NA&#39;s :18 Observem que dels 160 països, alguns tenen valors faltants en alguna de les variables. En següents sessions es parlará sobre altres enfocs posibles. De moment, un primer tractament és consisteix en filtrar els països amb valors faltants. data &lt;- na.omit(data) rownames(data)&lt;-NULL # reiniciem la numeracio de les files dim(data) ## [1] 120 6 p1 &lt;- ggplot(data= data, mapping = aes(x=scale(CALORIES), y= scale(ESPVIDA))) + geom_point() + geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;)) + labs(title = &quot;Relació Calories i Esperança de vida&quot; ,x = &quot;Calories por habitant&quot;, y = &quot;ESperança de vida (anys)&quot;) p1 Figura 2.13: Regresión Simple y recta diagonal Calories i Esperança de vida 2.3.1 Regressió simple reg1&lt;- lm(ESPVIDA ~ CALORIES, data=data) summary(reg1) ## ## Call: ## lm(formula = ESPVIDA ~ CALORIES, data = data) ## ## Residuals: ## Min 1Q Median 3Q Max ## -19.0797 -5.0123 0.0774 5.4410 14.6255 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 27.060569 3.135144 8.631 3.35e-14 *** ## CALORIES 0.013896 0.001136 12.232 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 7.107 on 118 degrees of freedom ## Multiple R-squared: 0.5591, Adjusted R-squared: 0.5553 ## F-statistic: 149.6 on 1 and 118 DF, p-value: &lt; 2.2e-16 Estandarditzem les variables i comparem models amb stargazer. reg1s &lt;- lm(scale(ESPVIDA) ~ scale(CALORIES), data=data) # install.packages(&quot;stargazer&quot;) library(stargazer) stargazer(reg1, reg1s, type=&#39;text&#39;) ## ## =========================================================== ## Dependent variable: ## ---------------------------- ## ESPVIDA scale(ESPVIDA) ## (1) (2) ## ----------------------------------------------------------- ## CALORIES 0.014*** ## (0.001) ## ## scale(CALORIES) 0.748*** ## (0.061) ## ## Constant 27.061*** -0.000 ## (3.135) (0.061) ## ## ----------------------------------------------------------- ## Observations 120 120 ## R2 0.559 0.559 ## Adjusted R2 0.555 0.555 ## Residual Std. Error (df = 118) 7.107 0.667 ## F Statistic (df = 1; 118) 149.611*** 149.611*** ## =========================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 Observa que \\(0.748^2=0.559\\) . 2.3.1.1 Residus versus predicció plot(reg1,1) data$PAIS[c(34,32,9)] ## [1] &quot;Mauritania &quot; &quot;Guinea &quot; &quot;Guinea Bissau &quot; reg2=lm(ESPVIDA ~ CALORIES + ALFAB, data=data ) anova(reg1,reg2) ## Analysis of Variance Table ## ## Model 1: ESPVIDA ~ CALORIES ## Model 2: ESPVIDA ~ CALORIES + ALFAB ## Res.Df RSS Df Sum of Sq F Pr(&gt;F) ## 1 118 5959.5 ## 2 117 2852.7 1 3106.8 127.42 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 stargazer(reg1,reg2, type=&#39;text&#39;) ## ## ===================================================================== ## Dependent variable: ## ------------------------------------------------- ## ESPVIDA ## (1) (2) ## --------------------------------------------------------------------- ## CALORIES 0.014*** 0.007*** ## (0.001) (0.001) ## ## ALFAB 0.278*** ## (0.025) ## ## Constant 27.061*** 25.403*** ## (3.135) (2.183) ## ## --------------------------------------------------------------------- ## Observations 120 120 ## R2 0.559 0.789 ## Adjusted R2 0.555 0.785 ## Residual Std. Error 7.107 (df = 118) 4.938 (df = 117) ## F Statistic 149.611*** (df = 1; 118) 218.659*** (df = 2; 117) ## ===================================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 plot(reg2,1) data$PAIS[c(6,9,105)] ## [1] &quot;Uganda &quot; &quot;Guinea Bissau &quot; &quot;Kuwait &quot; plot(data %&gt;% select(ESPVIDA, CALORIES, PIB, HABMETG, ALFAB)) corr_select &lt;- data %&gt;% select(ESPVIDA, CALORIES, PIB, HABMETG, ALFAB) %&gt;% cor(use=&quot;pairwise.complete.obs&quot;) %&gt;% round(3) kable(corr_select) ESPVIDA CALORIES PIB HABMETG ALFAB ESPVIDA 1.000 0.748 0.629 -0.739 0.839 CALORIES 0.748 1.000 0.616 -0.605 0.619 PIB 0.629 0.616 1.000 -0.378 0.524 HABMETG -0.739 -0.605 -0.378 1.000 -0.648 ALFAB 0.839 0.619 0.524 -0.648 1.000 library(ggcorrplot) corr_select %&gt;% ggcorrplot(type = &quot;lower&quot;, lab = TRUE, show.legend = F) # Transformation of variables (linearizing regression) data &lt;- data %&gt;% mutate( LPIB = log(PIB) ,Lhabmetges = log(HABMETG) ) plot(data %&gt;% select(ESPVIDA, CALORIES, LPIB, Lhabmetges, ALFAB)) corr_log_select &lt;- data %&gt;% select(ESPVIDA, CALORIES, PIB, LPIB, HABMETG, Lhabmetges, ALFAB) %&gt;% cor(use=&quot;pairwise.complete.obs&quot;) %&gt;% round(3) corr_log_select %&gt;% ggcorrplot(type = &quot;lower&quot;, lab = TRUE, show.legend = F) reg3 &lt;- lm(ESPVIDA ~ CALORIES + LPIB + Lhabmetges +ALFAB, data=data) stargazer(reg1, reg2, reg3, type=&#39;text&#39;) ## ## ============================================================================================== ## Dependent variable: ## -------------------------------------------------------------------------- ## ESPVIDA ## (1) (2) (3) ## ---------------------------------------------------------------------------------------------- ## CALORIES 0.014*** 0.007*** 0.001 ## (0.001) (0.001) (0.001) ## ## LPIB 1.821*** ## (0.452) ## ## Lhabmetges -2.388*** ## (0.523) ## ## ALFAB 0.278*** 0.165*** ## (0.025) (0.026) ## ## Constant 27.061*** 25.403*** 55.475*** ## (3.135) (2.183) (7.637) ## ## ---------------------------------------------------------------------------------------------- ## Observations 120 120 120 ## R2 0.559 0.789 0.857 ## Adjusted R2 0.555 0.785 0.852 ## Residual Std. Error 7.107 (df = 118) 4.938 (df = 117) 4.098 (df = 115) ## F Statistic 149.611*** (df = 1; 118) 218.659*** (df = 2; 117) 172.404*** (df = 4; 115) ## ============================================================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 2.3.2 Regressió lineal simple \\[ Y = \\beta_0 + \\beta_1x + \\epsilon \\] La \\(\\beta_0\\) terme independent La \\(\\beta_1\\) coeficient de regressió La esperança, \\(E(Y)=\\beta_0+\\beta_1E(x)\\) El coeficient, \\(\\beta_1\\) és un increment en el valor esperat de \\(Y\\) dun augmenta unitari en la variable X El \\(\\epsilon\\) és un terme de pertorbació, variable estadística \\(\\epsilonN(0,\\sigma^2)\\), valor esperat zero i variància constant. Noteu que la variància de \\(\\epsilon\\) representa la intensitat de variació de Y al voltant de la recta de regressió \\(Y=\\beta_0+\\beta_1x\\). Ajust de la regressió: \\[ Y = b_0 + b_1x + \\epsilon \\] \\(b_0=27.061\\), \\(b_1=0.014\\), \\(b_0\\) i \\(b_1\\) són estimacions de \\(\\beta_0\\) i \\(\\beta_1\\) respectivament. Totes les estimacions estan subjectes a un error tipus (standard error). En el nostre exemple: lerror tipus de lestimació ´de \\(beta_1=0.014\\) és \\(0.001\\). Coeficient de determinació múltiple, \\(R^2=0.559\\) és a dir, \\(55.9%\\) de la variació de \\(Y\\) és deguda a la variable X. 2.3.3 Regressió lineal múltiple \\[ Y = \\beta_0 + \\beta_1x_1 + \\beta_2x_2 + \\epsilon \\] El \\(\\beta_0\\) terme independent La \\(\\beta_1\\), \\(\\beta_2\\) coeficients de regressió parcial La Esperança: \\(E(Y)=\\beta_0+\\beta_1E(x_1)+\\beta_2E(x_2)\\) \\(\\beta_2\\) és un increment en el valor esperat de \\(Y\\) dun augment unitari en la variable \\(X_2\\) quan \\(X_1\\) es manté constant. Idem per \\(\\beta_1\\) (versus \\(X_2\\)) \\(\\epsilon\\) terme de perturbació, variable estadística \\(\\epsilonN(0,\\sigma^2)\\), valor esperat zero i variància constant. Noteu que la variància de \\(\\epsilon\\) representa la intensitat de variació de Y al voltant de la recta de regressió \\(Y=\\beta_0+\\beta_1x_1+\\beta_2x_2\\). Regressió estimada: \\[ Y = b_0 + b_1x_1 + b_2x_2 \\] Els coeficients: \\(b_0=25.403\\); \\(b_1=0.007\\); \\(b_2=0.278\\) El \\(R^2=0.044\\) és un \\(4.4%\\) de variació de \\(Y\\) ve explicada per la variació conjunta de \\(X_1\\) i \\(X_2\\). "],["teoria-setmana-3.html", "Capítol 3 Teoria Setmana 3 3.1 Repas dia anterior 3.2 Interpretació del model 3.3 Variance Inflation Factor (VIF) 3.4 Dades del Bank", " Capítol 3 Teoria Setmana 3 3.1 Repas dia anterior 3.1.0.1 PAISOS.SAV Alerta! Correlació no indica sempre causalitat. Poden existir altres factors ocults amb un efecte sobre ambdós factors. library(foreign) data &lt;- read.spss( &quot;http://84.89.132.1/~satorra/dades/PAISOS.SAV&quot;, use.value.labels = TRUE, to.data.frame = TRUE ) data &lt;- data %&gt;% select(PAIS, ESPVIDA, CALORIES, PIB, HABMETG , ALFAB) data &lt;- na.omit(data) rownames(data)&lt;-NULL # reiniciem la numeracio de les files 3.1.1 Regressió simple data &lt;- data %&gt;% mutate( LPIB = log(PIB) ,Lhabmetges = log(HABMETG) ) reg1 &lt;- lm(ESPVIDA ~ CALORIES, data=data) reg2 &lt;- lm(ESPVIDA ~ CALORIES + ALFAB, data=data ) reg3 &lt;- lm(ESPVIDA ~ CALORIES + LPIB + Lhabmetges +ALFAB, data=data) stargazer(reg1, reg2, reg3, type=&#39;text&#39;) ## ## ============================================================================================== ## Dependent variable: ## -------------------------------------------------------------------------- ## ESPVIDA ## (1) (2) (3) ## ---------------------------------------------------------------------------------------------- ## CALORIES 0.014*** 0.007*** 0.001 ## (0.001) (0.001) (0.001) ## ## LPIB 1.821*** ## (0.452) ## ## Lhabmetges -2.388*** ## (0.523) ## ## ALFAB 0.278*** 0.165*** ## (0.025) (0.026) ## ## Constant 27.061*** 25.403*** 55.475*** ## (3.135) (2.183) (7.637) ## ## ---------------------------------------------------------------------------------------------- ## Observations 120 120 120 ## R2 0.559 0.789 0.857 ## Adjusted R2 0.555 0.785 0.852 ## Residual Std. Error 7.107 (df = 118) 4.938 (df = 117) 4.098 (df = 115) ## F Statistic 149.611*** (df = 1; 118) 218.659*** (df = 2; 117) 172.404*** (df = 4; 115) ## ============================================================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 3.1.2 Regressió lineal simple \\[ Y = \\beta_0 + \\beta_1x + \\epsilon \\] La \\(\\beta_0\\) terme independent La \\(\\beta_1\\) coeficient de regressió La esperança, \\(E(Y)=\\beta_0+\\beta_1E(x)\\) El coeficient, \\(\\beta_1\\) és un increment en el valor esperat de \\(Y\\) dun augmenta unitari en la variable X El \\(\\epsilon\\) és un terme de pertorbació, variable estadística \\(\\epsilonN(0,\\sigma^2)\\), valor esperat zero i variància constant. Noteu que la variància de \\(\\epsilon\\) representa la intensitat de variació de Y al voltant de la recta de regressió \\(Y=\\beta_0+\\beta_1x\\). Ajust de la regressió: \\[ Y = b_0 + b_1x + \\epsilon \\] \\(b_0=27.061\\), \\(b_1=0.014\\), \\(b_0\\) i \\(b_1\\) són estimacions de \\(\\beta_0\\) i \\(\\beta_1\\) respectivament. Totes les estimacions estan subjectes a un error tipus (standard error). En el nostre exemple: lerror tipus de lestimació ´de \\(beta_1=0.014\\) és \\(0.001\\). Coeficient de determinació múltiple, \\(R^2=0.559\\) és a dir, \\(55.9%\\) de la variació de \\(Y\\) és deguda a la variable X. 3.1.3 Regressió lineal múltiple \\[ Y = \\beta_0 + \\beta_1x_1 + \\beta_2x_2 + \\epsilon \\] El \\(\\beta_0\\) terme independent La \\(\\beta_1\\), \\(\\beta_2\\) coeficients de regressió parcial La Esperança: \\(E(Y)=\\beta_0+\\beta_1E(x_1)+\\beta_2E(x_2)\\) \\(\\beta_2\\) és un increment en el valor esperat de \\(Y\\) dun augment unitari en la variable \\(X_2\\) quan \\(X_1\\) es manté constant. Idem per \\(\\beta_1\\) (versus \\(X_2\\)) \\(\\epsilon\\) terme de perturbació, variable estadística \\(\\epsilonN(0,\\sigma^2)\\), valor esperat zero i variància constant. Noteu que la variància de \\(\\epsilon\\) representa la intensitat de variació de Y al voltant de la recta de regressió \\(Y=\\beta_0+\\beta_1x_1+\\beta_2x_2\\). Regressió estimada: \\[ Y = b_0 + b_1x_1 + b_2x_2 \\] Els coeficients: \\(b_0=25.403\\); \\(b_1=0.007\\); \\(b_2=0.278\\) El \\(R^2=0.044\\) és un \\(4.4%\\) de variació de \\(Y\\) ve explicada per la variació conjunta de \\(X_1\\) i \\(X_2\\). 3.2 Interpretació del model 3.2.1 Gráficament 3.2.1.1 Residus versus valors ajustats plot(reg3,1) verifiquem la homoscedasticitat 3.2.1.2 Análisis normalitat Q-Q plot. plot(reg3,2) Densitat residus. plot(density(residuals(reg3))) 3.2.1.3 Outlyers Distancia de Cook. plot(reg3,4) data$PAIS[c(4,35,89)] ## [1] &quot;Sierra Leona &quot; &quot;Sri Lanka &quot; &quot;Gabon &quot; Residus estandarditzats vs leverage plot(reg3,5) 3.2.2 Gràfics de regressio parcial library(car) ## Loading required package: carData ## Warning: package &#39;carData&#39; was built under R version 4.0.3 ## ## Attaching package: &#39;car&#39; ## The following object is masked from &#39;package:dplyr&#39;: ## ## recode ## The following object is masked from &#39;package:purrr&#39;: ## ## some avPlots(reg3) Per obtenir només un gràfic. avPlots(reg3, ~ CALORIES) 3.3 Variance Inflation Factor (VIF) Manual de Referència Per identificar multicolinealitat entre les variables explicatives es pot usar el VIF o variance inflation factors (VIF). Com més gran es el calor, més alta la multicolinealitat. El VIF de una variable sobté de la regressió daquesta contra la resta de variables del model: Es calcula el VIF per cada variable explicativa i aquelles amb valor més alt seliminen. LA frontera és arbitraria, tot i que sacostuma a considerar valors superiors a 5 com a molt alts library(car) vif(reg3) ## CALORIES LPIB Lhabmetges ALFAB ## 3.250846 3.674479 4.517252 2.524628 3.4 Dades del Bank Dades de salaris en un banc. Imagina que hi ha un plet en aquesta empresa sobre discriminació per raó de gènere. De fet, el salari actual dels homes és molt superior al de les dones. knitr::opts_chunk$set(echo = TRUE) library(foreign) ; d &lt;- read.spss(&quot;https://griu.github.io/meacp_2021/www/data/bank2.sav&quot;, to.data.frame=TRUE) ## re-encoding from CP1252 ## Warning in read.spss(&quot;https://griu.github.io/meacp_2021/www/data/bank2.sav&quot;, : Undeclared level(s) 15750, 15900, 16200, 16350, ## 16500, 16650, 16800, 16950, 17100, 17250, 17400, 17700, 18150, 18450, 18750, 19200, 19650, 19800, 19950, 20100, 20400, 20550, 20700, ## 20850, 21000, 21150, 21300, 21450, 21600, 21750, 21900, 22050, 22200, 22350, 22500, 22650, 22800, 22950, 23100, 23250, 23400, 23550, ## 23700, 23850, 24000, 24150, 24300, 24450, 24600, 24750, 24900, 25050, 25200, 25350, 25500, 25650, 25800, 25950, 26100, 26250, 26400, ## 26550, 26700, 26850, 27000, 27150, 27300, 27450, 27600, 27750, 27900, 28050, 28200, 28350, 28500, 28650, 28800, 28950, 29100, 29160, ## 29250, 29340, 29400, 29550, 29700, 29850, 30000, 30150, 30270, 30300, 30450, 30600, 30750, 30900, 31050, 31200, 31350, 31500, 31650, ## 31950, 32100, 32400, 32550, 32850, 33000, 33150, 33300, 33450, 33540, 33750, 33900, 34410, 34500, 34620, 34800, 34950, 35100, 35250, ## 35550, 35700, 36000, 36150, 36600, 37050, 37500, 37650, 37800, 38400, 38550, 38700, 38850, 39150, 39300, 39600, 39900, 40050, 40200, ## 40350, 40800, 41100, 41550, 42000, 42300, 43000, 43410, 43500, 43650, 43950, 44875, 45000, 45150, 45250, 45625, 46000, 46875, 47250, ## 47550, 48000, 48750, 49000, 50000, 50550, 51000, 51250, 51450, 52125, 52650, 53125, 54000, 54375, 54875, 54900, 55000, 55500, 55750, ## 56500, 56550, 56750, 57000, 58125, 58750, 59375, 59400, 60000, 60375, 60625, 61250, 61875, 62500, 65000, 66000, 66250, 66750, 66875, ## 67500, 68125, 68750, 69250, 70000, 70875, 72500, 73500, 73750, 75000, 78125, 78250, 78500, 80000, 81250, 82500, 83750, 86250, 90625, ## 91250, 92000, 97000, 1e+05, 103500, 103750, 110625, 135000 added in variable: salario ## Warning in read.spss(&quot;https://griu.github.io/meacp_2021/www/data/bank2.sav&quot;, : Undeclared level(s) 9000, 9750, 10050, 10200, 10500, ## 10650, 10950, 11100, 11225, 11250, 11400, 11550, 12000, 12150, 12300, 12450, 12600, 12750, 12900, 13050, 13200, 13350, 13500, 13800, ## 13950, 14100, 14250, 14400, 14550, 14700, 15000, 15300, 15600, 15750, 16050, 16500, 16800, 17100, 17250, 17490, 18000, 18750, 19500, ## 19980, 20250, 20400, 20550, 21000, 21240, 21480, 21750, 21990, 22500, 23250, 23730, 24990, 25000, 25500, 26250, 27000, 27480, 27510, ## 27750, 28740, 29490, 30000, 30750, 31250, 31500, 31980, 32010, 32490, 33000, 33750, 34980, 35010, 35040, 36240, 36750, 37500, 39990, ## 42480, 42510, 43500, 44100, 45000, 47490, 52500, 60000, 79980 added in variable: salini ## Warning in read.spss(&quot;https://griu.github.io/meacp_2021/www/data/bank2.sav&quot;, : Undeclared level(s) 63, 64, 65, 66, 67, 68, 69, 70, ## 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98 added in variable: ## tiempemp ## Warning in read.spss(&quot;https://griu.github.io/meacp_2021/www/data/bank2.sav&quot;, : Undeclared level(s) 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, ## 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 29, 30, 32, 33, 34, 35, 36, 37, 38, 40, 41, 42, 43, 44, 45, 46, 47, ## 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 66, 67, 68, 69, 70, 72, 74, 75, 76, 78, 79, 80, 81, 82, 83, 84, ## 85, 86, 87, 90, 91, 93, 94, 96, 97, 99, 101, 102, 103, 105, 106, 107, 108, 110, 113, 114, 115, 116, 117, 120, 121, 122, 123, 124, ## 125, 126, 127, 128, 129, 130, 132, 133, 134, 137, 138, 139, 143, 144, 149, 150, 151, 154, 155, 156, 159, 163, 165, 168, 169, 171, ## 173, 174, 175, 176, 180, 181, 182, 184, 190, 191, 192, 193, 194, 196, 198, 199, 205, 207, 208, 209, 210, 214, 216, 221, 228, 229, ## 231, 240, 241, 244, 246, 252, 258, 261, 264, 265, 271, 272, 275, 281, 284, 285, 288, 302, 305, 307, 308, 314, 315, 317, 318, 319, ## 320, 324, 338, 344, 348, 358, 359, 367, 371, 372, 375, 380, 381, 385, 387, 390, 408, 412, 429, 432, 438, 444, 451, 460, 476 added in ## variable: expprev d1 &lt;- read.spss(&quot;https://griu.github.io/meacp_2021/www/data/bank2.sav&quot;, to.data.frame=TRUE,use.value.labels = FALSE) ## re-encoding from CP1252 d$educ &lt;- d1$educ d$salario &lt;- d1$salario d$salini &lt;- d1$salini d$tiempemp &lt;- d1$tiempemp d$expprev &lt;- d1$expprev d$edad &lt;- d1$edad Residus. hist(d$salini) boxplot(salario ~ sexo, data=d) t-test. library(stargazer) mod1 &lt;- lm(salario ~ sexo, data=d) mod2 &lt;- lm(log(salario) ~ sexo, data=d) stargazer(mod1,mod2, type=&#39;html&#39;) Dependent variable: salario log(salario) (1) (2) sexoMujer -15,409.860*** -0.412*** (1,407.906) (0.031) Constant 41,441.780*** 10.545*** (950.411) (0.021) Observations 474 474 R2 0.202 0.267 Adjusted R2 0.201 0.266 Residual Std. Error (df = 472) 15,265.860 0.340 F Statistic (df = 1; 472) 119.798*** 172.322*** Note: p&lt;0.1; p&lt;0.05; p&lt;0.01 Afegim covariables. plot(salario ~ edad, data=d) abline(lm(salario ~ edad, data=d), col=&quot;red&quot;) library(stargazer) mod1 &lt;- lm(salario ~ sexo + edad, data=d) mod2 &lt;- lm(log(salario) ~ sexo + edad, data=d) stargazer(mod1,mod2, type=&#39;html&#39;) Dependent variable: salario log(salario) (1) (2) sexoMujer -15,216.770*** -0.405*** (1,400.366) (0.031) edad -178.228*** -0.006*** (59.257) (0.001) Constant 45,051.720*** 10.673*** (1,521.035) (0.033) Observations 473 473 R2 0.218 0.303 Adjusted R2 0.214 0.300 Residual Std. Error (df = 470) 15,150.260 0.333 F Statistic (df = 2; 470) 65.431*** 102.202*** Note: p&lt;0.1; p&lt;0.05; p&lt;0.01 "],["teoria-setmana-4.html", "Capítol 4 Teoria Setmana 4 4.1 Packages 4.2 Salaries", " Capítol 4 Teoria Setmana 4 4.1 Packages install.packages(texreg) install.packages(lmtest) install.packages(sandwich) 4.2 Salaries El conjunt de dades Salary informa duna mostra de salaris de professors universitaris recopilats durant lany acadèmic 2008-2009 a USA. Addicionalment als salaris en dòlars, les dades inclouen les següents 5 variables: gènere, anys des del Doctorat, anys de servei, disciplina (teoria (1) o aplicat (2)) i rang acadèmic. Hi ha una consulta sobre la possible discriminació salarial per gènere. library(car) names(Salaries) ## [1] &quot;rank&quot; &quot;discipline&quot; &quot;yrs.since.phd&quot; &quot;yrs.service&quot; &quot;sex&quot; &quot;salary&quot; dim(Salaries) ## [1] 397 6 4.2.1 Anàlisis univariant suppressPackageStartupMessages(library(tidyverse)) Salaries %&gt;% ggplot(aes(x=salary)) + geom_density()+ labs(title=&quot;Densitat Salaris&quot;) Salaries %&gt;% ggplot(aes(x=log(salary))) + geom_density()+ labs(title=&quot;Densitat Log-Salaris&quot;) Salaries %&gt;% ggplot(aes(x=sex)) + geom_bar() Salaries %&gt;% ggplot(aes(x=rank)) + geom_bar() Salaries %&gt;% ggplot(aes(x=discipline)) + geom_bar() Salaries %&gt;% ggplot(aes(x=yrs.since.phd)) + geom_density() Salaries %&gt;% ggplot(aes(x=log(yrs.since.phd))) + geom_density() Salaries %&gt;% ggplot(aes(x=yrs.service)) + geom_density() Salaries %&gt;% ggplot(aes(x=log(yrs.service))) + geom_density() ## Warning: Removed 11 rows containing non-finite values (stat_density). 4.2.2 Anàlisis bivariant Salaries &lt;- Salaries %&gt;% mutate(log_salary = log(salary) ,log_yrs.since.phd = log(yrs.since.phd) ,yrs.since.phd2 = yrs.since.phd**2 ,log_yrs.service = log(yrs.service+1) ,yrs.service2 = yrs.service**2 ) Salaries %&gt;% select(salary,log_salary,yrs.since.phd,log_yrs.since.phd,yrs.since.phd2) %&gt;% plot() Salaries %&gt;% select(salary,log_salary,yrs.since.phd,log_yrs.since.phd,yrs.since.phd2) %&gt;% cor() %&gt;% round(3) ## salary log_salary yrs.since.phd log_yrs.since.phd yrs.since.phd2 ## salary 1.000 0.988 0.419 0.496 0.305 ## log_salary 0.988 1.000 0.426 0.520 0.297 ## yrs.since.phd 0.419 0.426 1.000 0.915 0.963 ## log_yrs.since.phd 0.496 0.520 0.915 1.000 0.790 ## yrs.since.phd2 0.305 0.297 0.963 0.790 1.000 Salaries %&gt;% ggplot(aes(x=sex,y=salary)) + geom_boxplot() Salaries %&gt;% ggplot(aes(x=sex,y=log(salary))) + geom_boxplot() reg1 &lt;- lm(salary~sex, data=Salaries) summary(reg1) ## ## Call: ## lm(formula = salary ~ sex, data = Salaries) ## ## Residuals: ## Min 1Q Median 3Q Max ## -57290 -23502 -6828 19710 116455 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 101002 4809 21.001 &lt; 2e-16 *** ## sexMale 14088 5065 2.782 0.00567 ** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 30030 on 395 degrees of freedom ## Multiple R-squared: 0.01921, Adjusted R-squared: 0.01673 ## F-statistic: 7.738 on 1 and 395 DF, p-value: 0.005667 Observem que els salaris en homes són $14.088 superiors que en les dones. Això ens diu que, quan comparem els salaris de forma directe, entre homes i dones, amb un nivell de confiança del 95%, hi ha diferències significatives. library(stargazer) logreg1 &lt;- lm(log(salary)~sex, data=Salaries) stargazer(reg1,logreg1, type=&quot;text&quot;) ## ## =========================================================== ## Dependent variable: ## ---------------------------- ## salary log(salary) ## (1) (2) ## ----------------------------------------------------------- ## sexMale 14,088.010*** 0.129*** ## (5,064.579) (0.043) ## ## Constant 101,002.400*** 11.491*** ## (4,809.386) (0.041) ## ## ----------------------------------------------------------- ## Observations 397 397 ## R2 0.019 0.022 ## Adjusted R2 0.017 0.019 ## Residual Std. Error (df = 395) 30,034.610 0.258 ## F Statistic (df = 1; 395) 7.738*** 8.810*** ## =========================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 La comparativa en termes de logaritme neperià del salari, mostra igualment diferencies significatives amb un 95% de confiança. El coeficient 0,129 del gènere, ens diu que els homes, tenen un salari un 12,9% (aproximadament) per sobre de les dones. Incorporem ara nous factor. logreg2 &lt;- lm(log(salary) ~ sex + yrs.since.phd, data= Salaries) stargazer(logreg1, logreg2, type=&quot;text&quot;) ## ## ================================================================== ## Dependent variable: ## ---------------------------------------------- ## log(salary) ## (1) (2) ## ------------------------------------------------------------------ ## sexMale 0.129*** 0.075* ## (0.043) (0.040) ## ## yrs.since.phd 0.008*** ## (0.001) ## ## Constant 11.491*** 11.353*** ## (0.041) (0.041) ## ## ------------------------------------------------------------------ ## Observations 397 397 ## R2 0.022 0.188 ## Adjusted R2 0.019 0.184 ## Residual Std. Error 0.258 (df = 395) 0.235 (df = 394) ## F Statistic 8.810*** (df = 1; 395) 45.715*** (df = 2; 394) ## ================================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 Observem que la variable anys des del doctorat guanya molt pes en la regressió, i produeix que la variables gènere informi que els homes guanyen un 7,5% més les dones (a igual nombre de anys des del doctorat), essent ara, aquesta relació, no significativa amb un nivell del confiança del 95%. En aquest cas, el coeficient 0.008 ens diu que per cada any addicional, hi ha un augment del 0,8% del salari. Salaries %&gt;% ggplot(aes(x=yrs.since.phd, y=log(salary), color=sex))+ geom_point() 4.2.3 Realció log-log loglogreg2 &lt;- lm(log(salary) ~ sex + log(yrs.since.phd), data= Salaries) stargazer(logreg1, logreg2, loglogreg2, type=&quot;text&quot;) ## ## ========================================================================================== ## Dependent variable: ## ---------------------------------------------------------------------- ## log(salary) ## (1) (2) (3) ## ------------------------------------------------------------------------------------------ ## sexMale 0.129*** 0.075* 0.076** ## (0.043) (0.040) (0.038) ## ## yrs.since.phd 0.008*** ## (0.001) ## ## log(yrs.since.phd) 0.167*** ## (0.014) ## ## Constant 11.491*** 11.353*** 11.061*** ## (0.041) (0.041) (0.051) ## ## ------------------------------------------------------------------------------------------ ## Observations 397 397 397 ## R2 0.022 0.188 0.278 ## Adjusted R2 0.019 0.184 0.274 ## Residual Std. Error 0.258 (df = 395) 0.235 (df = 394) 0.222 (df = 394) ## F Statistic 8.810*** (df = 1; 395) 45.715*** (df = 2; 394) 75.904*** (df = 2; 394) ## ========================================================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 Si agafem els anys dexperiència en termes de logaritme observem 3 coses: El coeficient 0,167 indica que per cada augment del 100% (duplicar) els anys des del doctorat, el salari augmenta un 16,7%. Per altra banda la variable gènere, passa a ser significativa amb un 95% de confiança. La regressió passa a explicar del 18,8% a un 27,8% de la variabilitat del logaritme dels salaris. Salaries %&gt;% ggplot(aes(x=log(yrs.since.phd), y=log(salary), color=sex))+ geom_point() 4.2.4 Realció x**2 logreg22 &lt;- lm(log(salary) ~ sex + yrs.since.phd +yrs.since.phd2, data= Salaries) stargazer(logreg1, logreg2, loglogreg2, logreg22, type=&quot;text&quot;) ## ## ================================================================================================================== ## Dependent variable: ## ---------------------------------------------------------------------------------------------- ## log(salary) ## (1) (2) (3) (4) ## ------------------------------------------------------------------------------------------------------------------ ## sexMale 0.129*** 0.075* 0.076** 0.087** ## (0.043) (0.040) (0.038) (0.035) ## ## yrs.since.phd 0.008*** 0.039*** ## (0.001) (0.003) ## ## log(yrs.since.phd) 0.167*** ## (0.014) ## ## yrs.since.phd2 -0.001*** ## (0.0001) ## ## Constant 11.491*** 11.353*** 11.061*** 11.081*** ## (0.041) (0.041) (0.051) (0.044) ## ## ------------------------------------------------------------------------------------------------------------------ ## Observations 397 397 397 397 ## R2 0.022 0.188 0.278 0.366 ## Adjusted R2 0.019 0.184 0.274 0.361 ## Residual Std. Error 0.258 (df = 395) 0.235 (df = 394) 0.222 (df = 394) 0.208 (df = 393) ## F Statistic 8.810*** (df = 1; 395) 45.715*** (df = 2; 394) 75.904*** (df = 2; 394) 75.720*** (df = 3; 393) ## ================================================================================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 Ara no hi ha una interpretació directa. Veiem que és una realció significativa al 95% de confiança en tots els factors. Salaries %&gt;% ggplot(aes(x=yrs.since.phd, y=log(salary), color=sex))+ stat_smooth(method = &quot;lm&quot;, formula = y ~ x + I(x^2), size = 1)+ geom_point() 4.2.5 Interaccions Anem a analitzar la interacció entre gènere i anys des del doctorat. logreg3 &lt;- lm(log(salary) ~ sex * yrs.since.phd , data= Salaries) stargazer(logreg1, logreg2, logreg3, type=&quot;text&quot;) ## ## ============================================================================================ ## Dependent variable: ## ---------------------------------------------------------------------- ## log(salary) ## (1) (2) (3) ## -------------------------------------------------------------------------------------------- ## sexMale 0.129*** 0.075* 0.210*** ## (0.043) (0.040) (0.078) ## ## yrs.since.phd 0.008*** 0.016*** ## (0.001) (0.004) ## ## sexMale:yrs.since.phd -0.008** ## (0.004) ## ## Constant 11.491*** 11.353*** 11.229*** ## (0.041) (0.041) (0.074) ## ## -------------------------------------------------------------------------------------------- ## Observations 397 397 397 ## R2 0.022 0.188 0.197 ## Adjusted R2 0.019 0.184 0.190 ## Residual Std. Error 0.258 (df = 395) 0.235 (df = 394) 0.234 (df = 393) ## F Statistic 8.810*** (df = 1; 395) 45.715*** (df = 2; 394) 32.040*** (df = 3; 393) ## ============================================================================================ ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 logreg4 &lt;- lm(log(salary) ~ sex * yrs.since.phd + rank + discipline , data= Salaries) summary(logreg4) ## ## Call: ## lm(formula = log(salary) ~ sex * yrs.since.phd + rank + discipline, ## data = Salaries) ## ## Residuals: ## Min 1Q Median 3Q Max ## -0.68720 -0.11114 -0.00746 0.09789 0.57698 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 11.1613950 0.0593982 187.908 &lt; 2e-16 *** ## sexMale 0.0627753 0.0617296 1.017 0.310 ## yrs.since.phd 0.0006863 0.0032390 0.212 0.832 ## rankAssocProf 0.1536658 0.0337357 4.555 7.02e-06 *** ## rankProf 0.4550346 0.0344904 13.193 &lt; 2e-16 *** ## disciplineB 0.1279222 0.0188376 6.791 4.17e-11 *** ## sexMale:yrs.since.phd -0.0012207 0.0031494 -0.388 0.699 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 0.1819 on 390 degrees of freedom ## Multiple R-squared: 0.5185, Adjusted R-squared: 0.5111 ## F-statistic: 70 on 6 and 390 DF, p-value: &lt; 2.2e-16 logreg5 &lt;- lm(log(salary) ~ sex + yrs.since.phd + yrs.since.phd2 + rank + discipline , data= Salaries) summary(logreg5) ## ## Call: ## lm(formula = log(salary) ~ sex + yrs.since.phd + yrs.since.phd2 + ## rank + discipline, data = Salaries) ## ## Residuals: ## Min 1Q Median 3Q Max ## -0.62180 -0.10560 -0.00586 0.10151 0.59825 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 1.111e+01 4.262e-02 260.719 &lt; 2e-16 *** ## sexMale 5.020e-02 3.088e-02 1.626 0.10481 ## yrs.since.phd 1.277e-02 4.522e-03 2.824 0.00498 ** ## yrs.since.phd2 -2.290e-04 7.604e-05 -3.012 0.00277 ** ## rankAssocProf 8.627e-02 4.025e-02 2.143 0.03270 * ## rankProf 3.481e-01 4.945e-02 7.038 8.81e-12 *** ## disciplineB 1.304e-01 1.864e-02 6.997 1.15e-11 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 0.1799 on 390 degrees of freedom ## Multiple R-squared: 0.5293, Adjusted R-squared: 0.522 ## F-statistic: 73.09 on 6 and 390 DF, p-value: &lt; 2.2e-16 avPlots(logreg5) vif(logreg5) ## GVIF Df GVIF^(1/(2*Df)) ## sex 1.036197 1 1.017938 ## yrs.since.phd 41.568673 1 6.447377 ## yrs.since.phd2 29.791275 1 5.458138 ## rank 4.291107 2 1.439270 ## discipline 1.057661 1 1.028426 plot(logreg5,1) 4.2.6 Estimadors robustos AnalizaR Datos Políticos HC0 = es el original de White (Wooldridge 2016) HC1 = Es el que usa el software de Stata HC3 =Es el más conservador, por lo tanto, es muy recomendable library(texreg) ## Version: 1.37.5 ## Date: 2020-06-17 ## Author: Philip Leifeld (University of Essex) ## ## Consider submitting praise using the praise or praise_interactive functions. ## Please cite the JSS article in your publications -- see citation(&quot;texreg&quot;). ## ## Attaching package: &#39;texreg&#39; ## The following object is masked from &#39;package:tidyr&#39;: ## ## extract library(lmtest) ## Loading required package: zoo ## ## Attaching package: &#39;zoo&#39; ## The following objects are masked from &#39;package:base&#39;: ## ## as.Date, as.Date.numeric library(sandwich) logreg5_robust_3 &lt;- coeftest(logreg5, vcov = vcovHC(logreg5, &quot;HC3&quot;)) logreg5_robust_1 &lt;- coeftest(logreg5, vcov = vcovHC(logreg5, &quot;HC1&quot;)) logreg5_robust_0 &lt;- coeftest(logreg5, vcov = vcovHC(logreg5, &quot;HC0&quot;)) models_robust &lt;- list(logreg5, logreg5_robust_0, logreg5_robust_1, logreg5_robust_3) screenreg(models_robust, custom.model.names = c(&quot;sin ES robustos&quot;, &quot;robustos HC0&quot;, &quot;robustos HC1&quot;, &quot;robustos HC3&quot;)) ## ## ========================================================================= ## sin ES robustos robustos HC0 robustos HC1 robustos HC3 ## ------------------------------------------------------------------------- ## (Intercept) 11.11 *** 11.11 *** 11.11 *** 11.11 *** ## (0.04) (0.04) (0.04) (0.04) ## sexMale 0.05 0.05 * 0.05 * 0.05 * ## (0.03) (0.02) (0.02) (0.02) ## yrs.since.phd 0.01 ** 0.01 * 0.01 * 0.01 * ## (0.00) (0.01) (0.01) (0.01) ## yrs.since.phd2 -0.00 ** -0.00 * -0.00 * -0.00 * ## (0.00) (0.00) (0.00) (0.00) ## rankAssocProf 0.09 * 0.09 ** 0.09 ** 0.09 ** ## (0.04) (0.03) (0.03) (0.03) ## rankProf 0.35 *** 0.35 *** 0.35 *** 0.35 *** ## (0.05) (0.04) (0.04) (0.04) ## disciplineB 0.13 *** 0.13 *** 0.13 *** 0.13 *** ## (0.02) (0.02) (0.02) (0.02) ## ------------------------------------------------------------------------- ## R^2 0.53 ## Adj. R^2 0.52 ## Num. obs. 397 ## ========================================================================= ## *** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05 ## Normalidad plot(logreg5,2) Outlyers plot(logreg5,5) "],["teoria-setmana-5.html", "Capítol 5 Teoria Setmana 5 5.1 Packages 5.2 Dades de intenció de vot 5.3 Exemple de Vtown data", " Capítol 5 Teoria Setmana 5 5.1 Packages install.packages(&quot;visreg&quot;) 5.2 Dades de intenció de vot Mostra aleatòria de mida n = 800 duna població Variables: despesa, renda, gènere (1/0, home = 1), vot (1/0, partit A = 1) library(foreign) data &lt;- read.spss(&quot;http://84.89.132.1/~satorra/dades/M2014dadesSIM.sav&quot;, to.data.frame = TRUE, use.value.labels = TRUE) dim(data) ## [1] 800 4 library(knitr) kable(head(head(data))) Lrenda Ldespeses Genere Vot 9.477 4.503 1 1 11.435 6.147 1 0 10.686 4.961 0 0 10.407 3.993 0 0 10.814 5.746 0 0 9.944 4.950 0 1 summary(head(data)) ## Lrenda Ldespeses Genere Vot ## Min. : 9.477 Min. :3.993 Min. :0.0000 Min. :0.0000 ## 1st Qu.:10.060 1st Qu.:4.615 1st Qu.:0.0000 1st Qu.:0.0000 ## Median :10.546 Median :4.955 Median :0.0000 Median :0.0000 ## Mean :10.460 Mean :5.050 Mean :0.3333 Mean :0.3333 ## 3rd Qu.:10.782 3rd Qu.:5.550 3rd Qu.:0.7500 3rd Qu.:0.7500 ## Max. :11.435 Max. :6.147 Max. :1.0000 Max. :1.0000 Sobserva un 33,3% en la intenció del vot del partit A. 5.2.1 La Regressió lineal Fins ara, Y era una variable continua. Ara la Y es binaria (pren valors 0 o 1). Segueix essent vàlida la regressió lineal? Veiem com quedaria la regressió lineal versus la loess. data %&gt;% ggplot(aes(Lrenda, Vot))+ geom_jitter(height =0.02)+ geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;))+ geom_smooth(method=&#39;loess&#39;, se=FALSE, formula = y~x, aes(color = &quot;loess&quot;)) Mirem ara el resum de la regressió lineal. re0 &lt;-lm(Vot ~ Lrenda, data=data) summary(re0) ## ## Call: ## lm(formula = Vot ~ Lrenda, data = data) ## ## Residuals: ## Min 1Q Median 3Q Max ## -1.10516 -0.39910 0.07352 0.37185 1.12443 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 2.89760 0.15615 18.56 &lt;2e-16 *** ## Lrenda -0.23403 0.01549 -15.11 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 0.4392 on 798 degrees of freedom ## Multiple R-squared: 0.2224, Adjusted R-squared: 0.2215 ## F-statistic: 228.3 on 1 and 798 DF, p-value: &lt; 2.2e-16 Problemes quan la Y es binaria: La relació es no-lineal Els termes derror són heteroscedàstics El terme derror no té distribució normal plot(re0,1) plot(re0,2) 5.2.2 La Regressió logística Lalternativa és el model de regressió logística: Suposem que \\(Y_{i} \\sim \\mbox{Bernoulli }(p_i)\\), \\(p_i = P(Y_i = 1), \\, i = 1, \\dots, n\\) Transformem: \\[p \\rightarrow odds(p) \\rightarrow Logit(p)\\] on \\(odds(p) = p/(1-p)\\), en català raó de probabilitats. \\(p \\rightarrow odds(p) \\equiv p /(1- p) \\rightarrow Logit(p) = \\ln \\, (odds (p)) = \\ln \\frac{p }{1 - p } \\leftrightarrow p = \\frac{1}{1 + e^{-L }}\\) Model lineal pel \\(L = Logit(p) = \\ln \\frac{p }{1 - p }\\): \\(L = \\beta_0 + \\beta_1 X_1 + \\beta_2 X_2 + \\beta_3 X_3\\) Model no-lineal per p, on: \\(p \\equiv E(Y \\mid X_1, X_2, X_3) = \\frac{1}{1 + e^{-( \\beta_0 + \\beta_1 X_1 + \\beta_2 X_2 + \\beta_3 X_3)}}\\) versus el model de regressió lineal clàssic que diu que \\(p = \\beta_0 + \\beta_1 X_1 + \\beta_2 X_2 + \\beta_3 X_3\\). Exemple: Y = Vot, X = Lrenda \\(P(Y = 1) = p = \\frac{1}{1 + e^{-L_i}} = \\frac{1}{1 + e^{- (\\alpha + \\beta * Lrenda)}}\\). re1&lt;-glm(Vot ~ Lrenda, data=data, family = &quot;binomial&quot;) summary(re1) ## ## Call: ## glm(formula = Vot ~ Lrenda, family = &quot;binomial&quot;, data = data) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -2.5206 -0.9692 0.4540 0.9087 2.5511 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) 12.389 1.027 12.07 &lt;2e-16 *** ## Lrenda -1.208 0.101 -11.96 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 1101.02 on 799 degrees of freedom ## Residual deviance: 900.73 on 798 degrees of freedom ## AIC: 904.73 ## ## Number of Fisher Scoring iterations: 4 re1 %&gt;% coef() ## (Intercept) Lrenda ## 12.388980 -1.208374 \\[P(Y = 1) = p = \\frac{1}{1 + e^{- (12.388980 - 1.208374 * Lrenda)}}\\] 5.2.3 Interpretació dels paràmetres re1 %&gt;% coef() %&gt;% exp() %&gt;% round(4) ## (Intercept) Lrenda ## 240140.5549 0.2987 \\(\\hat{L} = 12.388980 - 1.208374 * Lrenda\\) \\(exp(-1.208374 )= 0.2987 \\rightarrow 0.2987 - 1 = -0.7013 \\rightarrow odds(p)\\) Decreix un 70% en el canvi de x a X+1 (aproximadament duplicar ingressos ja que estan en escala log). \\((\\exp(\\beta) - 1)\\times100\\) =% daugment/decreixement dels odds 5.2.4 Lineal versus Logística data &lt;- data %&gt;% mutate( P_lm_Vot = 2.8975953 - 0.2340296 * Lrenda , P_glm_Vot = 1/(1+ exp(-(12.388980 - 1.208374 * Lrenda )))) %&gt;% arrange(Lrenda ) data %&gt;% select(P_glm_Vot,P_lm_Vot) %&gt;% summary() ## P_glm_Vot P_lm_Vot ## Min. :0.02833 Min. :-0.1864 ## 1st Qu.:0.36861 1st Qu.: 0.3939 ## Median :0.55061 Median : 0.5375 ## Mean :0.55000 Mean : 0.5500 ## 3rd Qu.:0.75337 3rd Qu.: 0.7145 ## Max. :0.97631 Max. : 1.2184 Observem valors poc desitjables negatius i per sobre de 1 en la variable P_lm_Vot. Veiem gràficament data %&gt;% ggplot(aes(Lrenda, Vot))+ geom_jitter(width = 0.15, height =0.05)+ geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;))+ geom_smooth(method=&#39;loess&#39;, se=FALSE, formula = y~x, aes(color = &quot;loess&quot;))+ geom_line(aes(y=P_glm_Vot,color = &quot;glm-logit&quot;))+ geom_hline(yintercept=c(0,1)) Observa com la corba obtinguda per la regressió logística (glm-logit) captura millor la tendència observada a través de la regressió Loess. Addicionalment la regressió logística defineix una asímptota respecte el 0 i l1 (sacosta, però no arriba a creuar mai). 5.2.5 Regressió logística amb covariants: Lrenda, gènere Ajustem un primer model. suppressPackageStartupMessages(library(stargazer)) #Lineal re2&lt;-lm(Vot ~ Lrenda + Genere, data=data) #Logística re3&lt;-glm(Vot ~ Lrenda + Genere, data=data, family = &quot;binomial&quot;) stargazer(re0,re1,re2, type = &quot;text&quot;) ## ## =============================================================================== ## Dependent variable: ## ----------------------------------------------------------- ## Vot ## OLS logistic OLS ## (1) (2) (3) ## ------------------------------------------------------------------------------- ## Lrenda -0.234*** -1.208*** -0.182*** ## (0.015) (0.101) (0.014) ## ## Genere 0.460*** ## (0.027) ## ## Constant 2.898*** 12.389*** 2.139*** ## (0.156) (1.027) (0.142) ## ## ------------------------------------------------------------------------------- ## Observations 800 800 800 ## R2 0.222 0.425 ## Adjusted R2 0.221 0.423 ## Log Likelihood -450.366 ## Akaike Inf. Crit. 904.732 ## Residual Std. Error 0.439 (df = 798) 0.378 (df = 797) ## F Statistic 228.283*** (df = 1; 798) 294.136*** (df = 2; 797) ## =============================================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 Els coeficients de la part lineal de la regressió logística. re3 %&gt;% coef() %&gt;% round(2) ## (Intercept) Lrenda Genere ## 12.30 -1.32 2.61 Interpretem els coeficients en termes de odds. re3 %&gt;% coef() %&gt;% exp() %&gt;% round(4) - 1 ## (Intercept) Lrenda Genere ## 218904.9754 -0.7339 12.6663 La renta, a igualtat de gènere, ha incrementat en termes absoluts el seu efecte en una disminució de 73% sobre els odds de la intenció de Vot al duplicar els ingressos Per altra banda, els homes tenen un 12% dincrement en els odds de la intenció de Vot que les dones, a igualtat dingressos. 5.2.6 Regressió logística amb covariants: gràfic defectes condicionats La funció visreg() ens resol la visualització del efecte de cada factor condicionat als valors fixes de la resta de variables (utilitza la mediana en numèriques o la moda en factors). En aquest cas veiem lefecte de la renta sobre la intenció de vot, condicionat al gènere. library(visreg) visreg(re3, &quot;Lrenda&quot;, by = &quot;Genere&quot;, band = TRUE, # viualitzem bandes gg = TRUE, # usem ggplot2 overlay=TRUE, # un mateix grafic scale=&quot;response&quot;) + labs(y = &quot;Prob(Vot)&quot;, x = &quot;Lrenda&quot;) Observem com els homes tenen una corba clarament per sobre. També, la variació de la intenció de vot es fa més pronunciada (mes pendent) en les dones en trams de rentes baixes que en homes (efecte no lineal). També podem retornar la variable de Renta a escala normal (Euros) transformant amb la exponencial. visreg(re2, &quot;Lrenda&quot;, by = &quot;Genere&quot;, xtrans = exp, band = TRUE, # viualitzem bandes gg = TRUE, # usem ggplot2 overlay=TRUE, # un mateix grafic scale=&quot;response&quot;) + labs(y = &quot;Prob(Vot)&quot;, x = &quot;Lrenda&quot;) El canvi descala accentua la interpretació anterior, es a dir, major variació en trams de rentes baixes en dones que en homes. Pots profunditzar en el paràmetres de visreg a lajuda: ?visreg # paràmetres dels càlculs. ?plot.visreg # paràmetres del gràfic. 5.3 Exemple de Vtown data La contaminació per residus tòxics en el terreny de dos escoles públiques. Algunes persones pensaven que lescola hauria destar tancada fins que el terreny fos declarat segur. Altres persones argumentaven que els costos no justificaven el risc i volien que es mantingués oberta lescola afectada. SCHOOL: Resposta si volien que lescola estigués tancada (CLOSE) o oberta (OPEN). GENDER: Gènere de lenquestat. LIVED: Anys de residencia al municipi. KIDS: Lenquestat té nens, o no. EDUC: Anys destudis de lenquestat. MEETINGS: Lenquestat ha anat als mítings sobre crisis provocada per la contaminació. CONTAM: Lenquestat creu que la seva propietat ha estat contaminada (o no). Motivació: llegir la noticia Exposició a contaminació de la mare i deficiència en pes (LBW) dels nadons Les dades. library(foreign) da &lt;- as.data.frame(read.spss(&quot;http://84.89.132.1/~satorra/dades/VtTown.sav&quot;, to.data.frame = TRUE)) head(da) ## ID GENDER LIVED KIDS EDUC MEETINGS CONTAM SCHOOL ## 1 1 MALE 35 YES 12 YES YES CLOSE ## 2 2 MALE 5 YES 14 YES NO CLOSE ## 3 3 MALE 21 NO 12 YES YES CLOSE ## 4 4 MALE 6 NO 16 NO NO OPEN ## 5 5 MALE 12 YES 18 NO NO OPEN ## 6 6 MALE 12 YES 16 NO NO OPEN da %&gt;% count(SCHOOL) ## SCHOOL n ## 1 OPEN 87 ## 2 CLOSE 66 da &lt;- da %&gt;% mutate(Y = as.numeric(SCHOOL) -1) da %&gt;% count(Y) ## Y n ## 1 0 87 ## 2 1 66 Lobjectiu és analitzar la propensió de la intenció de tancar lescola fins que no es confirmi que està des contaminada. reg1&lt;- glm(Y ~ LIVED + MEETINGS, binomial, data=da ) summary(reg1) ## ## Call: ## glm(formula = Y ~ LIVED + MEETINGS, family = binomial, data = da) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -2.0559 -0.8567 -0.5140 0.6189 2.3832 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -0.34850 0.31816 -1.095 0.27336 ## LIVED -0.03575 0.01355 -2.638 0.00833 ** ## MEETINGSYES 2.36882 0.44298 5.347 8.92e-08 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 209.21 on 152 degrees of freedom ## Residual deviance: 160.27 on 150 degrees of freedom ## AIC: 166.27 ## ## Number of Fisher Scoring iterations: 4 Gràficament, visreg(reg1, &quot;LIVED&quot;, by = &quot;MEETINGS&quot;, band = TRUE, # viualitzem bandes gg = TRUE, # usem ggplot2 overlay=TRUE, # un mateix grafic scale=&quot;response&quot;) + labs(y = &quot;Prob(Close)&quot;, x = &quot;LIVED&quot;) Definim un model complert amb un factor de interacció de GENDER y KIDS. da &lt;- da %&gt;% mutate(MALE = 1.0*(GENDER==&quot;MALE&quot;)) lreg2 &lt;- glm(Y ~ LIVED + EDUC+ CONTAM+MEETINGS+MALE+KIDS+ KIDS*MALE ,family=binomial, data= da) summary(lreg2) ## ## Call: ## glm(formula = Y ~ LIVED + EDUC + CONTAM + MEETINGS + MALE + KIDS + ## KIDS * MALE, family = binomial, data = da) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -2.6027 -0.7557 -0.3091 0.6316 2.3920 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) 2.84216 1.44277 1.970 0.04885 * ## LIVED -0.04664 0.01698 -2.748 0.00600 ** ## EDUC -0.20602 0.09320 -2.211 0.02706 * ## CONTAMYES 1.28208 0.48137 2.663 0.00774 ** ## MEETINGSYES 2.41800 0.50966 4.744 2.09e-06 *** ## MALE -2.17443 0.81906 -2.655 0.00794 ** ## KIDSYES -0.67062 0.56561 -1.186 0.23576 ## MALE:KIDSYES 2.22599 0.99911 2.228 0.02588 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 209.21 on 152 degrees of freedom ## Residual deviance: 141.05 on 145 degrees of freedom ## AIC: 157.05 ## ## Number of Fisher Scoring iterations: 5 da &lt;- da %&gt;% mutate(INTER = (1.0*(KIDS==&quot;NO&quot;))*MALE) lreg3 &lt;- glm(Y ~ LIVED + EDUC + CONTAM + MEETINGS+ INTER ,family=binomial, data= da) stargazer(lreg2, lreg3, type=&quot;text&quot;) ## ## ============================================== ## Dependent variable: ## ---------------------------- ## Y ## (1) (2) ## ---------------------------------------------- ## LIVED -0.047*** -0.040** ## (0.017) (0.015) ## ## EDUC -0.206** -0.197** ## (0.093) (0.093) ## ## CONTAMYES 1.282*** 1.299*** ## (0.481) (0.477) ## ## MEETINGSYES 2.418*** 2.279*** ## (0.510) (0.490) ## ## MALE -2.174*** ## (0.819) ## ## KIDSYES -0.671 ## (0.566) ## ## MALE:KIDSYES 2.226** ## (0.999) ## ## INTER -1.731** ## (0.725) ## ## Constant 2.842** 2.182 ## (1.443) (1.330) ## ## ---------------------------------------------- ## Observations 153 153 ## Log Likelihood -70.525 -71.326 ## Akaike Inf. Crit. 157.049 154.652 ## ============================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 Comparem lajust dels dos models. anova( lreg3, lreg2, test = &quot;Chisq&quot;) ## Analysis of Deviance Table ## ## Model 1: Y ~ LIVED + EDUC + CONTAM + MEETINGS + INTER ## Model 2: Y ~ LIVED + EDUC + CONTAM + MEETINGS + MALE + KIDS + KIDS * MALE ## Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi) ## 1 147 142.65 ## 2 145 141.05 2 1.6031 0.4486 Analitzem el canvi defecte dels anys de residencia condicionat a tenir (o no) nens, dins del grup dhomes. visreg(lreg2, &quot;LIVED&quot;, by = &quot;KIDS&quot;, cond=list(MALE=1), # condicionem a ser home band = TRUE, # viualitzem bandes gg = TRUE, # usem ggplot2 overlay=TRUE, # un mateix grafic scale=&quot;response&quot;) + labs(y = &quot;Prob(Close)&quot;, x = &quot;LIVED&quot;) 5.3.1 Anàlisis bivariant preliminar Fem un pas enrere. Com en el cas de la regressió lineal, abans de modelitzar, es interesant fer un breu anàlisis bivariant de les variables que es volen introduir en el model. Veiem un exemple a partir dels quantils de la variable LIVED . quantile(da$LIVED, seq(0,1,0.2)) ## 0% 20% 40% 60% 80% 100% ## 1.0 5.0 10.0 20.0 31.6 81.0 A partir del quantils de la variable podem definir una partició de la variable lived. da &lt;- da %&gt;% mutate(LIVED_T = cut(LIVED, c(-Inf, 5,10, 20, 32,Inf))) da %&gt;% count(LIVED_T) ## LIVED_T n ## 1 (-Inf,5] 40 ## 2 (5,10] 23 ## 3 (10,20] 33 ## 4 (20,32] 27 ## 5 (32, Inf] 30 Mirem-ho ara amb les freqüències relatives de cada fila. da %&gt;% group_by(LIVED_T) %&gt;% summarise(freq_absolutes = n() ,propensio = mean(Y)) ## # A tibble: 5 x 3 ## LIVED_T freq_absolutes propensio ## &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; ## 1 (-Inf,5] 40 0.6 ## 2 (5,10] 23 0.522 ## 3 (10,20] 33 0.394 ## 4 (20,32] 27 0.481 ## 5 (32, Inf] 30 0.133 Incorporem els intervals de confiança. Recorda que la desviació típica de una variable bernoulli(p) on p es la probabilitat de estar Indecís, val: \\[ stdDesv(Y ) = \\sqrt{p*q} \\] on q = 1- p. Per altra banda, lerror estàndard es calcula com: \\[ errStd(Y ) = \\sqrt{p*q / n} \\] on n es el nombre observacions. Daquesta forma, linterval de confiança (95%) es defineix com. \\[\\left[p - 1.96*\\sqrt{p*q / n}, p + 1.96*\\sqrt{p*q / n}\\right]\\] Ara en R. errStd_bin &lt;- function(x) { sqrt(mean(x)*(1-mean(x)) / length(x))} minInt_bin &lt;- function(x) { mean(x) - 1.96 *errStd_bin(x) } maxInt_bin &lt;- function(x) { mean(x) + 1.96 *errStd_bin(x) } RESUM &lt;- da %&gt;% group_by(LIVED_T) %&gt;% summarise(freq_absolutes = n() ,I_minim = minInt_bin(Y ) ,propensio = mean(Y ) ,I_maxim = maxInt_bin(Y )) %&gt;% mutate(freq_relatives = freq_absolutes / sum(freq_absolutes)) RESUM ## # A tibble: 5 x 6 ## LIVED_T freq_absolutes I_minim propensio I_maxim freq_relatives ## &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 (-Inf,5] 40 0.448 0.6 0.752 0.261 ## 2 (5,10] 23 0.318 0.522 0.726 0.150 ## 3 (10,20] 33 0.227 0.394 0.561 0.216 ## 4 (20,32] 27 0.293 0.481 0.670 0.176 ## 5 (32, Inf] 30 0.0117 0.133 0.255 0.196 Gràficament, suppressPackageStartupMessages(library(cowplot)) library(scales) p1 &lt;- RESUM %&gt;% ggplot(aes(LIVED_T, freq_relatives)) + geom_bar(stat=&quot;identity&quot;)+ geom_text(aes(label = freq_absolutes), vjust=1.6, color=&quot;white&quot;)+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Freqüencies&quot;) p2 &lt;- RESUM %&gt;% ggplot(aes(LIVED_T, propensio)) + geom_point(size = 1.5) + geom_errorbar(aes(ymin =I_minim, ymax = I_maxim, width = .2))+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Intervals confiança Indecisió&quot;) plot_grid(p1, p2, ncol=2) Mateix anàlisi, sobre la variable MEETINGS : RESUM &lt;- da %&gt;% group_by(MEETINGS ) %&gt;% summarise(freq_absolutes = n() ,I_minim = minInt_bin(Y ) ,propensio = mean(Y ) ,I_maxim = maxInt_bin(Y )) %&gt;% mutate(freq_relatives = freq_absolutes / sum(freq_absolutes)) p1 &lt;- RESUM %&gt;% ggplot(aes(MEETINGS , freq_relatives)) + geom_bar(stat=&quot;identity&quot;)+ geom_text(aes(label = freq_absolutes), vjust=1.6, color=&quot;white&quot;)+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Freqüencies&quot;) p2 &lt;- RESUM %&gt;% ggplot(aes(MEETINGS , propensio)) + geom_point(size = 1.5) + geom_errorbar(aes(ymin =I_minim, ymax = I_maxim, width = .2))+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Intervals confiança Indecisió&quot;) plot_grid(p1, p2, ncol=2) "],["teoria-setmana-6.html", "Capítol 6 Teoria Setmana 6 6.1 Packages 6.2 Barómetre (2021-01-29) 6.3 PCA - Anàlisis de Components principals 6.4 Analisis Factorial amb dades omeses", " Capítol 6 Teoria Setmana 6 6.1 Packages install.packages(&quot;VIM&quot;) 6.2 Barómetre (2021-01-29) Anàlisis de la enquesta preelectoral. Perfil de votant al PSC segons la variable de intenció de vot. library(foreign) suppressPackageStartupMessages(library(tidyverse)) library(cowplot) library(visreg) library(scales) data &lt;- read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, to.data.frame = TRUE, use.value.labels = TRUE) data &lt;- data %&gt;% select(P15R,PROVINCIA,HABITAT,SEXE,EDAT,P38) dim(data) ## [1] 1100 6 Les variables seleccionades: P15R: En les eleccions al Parlament de Catalunya, convocades pel proper 14 de febrer - a quin partit o coalició votarà? (Agrupació partits) PROVINCIA HABITAT SEXE EDAT P38: Sumant els ingressos nets mensuals de totes les persones de la seva llar, - aproximadament, quins són els ingressos familiars que entren cada mes a casa seva Veiem les freqüències de intenció de vot a cada partit. table(data$P15R) ## ## PPC ERC PSC C&#39;s CUP ## 14 165 116 18 42 ## PDeCAT Junts per Catalunya Catalunya en Comú Podem Vox Altres, blanc ## 11 93 49 10 28 ## Nul No votaria NS/NC ## 4 71 479 data$Vot &lt;- as.numeric(data$P15R == &quot;PSC&quot;) summary(data$Vot) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 0.0000 0.0000 0.0000 0.1055 0.0000 1.0000 Sobserva un 10,6% en la intenció del vot del PSC. 6.2.1 Anàlisis univariant y bivariant Carreguem funcions per establir els intervals de confiança basats en lerror estàndard. errStd_bin &lt;- function(x) { sqrt(mean(x)*(1-mean(x)) / length(x))} minInt_bin &lt;- function(x) { mean(x) - 1.96 *errStd_bin(x) } maxInt_bin &lt;- function(x) { mean(x) + 1.96 *errStd_bin(x) } 6.2.1.1 PROVINCIA RESUM &lt;- data %&gt;% group_by(PROVINCIA ) %&gt;% summarise(freq_absolutes = n() ,I_minim = minInt_bin(Vot ) ,propensio = mean(Vot ) ,I_maxim = maxInt_bin(Vot )) %&gt;% mutate(freq_relatives = freq_absolutes / sum(freq_absolutes)) p1 &lt;- RESUM %&gt;% ggplot(aes(PROVINCIA , freq_relatives)) + geom_bar(stat=&quot;identity&quot;)+ geom_text(aes(label = freq_absolutes), vjust=1.6, color=&quot;white&quot;)+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Freqüencies&quot;) p2 &lt;- RESUM %&gt;% ggplot(aes(PROVINCIA , propensio)) + geom_point(size = 1.5) + geom_errorbar(aes(ymin =I_minim, ymax = I_maxim, width = .2))+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Intervals confiança Indecisió&quot;) plot_grid(p1, p2, ncol=2) 6.2.1.2 HABITAT RESUM &lt;- data %&gt;% group_by(HABITAT ) %&gt;% summarise(freq_absolutes = n() ,I_minim = minInt_bin(Vot ) ,propensio = mean(Vot ) ,I_maxim = maxInt_bin(Vot )) %&gt;% mutate(freq_relatives = freq_absolutes / sum(freq_absolutes)) p1 &lt;- RESUM %&gt;% ggplot(aes(HABITAT , freq_relatives)) + geom_bar(stat=&quot;identity&quot;)+ geom_text(aes(label = freq_absolutes), vjust=1.6, color=&quot;white&quot;)+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Freqüencies&quot;) p2 &lt;- RESUM %&gt;% ggplot(aes(HABITAT , propensio)) + geom_point(size = 1.5) + geom_errorbar(aes(ymin =I_minim, ymax = I_maxim, width = .2))+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Intervals confiança Indecisió&quot;) plot_grid(p1, p2, ncol=2) data &lt;- data %&gt;% mutate(HABITAT_R = as.factor(ifelse(as.numeric(HABITAT)&lt;=2,&quot;3-Petita&quot;, ifelse(as.numeric(HABITAT)&lt;=4,&quot;2-Mitjana&quot;, &quot;1-Gran&quot;)))) RESUM &lt;- data %&gt;% group_by(HABITAT_R ) %&gt;% summarise(freq_absolutes = n() ,I_minim = minInt_bin(Vot ) ,propensio = mean(Vot ) ,I_maxim = maxInt_bin(Vot )) %&gt;% mutate(freq_relatives = freq_absolutes / sum(freq_absolutes)) p1 &lt;- RESUM %&gt;% ggplot(aes(HABITAT_R , freq_relatives)) + geom_bar(stat=&quot;identity&quot;)+ geom_text(aes(label = freq_absolutes), vjust=1.6, color=&quot;white&quot;)+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Freqüencies&quot;) p2 &lt;- RESUM %&gt;% ggplot(aes(HABITAT_R , propensio)) + geom_point(size = 1.5) + geom_errorbar(aes(ymin =I_minim, ymax = I_maxim, width = .2))+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Intervals confiança Indecisió&quot;) plot_grid(p1, p2, ncol=2) 6.2.1.3 SEXE RESUM &lt;- data %&gt;% group_by(SEXE ) %&gt;% summarise(freq_absolutes = n() ,I_minim = minInt_bin(Vot ) ,propensio = mean(Vot ) ,I_maxim = maxInt_bin(Vot )) %&gt;% mutate(freq_relatives = freq_absolutes / sum(freq_absolutes)) p1 &lt;- RESUM %&gt;% ggplot(aes(SEXE , freq_relatives)) + geom_bar(stat=&quot;identity&quot;)+ geom_text(aes(label = freq_absolutes), vjust=1.6, color=&quot;white&quot;)+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Freqüencies&quot;) p2 &lt;- RESUM %&gt;% ggplot(aes(SEXE , propensio)) + geom_point(size = 1.5) + geom_errorbar(aes(ymin =I_minim, ymax = I_maxim, width = .2))+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Intervals confiança Indecisió&quot;) plot_grid(p1, p2, ncol=2) 6.2.1.4 EDAT summary(data$EDAT) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 18.00 38.00 51.00 51.08 65.00 98.00 data &lt;- data %&gt;% mutate(EDAT_R = cut(EDAT,c(18,seq(25,85,10),100),include.lowest=TRUE)) RESUM &lt;- data %&gt;% group_by(EDAT_R ) %&gt;% summarise(freq_absolutes = n() ,I_minim = minInt_bin(Vot ) ,propensio = mean(Vot ) ,I_maxim = maxInt_bin(Vot )) %&gt;% mutate(freq_relatives = freq_absolutes / sum(freq_absolutes)) p1 &lt;- RESUM %&gt;% ggplot(aes(EDAT_R , freq_relatives)) + geom_bar(stat=&quot;identity&quot;)+ geom_text(aes(label = freq_absolutes), vjust=1.6, color=&quot;white&quot;)+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Freqüencies&quot;) p2 &lt;- RESUM %&gt;% ggplot(aes(EDAT_R , propensio)) + geom_point(size = 1.5) + geom_errorbar(aes(ymin =I_minim, ymax = I_maxim, width = .2))+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Intervals confiança Indecisió&quot;) plot_grid(p1, p2, ncol=2) 6.2.1.5 P38 RESUM &lt;- data %&gt;% group_by(P38 ) %&gt;% summarise(freq_absolutes = n() ,I_minim = minInt_bin(Vot ) ,propensio = mean(Vot ) ,I_maxim = maxInt_bin(Vot )) %&gt;% mutate(freq_relatives = freq_absolutes / sum(freq_absolutes)) p1 &lt;- RESUM %&gt;% ggplot(aes(P38 , freq_relatives)) + geom_bar(stat=&quot;identity&quot;)+ geom_text(aes(label = freq_absolutes), vjust=1.6, color=&quot;white&quot;)+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Freqüencies&quot;) p2 &lt;- RESUM %&gt;% ggplot(aes(P38 , propensio)) + geom_point(size = 1.5) + geom_errorbar(aes(ymin =I_minim, ymax = I_maxim, width = .2))+ scale_y_continuous(labels = percent)+ theme_minimal()+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+ labs(title=&quot;Intervals confiança Indecisió&quot;) plot_grid(p1, p2, ncol=2) data$INGRES &lt;- 500 data$INGRES[as.numeric(data$P38)==2] &lt;- 1500 data$INGRES[as.numeric(data$P38)==3] &lt;- 2500 data$INGRES[as.numeric(data$P38)==4] &lt;- 3500 data$INGRES[as.numeric(data$P38)==5] &lt;- 4500 data$INGRES[as.numeric(data$P38)==6] &lt;- 5500 data$INGRES[data$P38==&quot;No ho sap&quot;] &lt;- 2500 data$INGRES[data$P38==&quot;No contesta&quot;] &lt;- 2500 data$INGRES_NSNC &lt;- &quot;1-Contesta&quot; data$INGRES_NSNC[data$P38==&quot;No ho sap&quot;] &lt;- &quot;2-No ho sap&quot; data$INGRES_NSNC[data$P38==&quot;No contesta&quot;] &lt;- &quot;3-No contesta&quot; 6.2.2 lreg1 &lt;- glm(Vot ~ PROVINCIA + HABITAT_R + SEXE + EDAT + log(INGRES) + INGRES_NSNC, family=binomial, data= data) summary(lreg1) ## ## Call: ## glm(formula = Vot ~ PROVINCIA + HABITAT_R + SEXE + EDAT + log(INGRES) + ## INGRES_NSNC, family = binomial, data = data) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -0.8683 -0.5224 -0.4229 -0.3362 2.5494 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -1.386826 1.376850 -1.007 0.31382 ## PROVINCIAGIRONA -0.848774 0.539140 -1.574 0.11542 ## PROVINCIALLEIDA -0.284928 0.506240 -0.563 0.57355 ## PROVINCIATARRAGONA -0.048425 0.355967 -0.136 0.89179 ## HABITAT_R2-Mitjana 0.462629 0.230201 2.010 0.04447 * ## HABITAT_R3-Petita -0.402917 0.374768 -1.075 0.28233 ## SEXEDona -0.055966 0.203841 -0.275 0.78366 ## EDAT 0.019331 0.006106 3.166 0.00155 ** ## log(INGRES) -0.238617 0.164638 -1.449 0.14724 ## INGRES_NSNC2-No ho sap -0.160915 0.546105 -0.295 0.76825 ## INGRES_NSNC3-No contesta -0.515066 0.354438 -1.453 0.14617 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 741.19 on 1099 degrees of freedom ## Residual deviance: 710.51 on 1089 degrees of freedom ## AIC: 732.51 ## ## Number of Fisher Scoring iterations: 5 100*(exp(coef(lreg1)) -1 ) ## (Intercept) PROVINCIAGIRONA PROVINCIALLEIDA PROVINCIATARRAGONA HABITAT_R2-Mitjana ## -75.013286 -57.206062 -24.793186 -4.727075 58.824328 ## HABITAT_R3-Petita SEXEDona EDAT log(INGRES) INGRES_NSNC2-No ho sap ## -33.163210 -5.442899 1.951906 -21.228365 -14.863541 ## INGRES_NSNC3-No contesta ## -40.253907 6.2.3 Regressió logística amb covariants: gràfic defectes condicionats visreg(lreg1, &quot;EDAT&quot;, by = &quot;HABITAT_R&quot;, cond=list(INGRES =500,SEXE=&quot;Home&quot;,PROVINCIA=&quot;BARCELONA&quot;), # condicionem a ser home band = TRUE, # viualitzem bandes gg = TRUE, # usem ggplot2 overlay=TRUE, # un mateix grafic scale=&quot;response&quot;) + labs(y = &quot;Prob(Vot)&quot;, x = &quot;EDAT&quot;) Observem com els homes, de Barcelona, amb ingressos nets mensuals de la llar igual a 500, en poblacions mitjanes, tenen una corba de probabilitat de Vots al PSC superior als altres mides dhàbitat 6.3 PCA - Anàlisis de Components principals d &lt;- read.csv(&quot;www/data/mesa2021.csv&quot;, fileEncoding = &quot;utf-8&quot;) dim(d) ## [1] 9139 67 d&lt;- d %&gt;% mutate(N_PSC=Vots.PARTIT.DELS.SOCIALISTES.DE.CATALUNYA..PSC.PSOE...PSC. ,N_ERC=Vots.ESQUERRA.REPUBLICANA.DE.CATALUNYA..ERC. ,N_JxCat=Vots.JUNTS.PER.CATALUNYA..JxCat. ,N_VOX=Vots.VOX..VOX. ,N_CUP=Vots.CANDIDATURA.D.UNITAT.POPULAR.UN.NOU.CICLE.PER.GUANYAR..CUP.G. ,N_COMUNS=Vots.EN.COMÚ.PODEM.PODEM.EN.COMÚ..ECP.PEC. ,N_Cs=Vots.CIUTADANS...PARTIDO.DE.LA.CIUDADANÍA..Cs. ,N_PP=Vots.PARTIT.POPULAR.PARTIDO.POPULAR..PP. ,N_TOT = N_PSC + N_ERC + N_JxCat + N_VOX + N_CUP + N_COMUNS + N_Cs + N_PP ,municipi=Nom.municipi,comarca=Nom.comarca) dmesa&lt;-d %&gt;% filter(N_TOT&gt;0) %&gt;% mutate(PSC = N_PSC / N_TOT ,ERC = N_ERC / N_TOT ,JxCat = N_JxCat / N_TOT ,VOX = N_VOX / N_TOT ,CUP = N_CUP / N_TOT ,COMUNS = N_COMUNS / N_TOT ,Cs = N_Cs / N_TOT ,PP = N_PP / N_TOT ) %&gt;% select(Districte,Secció,Mesa,municipi,comarca,PSC,ERC,JxCat,VOX,CUP,COMUNS,Cs,PP) dmun &lt;- d %&gt;% filter(N_TOT&gt;0) %&gt;% group_by(municipi,comarca) %&gt;% summarise(PSC = sum(N_PSC) / sum(N_TOT) ,ERC = sum(N_ERC) / sum(N_TOT) ,JxCat = sum(N_JxCat) / sum(N_TOT) ,VOX = sum(N_VOX) / sum(N_TOT) ,CUP = sum(N_CUP) / sum(N_TOT) ,COMUNS = sum(N_COMUNS) / sum(N_TOT) ,Cs = sum(N_Cs) / sum(N_TOT) ,PP = sum(N_PP) / sum(N_TOT) ) %&gt;% ungroup() dcom &lt;- d %&gt;% filter(N_TOT&gt;0) %&gt;% group_by(comarca) %&gt;% summarise(PSC = sum(N_PSC) / sum(N_TOT) ,ERC = sum(N_ERC) / sum(N_TOT) ,JxCat = sum(N_JxCat) / sum(N_TOT) ,VOX = sum(N_VOX) / sum(N_TOT) ,CUP = sum(N_CUP) / sum(N_TOT) ,COMUNS = sum(N_COMUNS) / sum(N_TOT) ,Cs = sum(N_Cs) / sum(N_TOT) ,PP = sum(N_PP) / sum(N_TOT) ) %&gt;% ungroup() dim(dmesa) ## [1] 9139 13 head(dmesa) ## Districte Secció Mesa municipi comarca PSC ERC JxCat VOX CUP COMUNS Cs ## 1 1 1 A Abrera Baix Llobregat 0.3015075 0.2361809 0.10050251 0.07537688 0.06532663 0.10552764 0.07537688 ## 2 1 1 B Abrera Baix Llobregat 0.3898305 0.1807910 0.07344633 0.07344633 0.02259887 0.12994350 0.10734463 ## 3 1 1 C Abrera Baix Llobregat 0.2949309 0.2534562 0.07373272 0.11520737 0.05529954 0.07834101 0.08294931 ## 4 1 2 A Abrera Baix Llobregat 0.3594470 0.2119816 0.12903226 0.10138249 0.03225806 0.06451613 0.04608295 ## 5 1 2 B Abrera Baix Llobregat 0.4136364 0.1590909 0.05909091 0.09545455 0.03181818 0.10454545 0.07727273 ## 6 1 2 C Abrera Baix Llobregat 0.3756098 0.2097561 0.06341463 0.09756098 0.01951220 0.11219512 0.10243902 ## PP ## 1 0.04020101 ## 2 0.02259887 ## 3 0.04608295 ## 4 0.05529954 ## 5 0.05909091 ## 6 0.01951220 X_mesa &lt;- dmesa %&gt;% select(PSC,ERC,JxCat,VOX,CUP,COMUNS,Cs,PP) %&gt;% scale() head(X_mesa) ## PSC ERC JxCat VOX CUP COMUNS Cs PP ## [1,] 0.4798992 0.1872116 -0.8357312 -0.1714520 -0.09972564 0.9452201 0.5237459 -0.001549926 ## [2,] 1.2818016 -0.6216485 -1.0546477 -0.2135402 -1.15370367 1.6421690 1.5415819 -0.626328468 ## [3,] 0.4201883 0.4394833 -1.0523304 0.6968941 -0.34706685 0.1691800 0.7648478 0.207226599 ## [4,] 1.0059435 -0.1661717 -0.6048918 0.3954972 -0.91543754 -0.2254502 -0.4089574 0.534364619 ## [5,] 1.4979398 -0.9385347 -1.1708000 0.2662619 -0.92628825 0.9171837 0.5841085 0.668937304 ## [6,] 1.1526885 -0.1986702 -1.1358159 0.3121843 -1.22984357 1.1355429 1.3853900 -0.735888375 round(cov(X_mesa),3) ## PSC ERC JxCat VOX CUP COMUNS Cs PP ## PSC 1.000 -0.636 -0.880 0.560 -0.679 0.465 0.642 0.269 ## ERC -0.636 1.000 0.444 -0.562 0.418 -0.327 -0.607 -0.494 ## JxCat -0.880 0.444 1.000 -0.641 0.601 -0.577 -0.705 -0.343 ## VOX 0.560 -0.562 -0.641 1.000 -0.636 0.120 0.623 0.431 ## CUP -0.679 0.418 0.601 -0.636 1.000 -0.217 -0.643 -0.414 ## COMUNS 0.465 -0.327 -0.577 0.120 -0.217 1.000 0.315 0.027 ## Cs 0.642 -0.607 -0.705 0.623 -0.643 0.315 1.000 0.461 ## PP 0.269 -0.494 -0.343 0.431 -0.414 0.027 0.461 1.000 pca_mesa &lt;- princomp(X_mesa) summary(pca_mesa) ## Importance of components: ## Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7 Comp.8 ## Standard deviation 2.1382945 1.0874848 0.84995171 0.71172482 0.60738263 0.57990364 0.55679971 1.703416e-08 ## Proportion of Variance 0.5716005 0.1478441 0.09031212 0.06332596 0.04611925 0.04204063 0.03875748 3.627428e-17 ## Cumulative Proportion 0.5716005 0.7194446 0.80975668 0.87308264 0.91920189 0.96124252 1.00000000 1.000000e+00 attributes(pca_mesa) ## $names ## [1] &quot;sdev&quot; &quot;loadings&quot; &quot;center&quot; &quot;scale&quot; &quot;n.obs&quot; &quot;scores&quot; &quot;call&quot; ## ## $class ## [1] &quot;princomp&quot; Z &lt;- pca_mesa$scores head(Z) ## Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7 Comp.8 ## [1,] 0.8665642 1.0070506 -0.06690843 -0.52329933 -0.1046999 -0.2737614 0.2039157 -3.053113e-16 ## [2,] 2.3363692 1.7464017 0.15773682 -0.02917238 0.8176058 -0.8564416 -0.2182054 1.665335e-16 ## [3,] 1.2282605 0.1575983 0.65913566 -0.50013781 -0.6020300 -0.2846055 0.2797815 3.330669e-16 ## [4,] 1.1250577 -0.2502562 0.49254384 -0.21954622 0.3997918 1.0098184 0.3236403 -8.187895e-16 ## [5,] 2.4677055 0.5828516 -0.28712250 -0.17836744 0.4988533 0.4020623 0.3165207 -9.020562e-16 ## [6,] 2.1867538 1.3674877 0.81059413 -0.02288879 0.4167371 -0.6999940 -0.2129415 1.942890e-16 round(cov(Z),3) ## Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7 Comp.8 ## Comp.1 4.573 0.000 0.000 0.000 0.000 0.000 0.00 0 ## Comp.2 0.000 1.183 0.000 0.000 0.000 0.000 0.00 0 ## Comp.3 0.000 0.000 0.722 0.000 0.000 0.000 0.00 0 ## Comp.4 0.000 0.000 0.000 0.507 0.000 0.000 0.00 0 ## Comp.5 0.000 0.000 0.000 0.000 0.369 0.000 0.00 0 ## Comp.6 0.000 0.000 0.000 0.000 0.000 0.336 0.00 0 ## Comp.7 0.000 0.000 0.000 0.000 0.000 0.000 0.31 0 ## Comp.8 0.000 0.000 0.000 0.000 0.000 0.000 0.00 0 6.3.1 Components Principals: gràfics dindividus, variables plot(pca_mesa$scores[,1:2], pch =&quot;.&quot;, main =&quot;Gràfic de meses&quot;) biplot(pca_mesa, cex=0.7, col=c(&quot;grey&quot;,&quot;red&quot;)) library(FactoMineR) respca_mesa &lt;- PCA(X_mesa, graph=FALSE) summary(respca_mesa) ## ## Call: ## PCA(X = X_mesa, graph = FALSE) ## ## ## Eigenvalues ## Dim.1 Dim.2 Dim.3 Dim.4 Dim.5 Dim.6 Dim.7 Dim.8 ## Variance 4.573 1.183 0.722 0.507 0.369 0.336 0.310 0.000 ## % of var. 57.160 14.784 9.031 6.333 4.612 4.204 3.876 0.000 ## Cumulative % of var. 57.160 71.944 80.976 87.308 91.920 96.124 100.000 100.000 ## ## Individuals (the 10 first) ## Dist Dim.1 ctr cos2 Dim.2 ctr cos2 Dim.3 ctr cos2 ## 1 | 1.473 | 0.867 0.002 0.346 | 1.007 0.009 0.467 | 0.067 0.000 0.002 | ## 2 | 3.160 | 2.336 0.013 0.547 | 1.746 0.028 0.305 | -0.158 0.000 0.002 | ## 3 | 1.655 | 1.228 0.004 0.551 | 0.158 0.000 0.009 | -0.659 0.007 0.159 | ## 4 | 1.704 | 1.125 0.003 0.436 | -0.250 0.001 0.022 | -0.493 0.004 0.084 | ## 5 | 2.656 | 2.468 0.015 0.863 | 0.583 0.003 0.048 | 0.287 0.001 0.012 | ## 6 | 2.832 | 2.187 0.011 0.596 | 1.368 0.017 0.233 | -0.811 0.010 0.082 | ## 7 | 1.853 | 1.516 0.005 0.669 | 0.494 0.002 0.071 | -0.579 0.005 0.098 | ## 8 | 2.120 | 1.125 0.003 0.282 | 1.519 0.021 0.514 | -0.817 0.010 0.149 | ## 9 | 2.081 | 1.794 0.008 0.744 | -0.930 0.008 0.200 | -0.106 0.000 0.003 | ## 10 | 3.078 | 2.796 0.019 0.825 | -0.603 0.003 0.038 | -0.581 0.005 0.036 | ## ## Variables ## Dim.1 ctr cos2 Dim.2 ctr cos2 Dim.3 ctr cos2 ## PSC | 0.877 16.804 0.768 | 0.256 5.524 0.065 | -0.123 2.099 0.015 | ## ERC | -0.744 12.107 0.554 | 0.143 1.718 0.020 | -0.449 27.900 0.202 | ## JxCat | -0.878 16.851 0.771 | -0.302 7.730 0.091 | 0.138 2.627 0.019 | ## VOX | 0.782 13.381 0.612 | -0.291 7.158 0.085 | -0.240 8.000 0.058 | ## CUP | -0.786 13.509 0.618 | 0.145 1.781 0.021 | 0.375 19.478 0.141 | ## COMUNS | 0.477 4.969 0.227 | 0.745 46.976 0.556 | 0.339 15.888 0.115 | ## Cs | 0.848 15.725 0.719 | -0.091 0.702 0.008 | -0.016 0.034 0.000 | ## PP | 0.552 6.655 0.304 | -0.580 28.411 0.336 | 0.416 23.974 0.173 | plot(respca_mesa,choix=&quot;ind&quot;, cex=.1) plot(respca_mesa,choix=&quot;var&quot;) 6.3.1.1 Muncipi X_mun &lt;- dmun %&gt;% select(PSC,ERC,JxCat,VOX,CUP,COMUNS,Cs,PP) %&gt;% scale() head(X_mun) ## PSC ERC JxCat VOX CUP COMUNS Cs PP ## [1,] -1.0680025 -0.1951766 1.2652455 -1.26203775 0.8570902 -0.3219951 -0.5406946 -1.15890625 ## [2,] 2.5592264 -1.0298304 -2.0999427 1.66838562 -1.2687628 1.7333943 2.4578172 0.65668030 ## [3,] -0.3023732 0.2965304 0.3265143 -0.45103561 0.3688814 -0.9039498 -0.1663473 -0.46674009 ## [4,] -0.3624323 0.5467015 0.5774023 -0.05130109 -0.9667080 -0.7251911 -0.2552742 0.02885896 ## [5,] -1.1867827 -1.2967095 0.9280739 -0.43047329 2.8021293 -1.0867382 -0.6788765 -0.52016231 ## [6,] -0.5559249 0.3756069 -0.2751672 -0.05149017 1.0593011 0.1636361 0.4630548 -0.88542106 respca_mun &lt;- PCA(X_mun, graph=FALSE) summary(respca_mun) ## ## Call: ## PCA(X = X_mun, graph = FALSE) ## ## ## Eigenvalues ## Dim.1 Dim.2 Dim.3 Dim.4 Dim.5 Dim.6 Dim.7 Dim.8 ## Variance 4.073 1.110 1.022 0.738 0.498 0.296 0.261 0.000 ## % of var. 50.914 13.880 12.775 9.231 6.231 3.706 3.262 0.000 ## Cumulative % of var. 50.914 64.795 77.569 86.800 93.032 96.738 100.000 100.000 ## ## Individuals (the 10 first) ## Dist Dim.1 ctr cos2 Dim.2 ctr cos2 Dim.3 ctr cos2 ## 1 | 2.618 | -2.365 0.145 0.816 | 0.864 0.071 0.109 | 0.295 0.009 0.013 | ## 2 | 5.091 | 4.994 0.647 0.962 | 0.234 0.005 0.002 | 0.676 0.047 0.018 | ## 3 | 1.300 | -1.078 0.030 0.688 | -0.185 0.003 0.020 | -0.189 0.004 0.021 | ## 4 | 1.515 | -0.554 0.008 0.134 | -0.808 0.062 0.285 | -0.966 0.096 0.407 | ## 5 | 3.730 | -2.397 0.149 0.413 | 2.182 0.453 0.342 | 0.044 0.000 0.000 | ## 6 | 1.637 | -0.525 0.007 0.103 | 0.160 0.002 0.010 | 1.079 0.120 0.435 | ## 7 | 0.563 | -0.391 0.004 0.483 | -0.236 0.005 0.176 | 0.208 0.004 0.136 | ## 8 | 1.429 | 0.326 0.003 0.052 | 0.278 0.007 0.038 | 1.351 0.189 0.894 | ## 9 | 1.803 | -0.956 0.024 0.282 | 1.130 0.121 0.393 | -0.715 0.053 0.157 | ## 10 | 5.334 | 1.634 0.069 0.094 | -1.846 0.324 0.120 | -2.541 0.667 0.227 | ## ## Variables ## Dim.1 ctr cos2 Dim.2 ctr cos2 Dim.3 ctr cos2 ## PSC | 0.899 19.850 0.809 | -0.040 0.143 0.002 | 0.096 0.899 0.009 | ## ERC | -0.379 3.522 0.143 | -0.886 70.691 0.785 | 0.240 5.645 0.058 | ## JxCat | -0.808 16.030 0.653 | 0.323 9.397 0.104 | -0.385 14.487 0.148 | ## VOX | 0.843 17.452 0.711 | 0.021 0.040 0.000 | -0.179 3.148 0.032 | ## CUP | -0.580 8.257 0.336 | 0.385 13.349 0.148 | 0.416 16.953 0.173 | ## COMUNS | 0.586 8.444 0.344 | 0.233 4.868 0.054 | 0.622 37.898 0.387 | ## Cs | 0.881 19.074 0.777 | 0.092 0.754 0.008 | -0.029 0.081 0.001 | ## PP | 0.548 7.370 0.300 | -0.092 0.757 0.008 | -0.462 20.890 0.213 | plot(respca_mun,choix=&quot;ind&quot;, cex=.1) plot(respca_mun,choix=&quot;var&quot;) 6.3.1.2 Comarca X_com &lt;- dcom %&gt;% select(PSC,ERC,JxCat,VOX,CUP,COMUNS,Cs,PP) %&gt;% scale() rownames(X_com) &lt;- dcom$comarca head(X_com) ## PSC ERC JxCat VOX CUP COMUNS Cs PP ## Alt Camp -0.30529296 0.03487542 0.14640166 0.007228997 0.80049453 -0.5813202 -0.1443124 -0.250631053 ## Alt Empordà -0.09770661 -0.64734071 0.05648827 1.373011952 -0.40492332 -0.2892842 0.3400093 0.003287255 ## Alt Penedès 0.14134786 0.04363951 -0.21651018 -0.264979516 0.51303786 0.7393680 -0.1767673 -0.540350173 ## Alt Urgell -0.07388738 0.44769451 0.18154376 -0.702539940 0.06202996 -0.2619583 -0.4231937 -0.019771562 ## Alta Ribagorça 0.92177215 -0.17791455 -0.58775659 -0.715421696 0.54807874 1.2315719 -0.7777302 0.220674650 ## Anoia 0.80305793 -0.44960062 -0.66918617 0.527041929 -0.39030468 0.5181311 0.7270414 -0.014375275 respca_com &lt;- PCA(X_com, graph=FALSE) summary(respca_com) ## ## Call: ## PCA(X = X_com, graph = FALSE) ## ## ## Eigenvalues ## Dim.1 Dim.2 Dim.3 Dim.4 Dim.5 Dim.6 Dim.7 Dim.8 ## Variance 6.119 0.779 0.568 0.278 0.150 0.066 0.040 0.000 ## % of var. 76.487 9.735 7.105 3.472 1.880 0.826 0.495 0.000 ## Cumulative % of var. 76.487 86.222 93.327 96.799 98.679 99.505 100.000 100.000 ## ## Individuals (the 10 first) ## Dist Dim.1 ctr cos2 Dim.2 ctr cos2 Dim.3 ctr cos2 ## Alt Camp | 1.099 | -0.798 0.248 0.528 | -0.195 0.116 0.031 | -0.210 0.185 0.037 | ## Alt Empordà | 1.657 | 0.819 0.261 0.244 | -0.363 0.402 0.048 | -1.090 4.978 0.433 | ## Alt Penedès | 1.142 | -0.161 0.010 0.020 | -0.398 0.484 0.122 | 1.031 4.450 0.815 | ## Alt Urgell | 1.004 | -0.772 0.232 0.590 | 0.363 0.404 0.131 | 0.192 0.155 0.037 | ## Alta Ribagorça | 2.077 | 0.356 0.049 0.029 | -0.261 0.209 0.016 | 1.619 10.984 0.608 | ## Anoia | 1.607 | 1.484 0.857 0.852 | -0.266 0.216 0.027 | 0.266 0.297 0.027 | ## Aran | 6.235 | 5.908 13.581 0.898 | 0.092 0.026 0.000 | -1.711 12.259 0.075 | ## Bages | 0.564 | -0.138 0.007 0.060 | -0.311 0.295 0.303 | 0.201 0.170 0.127 | ## Baix Camp | 2.416 | 2.153 1.804 0.794 | 0.191 0.111 0.006 | -0.828 2.875 0.118 | ## Baix Ebre | 2.012 | -0.069 0.002 0.001 | 1.580 7.637 0.617 | 0.902 3.410 0.201 | ## ## Variables ## Dim.1 ctr cos2 Dim.2 ctr cos2 Dim.3 ctr cos2 ## PSC | 0.967 15.298 0.936 | -0.061 0.478 0.004 | 0.154 4.148 0.024 | ## ERC | -0.682 7.609 0.466 | 0.691 61.251 0.477 | 0.212 7.927 0.045 | ## JxCat | -0.908 13.473 0.824 | -0.280 10.095 0.079 | -0.256 11.573 0.066 | ## VOX | 0.924 13.966 0.855 | 0.015 0.027 0.000 | -0.286 14.429 0.082 | ## CUP | -0.844 11.650 0.713 | -0.252 8.148 0.063 | 0.205 7.395 0.042 | ## COMUNS | 0.823 11.070 0.677 | -0.175 3.921 0.031 | 0.516 46.857 0.266 | ## Cs | 0.968 15.329 0.938 | -0.097 1.196 0.009 | -0.056 0.544 0.003 | ## PP | 0.843 11.606 0.710 | 0.340 14.885 0.116 | -0.201 7.128 0.041 | plot(respca_com,choix=&quot;ind&quot;, cex=.7) plot(respca_com,choix=&quot;var&quot;) 6.3.2 Barómetre (2021-01-29) Valoració candiadts. data &lt;- read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, to.data.frame = TRUE, use.value.labels = TRUE) ## re-encoding from UTF-8 ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 18, 68, ## 73, 98, 138, 144, 181, 237, 430, 491, 614, 629, 645, 659, 670, 690, 695, 777, 810, 813, 827, 828, 830, 848, 850, 851, 852, 853, 855, ## 877 added in variable: ENQUESTADOR_CODI ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P4 ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P7 ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P11 ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P13_A ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 2, 3, 4, ## 5, 6, 7, 8, 9 added in variable: P13_B ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P13_C ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P13_D ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P13_E ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P19B_A_FERNANDEZ ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P19B_L_BORRAS ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P19B_P_ARAGONES ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P19B_S_ILLA ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P19B_J_ALBIACH ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P19B_C_CARRIZOSA ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P19B_D_SABATER ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8 added in variable: P19B_I_GARRIGA ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1, 2, 3, ## 4, 5, 6, 7, 8, 9 added in variable: P19B_A_CHACON ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Undeclared level(s) 1932, ## 1939, 1942, 1944, 1945, 1946, 1948, 1950, 1951, 1952, 1953, 1954, 1955, 1956, 1957, 1958, 1959, 1960, 1961, 1962, 1963, 1964, 1965, ## 1966, 1967, 1968, 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1976, 1977, 1978, 1979, 1980, 1981, 1982, 1983, 1984, 1985, 1986, 1987, ## 1988, 1989, 1990, 1991, 1992, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, ## 2011, 2013, 2014, 2015, 2016, 2017, 2018, 2019 added in variable: P20 ## Warning in read.spss(&quot;http://upceo.ceo.gencat.cat/wsceop/7908/Microdades%20anonimitzades%20-992.sav&quot;, : Duplicated levels in factor ## P29: Altres valor &lt;- data %&gt;% mutate( FERNANDEZ= ifelse(P19B_A_FERNANDEZ%in%c(&quot;No ho sap&quot;,&quot;No contesta&quot;),NA,as.numeric(P19B_A_FERNANDEZ) -1) ,BORRAS = ifelse(P19B_L_BORRAS%in%c(&quot;No ho sap&quot;,&quot;No contesta&quot;),NA,as.numeric(P19B_L_BORRAS) -1) ,ARAGONES = ifelse(P19B_P_ARAGONES%in%c(&quot;No ho sap&quot;,&quot;No contesta&quot;),NA,as.numeric(P19B_P_ARAGONES) -1) ,ILLA = ifelse(P19B_S_ILLA%in%c(&quot;No ho sap&quot;,&quot;No contesta&quot;),NA,as.numeric(P19B_S_ILLA) -1) ,ALBIACH = ifelse(P19B_J_ALBIACH%in%c(&quot;No ho sap&quot;,&quot;No contesta&quot;),NA,as.numeric(P19B_J_ALBIACH) -1) ,CARRIZOSA = ifelse(P19B_C_CARRIZOSA%in%c(&quot;No ho sap&quot;,&quot;No contesta&quot;),NA,as.numeric(P19B_C_CARRIZOSA) -1) ,SABATER = ifelse(P19B_D_SABATER%in%c(&quot;No ho sap&quot;,&quot;No contesta&quot;),NA,as.numeric(P19B_D_SABATER) -1) ,GARRIGA = ifelse(P19B_I_GARRIGA%in%c(&quot;No ho sap&quot;,&quot;No contesta&quot;),NA,as.numeric(P19B_I_GARRIGA) -1) ,CHACON = ifelse(P19B_A_CHACON%in%c(&quot;No ho sap&quot;,&quot;No contesta&quot;),NA,as.numeric(P19B_A_CHACON) -1)) %&gt;% select(FERNANDEZ,BORRAS,ARAGONES,ILLA,ALBIACH ,CARRIZOSA,SABATER,GARRIGA,CHACON) head(valor) ## FERNANDEZ BORRAS ARAGONES ILLA ALBIACH CARRIZOSA SABATER GARRIGA CHACON ## 1 0 9 7 6 8 0 2 0 6 ## 2 NA NA NA 2 NA NA 6 NA NA ## 3 5 5 7 8 NA 5 NA NA 6 ## 4 NA 9 8 6 NA 0 8 NA NA ## 5 NA 8 7 8 NA NA NA NA 6 ## 6 NA NA NA NA NA NA NA NA NA library(VIM) ## Loading required package: colorspace ## Loading required package: grid ## VIM is ready to use. ## Suggestions and bug-reports can be submitted at: https://github.com/statistikat/VIM/issues ## ## Attaching package: &#39;VIM&#39; ## The following object is masked from &#39;package:datasets&#39;: ## ## sleep aggr(valor) cor() valorNA&lt;-na.omit(valor) dim(valorNA) ## [1] 99 9 X &lt;- scale(valorNA) respca &lt;- PCA(X, graph=FALSE) summary(respca) ## ## Call: ## PCA(X = X, graph = FALSE) ## ## ## Eigenvalues ## Dim.1 Dim.2 Dim.3 Dim.4 Dim.5 Dim.6 Dim.7 Dim.8 Dim.9 ## Variance 3.141 1.883 0.990 0.813 0.550 0.537 0.395 0.379 0.312 ## % of var. 34.896 20.926 11.005 9.030 6.109 5.967 4.388 4.206 3.472 ## Cumulative % of var. 34.896 55.822 66.828 75.858 81.967 87.934 92.322 96.528 100.000 ## ## Individuals (the 10 first) ## Dist Dim.1 ctr cos2 Dim.2 ctr cos2 Dim.3 ctr cos2 ## 1 | 2.890 | -0.162 0.008 0.003 | 1.109 0.659 0.147 | -0.937 0.895 0.105 | ## 21 | 2.884 | 0.818 0.215 0.080 | -0.311 0.052 0.012 | -1.757 3.147 0.371 | ## 23 | 2.410 | -0.343 0.038 0.020 | 2.004 2.154 0.691 | 0.689 0.484 0.082 | ## 27 | 2.466 | 1.124 0.406 0.208 | 0.072 0.003 0.001 | 0.006 0.000 0.000 | ## 28 | 3.314 | 2.829 2.575 0.729 | 0.301 0.049 0.008 | -0.603 0.370 0.033 | ## 33 | 1.980 | -0.361 0.042 0.033 | 0.286 0.044 0.021 | 0.216 0.048 0.012 | ## 43 | 2.576 | 1.841 1.090 0.510 | 0.103 0.006 0.002 | -0.947 0.915 0.135 | ## 82 | 3.848 | 3.223 3.340 0.701 | -1.757 1.655 0.208 | 0.727 0.538 0.036 | ## 92 | 1.669 | -0.821 0.217 0.242 | -0.032 0.001 0.000 | -0.233 0.056 0.020 | ## 110 | 3.709 | -1.964 1.241 0.280 | 1.351 0.978 0.133 | -0.392 0.157 0.011 | ## ## Variables ## Dim.1 ctr cos2 Dim.2 ctr cos2 Dim.3 ctr cos2 ## FERNANDEZ | 0.616 12.092 0.380 | -0.572 17.359 0.327 | 0.232 5.426 0.054 | ## BORRAS | 0.351 3.923 0.123 | 0.642 21.911 0.413 | 0.375 14.230 0.141 | ## ARAGONES | 0.662 13.951 0.438 | 0.442 10.378 0.195 | -0.094 0.883 0.009 | ## ILLA | 0.627 12.534 0.394 | 0.032 0.053 0.001 | -0.658 43.664 0.432 | ## ALBIACH | 0.759 18.362 0.577 | 0.229 2.796 0.053 | -0.337 11.438 0.113 | ## CARRIZOSA | 0.630 12.640 0.397 | -0.589 18.425 0.347 | 0.036 0.132 0.001 | ## SABATER | 0.413 5.430 0.171 | 0.548 15.919 0.300 | 0.207 4.326 0.043 | ## GARRIGA | 0.572 10.432 0.328 | -0.486 12.526 0.236 | 0.214 4.609 0.046 | ## CHACON | 0.578 10.635 0.334 | 0.109 0.634 0.012 | 0.389 15.293 0.151 | plot(respca,choix=&quot;ind&quot;, cex=0.7) plot(respca,choix=&quot;var&quot;) 6.4 Analisis Factorial amb dades omeses fit = factanal(X, factors=2,rotation = &#39;varimax&#39;) fit ## ## Call: ## factanal(x = X, factors = 2, rotation = &quot;varimax&quot;) ## ## Uniquenesses: ## FERNANDEZ BORRAS ARAGONES ILLA ALBIACH CARRIZOSA SABATER GARRIGA CHACON ## 0.391 0.713 0.435 0.666 0.427 0.295 0.729 0.578 0.760 ## ## Loadings: ## Factor1 Factor2 ## FERNANDEZ 0.779 ## BORRAS -0.120 0.522 ## ARAGONES 0.122 0.742 ## ILLA 0.335 0.472 ## ALBIACH 0.317 0.687 ## CARRIZOSA 0.838 ## SABATER 0.520 ## GARRIGA 0.643 ## CHACON 0.282 0.401 ## ## Factor1 Factor2 ## SS loadings 2.045 1.962 ## Proportion Var 0.227 0.218 ## Cumulative Var 0.227 0.445 ## ## Test of the hypothesis that 2 factors are sufficient. ## The chi square statistic is 28.5 on 19 degrees of freedom. ## The p-value is 0.0742 attributes(fit) ## $names ## [1] &quot;converged&quot; &quot;loadings&quot; &quot;uniquenesses&quot; &quot;correlation&quot; &quot;criteria&quot; &quot;factors&quot; &quot;dof&quot; &quot;method&quot; ## [9] &quot;rotmat&quot; &quot;STATISTIC&quot; &quot;PVAL&quot; &quot;n.obs&quot; &quot;call&quot; ## ## $class ## [1] &quot;factanal&quot; A=fit$loadings; ma=max(abs(A)) L&lt;-A[,1:2] comm &lt;- apply(A[,1:2]**2, 1,sum) factvar &lt;- apply(A[,1:2]**2, 2,sum) unique &lt;- 1 - comm LL&lt;- cbind(L, communalities=comm, uniq= unique) LLL &lt;- rbind(LL, c(factvar,sum(comm), sum(unique) ) ) round(LLL,digits=3) ## Factor1 Factor2 communalities uniq ## FERNANDEZ 0.779 0.048 0.609 0.391 ## BORRAS -0.120 0.522 0.287 0.713 ## ARAGONES 0.122 0.742 0.565 0.435 ## ILLA 0.335 0.472 0.334 0.666 ## ALBIACH 0.317 0.687 0.573 0.427 ## CARRIZOSA 0.838 0.049 0.705 0.295 ## SABATER -0.033 0.520 0.271 0.729 ## GARRIGA 0.643 0.093 0.422 0.578 ## CHACON 0.282 0.401 0.240 0.760 ## 2.045 1.962 4.006 4.994 6.4.1 Representació de les variables plot(A[,1],A[,2], xlim = c(-ma, ma), ylim = c(-ma,ma), type = &#39;n&#39;, xlab=&quot;factor 1&quot;, ylab=&quot;factor 2&quot;) arrows(rep(0,6), rep(0,6), A[,1], A[,2], length = 0.05) abline(h = 0, lty = 3) abline(v = 0, lty = 3) text(A[,1], A[,2] , colnames(X), cex =.7) 6.4.2 Anàlisis factorial amb correlacions dos a dos head(valor) ## FERNANDEZ BORRAS ARAGONES ILLA ALBIACH CARRIZOSA SABATER GARRIGA CHACON ## 1 0 9 7 6 8 0 2 0 6 ## 2 NA NA NA 2 NA NA 6 NA NA ## 3 5 5 7 8 NA 5 NA NA 6 ## 4 NA 9 8 6 NA 0 8 NA NA ## 5 NA 8 7 8 NA NA NA NA 6 ## 6 NA NA NA NA NA NA NA NA NA dim(valor) ## [1] 1100 9 aggr(valor) R &lt;- cor(valor, use=&quot;pairwise.complete.obs&quot;) round(R,3) ## FERNANDEZ BORRAS ARAGONES ILLA ALBIACH CARRIZOSA SABATER GARRIGA CHACON ## FERNANDEZ 1.000 0.005 0.074 0.231 0.327 0.726 0.120 0.648 0.350 ## BORRAS 0.005 1.000 0.517 0.205 0.308 -0.067 0.534 0.012 0.380 ## ARAGONES 0.074 0.517 1.000 0.439 0.504 0.030 0.408 0.030 0.463 ## ILLA 0.231 0.205 0.439 1.000 0.497 0.214 0.310 0.209 0.402 ## ALBIACH 0.327 0.308 0.504 0.497 1.000 0.229 0.422 0.317 0.467 ## CARRIZOSA 0.726 -0.067 0.030 0.214 0.229 1.000 0.005 0.605 0.283 ## SABATER 0.120 0.534 0.408 0.310 0.422 0.005 1.000 0.158 0.443 ## GARRIGA 0.648 0.012 0.030 0.209 0.317 0.605 0.158 1.000 0.258 ## CHACON 0.350 0.380 0.463 0.402 0.467 0.283 0.443 0.258 1.000 fit = factanal(covmat =R, factors=2,rotation = &#39;varimax&#39;) A=fit$loadings; ma=max(abs(A)) Veiem la representació. L&lt;-A[,1:2] comm &lt;- apply(A[,1:2]**2, 1,sum) factvar &lt;- apply(A[,1:2]**2, 2,sum) unique &lt;- 1 - comm LL&lt;- cbind(L, communalities=comm, uniq= unique) LLL &lt;- rbind(LL, c(factvar,sum(comm), sum(unique) ) ) round(LLL,3) ## Factor1 Factor2 communalities uniq ## FERNANDEZ 0.129 0.868 0.769 0.231 ## BORRAS 0.649 -0.106 0.433 0.567 ## ARAGONES 0.750 -0.020 0.563 0.437 ## ILLA 0.531 0.218 0.330 0.670 ## ALBIACH 0.643 0.286 0.495 0.505 ## CARRIZOSA 0.028 0.830 0.689 0.311 ## SABATER 0.651 0.031 0.425 0.575 ## GARRIGA 0.117 0.727 0.542 0.458 ## CHACON 0.628 0.302 0.485 0.515 ## 2.529 2.203 4.732 4.268 Gráficament. plot(A[,1],A[,2], xlim = c(-ma, ma), ylim = c(-ma,ma), type = &#39;n&#39;, xlab=&quot;factor 1&quot;, ylab=&quot;factor 2&quot;) arrows(rep(0,6), rep(0,6), A[,1], A[,2], length = 0.04) abline(h = 0, lty = 3) abline(v = 0, lty = 3) text(A[,1], A[,2] , rownames(R), cex =.7) "],["teoria-setmana-7.html", "Capítol 7 Teoria Setmana 7 7.1 European Statisticall Survey 2016 (ESS)", " Capítol 7 Teoria Setmana 7 7.1 European Statisticall Survey 2016 (ESS) library(FactoMineR) library(factoextra) ess &lt;- load(&quot;www/data/ess16_8.RData&quot;) X&lt;-essdata[,-1:-2] Xs&lt;-scale(X) result &lt;- PCA(Xs, graph = F) fviz_screeplot(result, main=&quot;PCA ESS 2016: Scree plot&quot;, ncp=21) fviz_pca_var(result, repel=T, title=&quot;PCA ESS 2016: variables plot, exp. var. is 35.66%&quot;, col.var =&quot;blue&quot;) CoordenadesPC &lt;- predict(result, newdata=Xs) head(CoordenadesPC$coord) ## Dim.1 Dim.2 Dim.3 Dim.4 Dim.5 ## 1 0.05587675 -0.78445549 -2.6542938 -1.7548698 1.96207258 ## 2 -2.59615053 -1.14631785 -1.3477210 -1.8178399 0.52480225 ## 3 -0.91825328 2.06662635 -0.3738472 -1.0165870 -2.49455226 ## 4 0.92790773 -1.26918362 0.6469516 0.1678153 -0.03991936 ## 5 1.08033473 0.09643711 -2.1028387 0.2559448 -1.33723820 ## 6 0.90197585 2.88962053 1.0347817 0.5298216 0.46822160 corCP &lt;- cor(Xs,CoordenadesPC$coord) corCP ## Dim.1 Dim.2 Dim.3 Dim.4 Dim.5 ## ipcrtiv 0.4850904 -0.2466303 -0.27896542 -0.23266697 0.32178101 ## imprich 0.2983448 -0.4955241 0.45252734 -0.05873774 0.05502028 ## ipeqopt 0.4617391 0.2670961 -0.32557454 -0.20129679 0.19142078 ## ipshabt 0.5393657 -0.3483975 0.31343428 -0.27357813 0.19453073 ## impsafe 0.4715346 0.3398959 0.33869121 -0.20931577 -0.20770968 ## impdiff 0.5275476 -0.3972211 -0.23448945 0.16728347 0.17915319 ## ipfrule 0.3486195 0.2688416 0.42811230 0.36713962 0.30471563 ## ipudrst 0.5047132 0.2456069 -0.39684700 0.06162487 0.31674151 ## ipmodst 0.3340044 0.4938287 -0.06293401 0.32049269 0.14915976 ## ipgdtim 0.4780183 -0.4264057 -0.18670616 0.21052200 -0.37456250 ## impfree 0.5143234 -0.0926020 -0.26653410 -0.26626859 -0.22923968 ## iphlppl 0.5765880 0.3046963 -0.33534853 -0.03841315 0.00315128 ## ipsuces 0.5699053 -0.3712434 0.34858548 -0.18018895 0.08902413 ## ipstrgv 0.5138666 0.2904064 0.25720280 -0.13212796 -0.26157469 ## ipadvnt 0.3775718 -0.6221513 -0.11053826 0.28812685 0.09685584 ## ipbhprp 0.4557116 0.4223522 0.32174890 0.22660341 0.07768646 ## iprspot 0.4924489 -0.0909169 0.49381765 -0.08019413 0.01327728 ## iplylfr 0.5737709 0.2523066 -0.30833537 -0.04585277 -0.17154264 ## impenv 0.5035905 0.3235171 -0.18851825 -0.11526224 -0.10723265 ## imptrad 0.3834979 0.3320727 0.32592300 0.19435975 -0.19122251 ## impfun 0.4992021 -0.4226673 -0.18968646 0.36359478 -0.30496134 ipcrtiv: Important to think new ideas and being creative imprich: Important to be rich, have money and expensive things ipeqopt: Important that people are treated equally and have equal opportunities ipshabt: Important to show abilities and be admired impsafe: Important to live in secure and safe surroundings impdiff: Important to try new and different things in life ipfrule: Important to do what is told and follow rules ipudrst: Important to understand different people ipmodst: Important to be humble and modest, not draw attention ipgdtim: Important to have a good time impfree: Important to make own decisions and be free iphlppl: Important to help people and care for others well-being ipsuces: Important to be successful and that people recognize achievements ipstrgv: Important that government is strong and ensures safety ipadvnt: Important to seek adventures and have an exciting life ipbhprp: Important to behave properly iprspot: Important to get respect from others iplylfr: Important to be loyal to friends and devote to people close impenv: Important to care for nature and environment imptrad: Important to follow traditions and customs impfun: Important to seek fun and things that give pleasure vars &lt;- c( &quot;Important to think new ideas and being creative&quot; ,&quot;Important to be rich, have money and expensive things&quot; ,&quot;Important that people are treated equally and have equal opportunities&quot; ,&quot;Important to show abilities and be admired&quot; ,&quot;Important to live in secure and safe surroundings&quot; ,&quot;Important to try new and different things in life&quot; ,&quot;Important to do what is told and follow rules&quot; ,&quot;Important to understand different people&quot; ,&quot;Important to be humble and modest, not draw attention&quot; ,&quot;Important to have a good time&quot; ,&quot;Important to make own decisions and be free&quot; ,&quot;Important to help people and care for others well-being&quot; ,&quot;Important to be successful and that people recognize achievements&quot; ,&quot;Important that government is strong and ensures safety&quot; ,&quot;Important to seek adventures and have an exciting life&quot; ,&quot;Important to behave properly&quot; ,&quot;Important to get respect from others&quot; ,&quot;Important to be loyal to friends and devote to people close&quot; ,&quot;Important to care for nature and environment&quot; ,&quot;Important to follow traditions and customs&quot; ,&quot;Important to seek fun and things that give pleasure&quot;) # SEgunda componente corCPDesc&lt;-data.frame(CP1=corCP[,1],CP2=corCP[,2],VAR = vars) corCPDesc[order(corCPDesc[,2]),] ## CP1 CP2 VAR ## ipadvnt 0.3775718 -0.6221513 Important to seek adventures and have an exciting life ## imprich 0.2983448 -0.4955241 Important to be rich, have money and expensive things ## ipgdtim 0.4780183 -0.4264057 Important to have a good time ## impfun 0.4992021 -0.4226673 Important to seek fun and things that give pleasure ## impdiff 0.5275476 -0.3972211 Important to try new and different things in life ## ipsuces 0.5699053 -0.3712434 Important to be successful and that people recognize achievements ## ipshabt 0.5393657 -0.3483975 Important to show abilities and be admired ## ipcrtiv 0.4850904 -0.2466303 Important to think new ideas and being creative ## impfree 0.5143234 -0.0926020 Important to make own decisions and be free ## iprspot 0.4924489 -0.0909169 Important to get respect from others ## ipudrst 0.5047132 0.2456069 Important to understand different people ## iplylfr 0.5737709 0.2523066 Important to be loyal to friends and devote to people close ## ipeqopt 0.4617391 0.2670961 Important that people are treated equally and have equal opportunities ## ipfrule 0.3486195 0.2688416 Important to do what is told and follow rules ## ipstrgv 0.5138666 0.2904064 Important that government is strong and ensures safety ## iphlppl 0.5765880 0.3046963 Important to help people and care for others well-being ## impenv 0.5035905 0.3235171 Important to care for nature and environment ## imptrad 0.3834979 0.3320727 Important to follow traditions and customs ## impsafe 0.4715346 0.3398959 Important to live in secure and safe surroundings ## ipbhprp 0.4557116 0.4223522 Important to behave properly ## ipmodst 0.3340044 0.4938287 Important to be humble and modest, not draw attention "],["teoria-setmana-8.html", "Capítol 8 Teoria Setmana 8 8.1 Dades de Comunitats 8.2 Dades eleccions parlament 2021", " Capítol 8 Teoria Setmana 8 8.1 Dades de Comunitats 8.1.1 Cluser jerarquic suppressPackageStartupMessages(library(tidyverse)) library(foreign) data&lt;-read.table(&quot;http://www.econ.upf.edu/~satorra/dades/CommAA.dat&quot;, header=T) dim(data) ## [1] 14 5 head(data) ## comm denpob pacagri pacind recap ## 1 Andal 70.1 30.41 17.30 10.31 ## 2 Catal 176.9 7.99 42.81 13.75 ## 3 Madri 543.4 2.41 27.49 12.59 ## 4 Valen 144.9 16.84 35.14 12.24 ## 5 Casle 33.3 36.30 21.60 11.28 ## 6 Galic 91.0 51.26 15.66 10.59 Preparem dades. On veiem que cadascuna té una escala (concepte) diferent. X&lt;- data[,-1] rownames(X) &lt;- data[,1] head(X) ## denpob pacagri pacind recap ## Andal 70.1 30.41 17.30 10.31 ## Catal 176.9 7.99 42.81 13.75 ## Madri 543.4 2.41 27.49 12.59 ## Valen 144.9 16.84 35.14 12.24 ## Casle 33.3 36.30 21.60 11.28 ## Galic 91.0 51.26 15.66 10.59 Estandarditzem per tal que totes tinguin un mateix per dentrada. Xs &lt;- scale(X) head(Xs) ## denpob pacagri pacind recap ## Andal -0.4150286 0.3279974 -0.7390670 -0.5798760 ## Catal 0.3927698 -1.2283417 1.7286816 0.9478498 ## Madri 3.1648497 -1.6156911 0.2466781 0.4326865 ## Valen 0.1507329 -0.6139973 0.9867125 0.2772493 ## Casle -0.6933711 0.7368662 -0.3231000 -0.1490928 ## Galic -0.2569482 1.7753512 -0.8977149 -0.4555262 Calculem les distancies euclidianes. D &lt;- dist(Xs, method = &quot;euclidean&quot;, upper = TRUE) D ## Andal Catal Madri Valen Casle Galic Vasc Manc Cana Arag Astu Extr ## Andal 3.3909378 4.3116621 2.2182017 0.7766923 1.4698484 3.2980609 0.6605585 1.4623037 1.5499263 1.1044931 1.7144509 ## Catal 3.3909378 3.2087683 1.1984257 3.2333938 4.2792204 0.3331301 3.6614647 3.1455752 2.1936506 2.7668095 4.9975131 ## Madri 4.3116621 3.2087683 3.2649812 4.5916782 5.0305493 3.4879479 4.8382780 3.4093477 4.2305984 4.0480511 5.6487024 ## Valen 2.2182017 1.1984257 3.2649812 2.1058775 3.1564563 1.1182685 2.4848682 2.2402105 1.2026903 1.5884374 3.8046755 ## Casle 0.7766923 3.2333938 4.5916782 2.1058775 1.3011533 3.0831397 0.6502605 1.8076834 1.1820547 1.0796414 1.9299497 ## Galic 1.4698484 4.2792204 5.0305493 3.1564563 1.3011533 4.1537258 1.2238615 2.3287132 2.4349853 1.8804045 1.2985500 ## Vasc 3.2980609 0.3331301 3.4879479 1.1182685 3.0831397 4.1537258 3.5159503 3.1763875 2.0113188 2.6355331 4.8722182 ## Manc 0.6605585 3.6614647 4.8382780 2.4848682 0.6502605 1.2238615 3.5159503 2.0728205 1.6477985 1.1239719 1.4014910 ## Cana 1.4623037 3.1455752 3.4093477 2.2402105 1.8076834 2.3287132 3.1763875 2.0728205 2.0248524 2.0732836 2.8703509 ## Arag 1.5499263 2.1936506 4.2305984 1.2026903 1.1820547 2.4349853 2.0113188 1.6477985 2.0248524 1.2594662 3.0425874 ## Astu 1.1044931 2.7668095 4.0480511 1.5884374 1.0796414 1.8804045 2.6355331 1.1239719 2.0732836 1.2594662 2.3176976 ## Extr 1.7144509 4.9975131 5.6487024 3.8046755 1.9299497 1.2985500 4.8722182 1.4014910 2.8703509 3.0425874 2.3176976 ## Murc 1.1290951 3.1269558 4.2036965 1.9826666 1.5090162 2.2679203 3.0268689 1.2541501 2.1973882 1.6928121 0.8451783 2.2417440 ## Bale 3.0349693 2.6586091 3.9049427 2.4633526 2.8415961 3.6516151 2.6861571 3.4173891 2.1261708 2.3450076 3.2477084 4.5173429 ## Murc Bale ## Andal 1.1290951 3.0349693 ## Catal 3.1269558 2.6586091 ## Madri 4.2036965 3.9049427 ## Valen 1.9826666 2.4633526 ## Casle 1.5090162 2.8415961 ## Galic 2.2679203 3.6516151 ## Vasc 3.0268689 2.6861571 ## Manc 1.2541501 3.4173891 ## Cana 2.1973882 2.1261708 ## Arag 1.6928121 2.3450076 ## Astu 0.8451783 3.2477084 ## Extr 2.2417440 4.5173429 ## Murc 3.6387133 ## Bale 3.6387133 8.1.1.1 Distancia Manhattan Altres distancies: manhattan: O distancia de leixample. Es a dir, per moures dun punt a un altre, no anem en linia recta si no pels catets (o costats) del cuadrat. D &lt;- dist(Xs, method = &quot;manhattan&quot;, upper = TRUE) D ## Andal Catal Madri Valen Casle Galic Vasc Manc Cana Arag Astu ## Andal 6.3596120 7.5218744 4.0906609 1.5339615 1.8884319 5.9511870 1.2432345 2.8344246 2.7703511 1.5111809 ## Catal 6.3596120 5.1565960 2.2689511 6.2000731 7.6831835 0.5806160 7.1481849 4.4751400 4.2775536 5.2373374 ## Madri 7.5218744 5.1565960 4.9112822 7.3623356 8.8454459 5.6395086 8.3104473 5.6374024 5.8190232 6.5563129 ## Valen 4.0906609 2.2689511 4.9112822 3.9311221 5.4142324 1.8832170 4.8792338 2.8603418 2.0352489 2.9683863 ## Casle 1.5339615 6.2000731 7.3623356 3.9311221 2.3559563 5.7916481 0.9481118 3.5068198 2.0541271 2.1174123 ## Galic 1.8884319 7.6831835 8.8454459 5.4142324 2.3559563 7.2747585 2.2098027 3.8407003 4.4100834 2.9876559 ## Vasc 5.9511870 0.5806160 5.6395086 1.8832170 5.7916481 7.2747585 6.7397599 4.5659163 3.8691286 4.8289124 ## Manc 1.2432345 7.1481849 8.3104473 4.8792338 0.9481118 2.2098027 6.7397599 4.0776591 2.8706313 1.9108475 ## Cana 2.8344246 4.4751400 5.6374024 2.8603418 3.5068198 3.8407003 4.5659163 4.0776591 3.1030636 3.8403533 ## Arag 2.7703511 4.2775536 5.8190232 2.0352489 2.0541271 4.4100834 3.8691286 2.8706313 3.1030636 2.1533286 ## Astu 1.5111809 5.2373374 6.5563129 2.9683863 2.1174123 2.9876559 4.8289124 1.9108475 3.8403533 2.1533286 ## Extr 3.1688291 9.5284411 10.6907036 7.2594901 3.3283680 2.2950827 9.1200161 2.4558928 5.0533012 5.2690403 4.2911038 ## Murc 1.9706621 5.8189723 6.9812348 3.5500213 2.6726896 3.7441264 5.4105473 2.3950678 3.7835273 2.4904556 1.5840229 ## Bale 4.4362220 4.5702639 6.7628531 3.6425140 4.5204591 5.7597934 4.2595423 5.2247948 3.4382104 4.1167029 4.8539927 ## Extr Murc Bale ## Andal 3.1688291 1.9706621 4.4362220 ## Catal 9.5284411 5.8189723 4.5702639 ## Madri 10.6907036 6.9812348 6.7628531 ## Valen 7.2594901 3.5500213 3.6425140 ## Casle 3.3283680 2.6726896 4.5204591 ## Galic 2.2950827 3.7441264 5.7597934 ## Vasc 9.1200161 5.4105473 4.2595423 ## Manc 2.4558928 2.3950678 5.2247948 ## Cana 5.0533012 3.7835273 3.4382104 ## Arag 5.2690403 2.4904556 4.1167029 ## Astu 4.2911038 1.5840229 4.8539927 ## Extr 3.7094688 7.6050511 ## Murc 3.7094688 4.7971666 ## Bale 7.6050511 4.7971666 8.1.1.2 Mètode Complete Mesurem la distancia entre dos clusters com el màxim de les distancies 2 a 2. hc&lt;-hclust(D, method = &quot;complete&quot;) plot(hc, lab=data[,1], cex=0.8, hang = -1) abline(h=2.5) Segmentem per alçada. cutree(hc,h = 2.5) ## Andal Catal Madri Valen Casle Galic Vasc Manc Cana Arag Astu Extr Murc Bale ## 1 2 3 4 5 6 2 5 7 4 1 6 1 8 Segmentem per número de grups. data$grups &lt;- cutree(hc,k = 4) data$grups ## [1] 1 2 3 4 1 1 2 1 4 4 1 1 1 4 Representem mitjanes. aggregate(X,list(data$grups),mean) ## Group.1 denpob pacagri pacind recap ## 1 1 60.31429 36.8600 19.69143 9.851429 ## 2 2 160.15000 9.3750 43.25500 13.695000 ## 3 3 543.40000 2.4100 27.49000 12.590000 ## 4 4 115.92500 20.1025 24.33000 13.420000 8.1.1.3 Mètode single Mesurem la distancia entre dos clusters com el mínim de les distancies 2 a 2. hc&lt;-hclust(D, method = &quot;single&quot;) plot(hc, lab=data[,1], cex=0.8, hang = -1) abline(h=2.5) 8.1.1.4 Mètode single Altres métodes: average: mitajana de totes les distancies 2 a 2. centroid: distancia entre els centroides de cada cluster. metodes hclust 8.1.2 Cluster jerarquis sobre components principals Evita redundancies en les variabels. library(FactoMineR) library(factoextra) # components principals res.pca &lt;- PCA(Xs, ncp = 4, graph = FALSE) # cluster jerarquic res.hcpc &lt;- HCPC(res.pca, nb.clust=4,graph = FALSE) fviz_dend(res.hcpc, cex = 0.7, # Label size palette = &quot;jco&quot;, # Color palette see ?ggpubr::ggpar rect = TRUE, rect_fill = TRUE, # Add rectangle around groups rect_border = &quot;jco&quot;, # Rectangle color labels_track_height = 0.8 # Augment the room for labels ) fviz_cluster(res.hcpc, repel = TRUE, # Avoid label overlapping show.clust.cent = TRUE, # Show cluster centers palette = &quot;jco&quot;, # Color palette see ?ggpubr::ggpar ggtheme = theme_minimal(), main = &quot;Factor map&quot; ) 8.1.3 Cluster no jerarquic kmeans: Mètode iteratius ######### K-means: f kmeans() #help(hclust) km &lt;- kmeans(D,3) groups &lt;- km$cluster km$centers ## Andal Catal Madri Valen Casle Galic Vasc Manc Cana Arag Astu Extr Murc Bale ## 1 2.528630 8.605812 9.768075 6.336861 2.842162 1.147541 8.197387 2.332848 4.447001 4.839562 3.639380 1.147541 3.726798 6.682422 ## 2 5.671911 2.515285 4.494048 2.541193 5.561128 6.995483 2.472577 6.460484 4.195402 4.023531 4.888988 8.840740 5.311588 3.847035 ## 3 1.694831 5.645268 6.884090 3.473574 1.833303 3.062394 5.308157 1.920793 3.020835 2.205994 1.873878 3.896572 2.128061 4.483936 aggregate(data[,-1],list(data$grup),mean) ## Group.1 denpob pacagri pacind recap grups ## 1 1 60.31429 36.8600 19.69143 9.851429 1 ## 2 2 160.15000 9.3750 43.25500 13.695000 2 ## 3 3 543.40000 2.4100 27.49000 12.590000 3 ## 4 4 115.92500 20.1025 24.33000 13.420000 4 fviz_cluster(km, data=Xs, repel = TRUE, # Avoid label overlapping show.clust.cent = TRUE, # Show cluster centers palette = &quot;jco&quot;, # Color palette see ?ggpubr::ggpar ggtheme = theme_minimal(), main = &quot;Factor map - kmeans&quot; ) 8.2 Dades eleccions parlament 2021 d &lt;- read.csv(&quot;www/data/mesa2021.csv&quot;, fileEncoding = &quot;utf-8&quot;) dim(d) ## [1] 9139 67 d&lt;- d %&gt;% mutate(N_PSC=Vots.PARTIT.DELS.SOCIALISTES.DE.CATALUNYA..PSC.PSOE...PSC. ,N_ERC=Vots.ESQUERRA.REPUBLICANA.DE.CATALUNYA..ERC. ,N_JxCat=Vots.JUNTS.PER.CATALUNYA..JxCat. ,N_VOX=Vots.VOX..VOX. ,N_CUP=Vots.CANDIDATURA.D.UNITAT.POPULAR.UN.NOU.CICLE.PER.GUANYAR..CUP.G. ,N_COMUNS=Vots.EN.COMÚ.PODEM.PODEM.EN.COMÚ..ECP.PEC. ,N_Cs=Vots.CIUTADANS...PARTIDO.DE.LA.CIUDADANÍA..Cs. ,N_PP=Vots.PARTIT.POPULAR.PARTIDO.POPULAR..PP. ,N_TOT = N_PSC + N_ERC + N_JxCat + N_VOX + N_CUP + N_COMUNS + N_Cs + N_PP ,municipi=Nom.municipi,comarca=Nom.comarca) dmesa&lt;-d %&gt;% filter(N_TOT&gt;0) %&gt;% mutate(PSC = N_PSC / N_TOT ,ERC = N_ERC / N_TOT ,JxCat = N_JxCat / N_TOT ,VOX = N_VOX / N_TOT ,CUP = N_CUP / N_TOT ,COMUNS = N_COMUNS / N_TOT ,Cs = N_Cs / N_TOT ,PP = N_PP / N_TOT ) %&gt;% select(Districte,Secció,Mesa,municipi,comarca,PSC,ERC,JxCat,VOX,CUP,COMUNS,Cs,PP) dmun &lt;- d %&gt;% filter(N_TOT&gt;0) %&gt;% group_by(municipi,comarca) %&gt;% summarise(PSC = sum(N_PSC) / sum(N_TOT) ,ERC = sum(N_ERC) / sum(N_TOT) ,JxCat = sum(N_JxCat) / sum(N_TOT) ,VOX = sum(N_VOX) / sum(N_TOT) ,CUP = sum(N_CUP) / sum(N_TOT) ,COMUNS = sum(N_COMUNS) / sum(N_TOT) ,Cs = sum(N_Cs) / sum(N_TOT) ,PP = sum(N_PP) / sum(N_TOT) ) %&gt;% ungroup() dcom &lt;- d %&gt;% filter(N_TOT&gt;0) %&gt;% group_by(comarca) %&gt;% summarise(PSC = sum(N_PSC) / sum(N_TOT) ,ERC = sum(N_ERC) / sum(N_TOT) ,JxCat = sum(N_JxCat) / sum(N_TOT) ,VOX = sum(N_VOX) / sum(N_TOT) ,CUP = sum(N_CUP) / sum(N_TOT) ,COMUNS = sum(N_COMUNS) / sum(N_TOT) ,Cs = sum(N_Cs) / sum(N_TOT) ,PP = sum(N_PP) / sum(N_TOT) ) %&gt;% ungroup() %&gt;% as.data.frame() X&lt;- as.data.frame(dcom[,-1]) rownames(X) &lt;- dcom[,1] D&lt;-dist(X) hc&lt;- hclust(D) plot(hc, main = &quot;dendograma&quot;, sub = NULL, xlab = NULL, ylab = &quot;Height&quot;, hang=0.1, lab=dcom[,1] ) # Compute PCA with ncp = 3 res.pca &lt;- PCA(X, ncp = 2, graph = FALSE) # Compute hierarchical clustering on principal components res.hcpc &lt;- HCPC(res.pca, graph = FALSE) fviz_dend(res.hcpc, cex = 0.7, # Label size palette = &quot;jco&quot;, # Color palette see ?ggpubr::ggpar rect = TRUE, rect_fill = TRUE, # Add rectangle around groups rect_border = &quot;jco&quot;, # Rectangle color labels_track_height = 0.8 # Augment the room for labels ) SEgmentem sobre les components principals. fviz_cluster(res.hcpc, repel = TRUE, # Avoid label overlapping show.clust.cent = TRUE, # Show cluster centers palette = &quot;jco&quot;, # Color palette see ?ggpubr::ggpar ggtheme = theme_minimal(), main = &quot;Factor map&quot; ) 8.2.1 Cluster no jerarquic ######### K-means: f kmeans() #help(hclust) km &lt;- kmeans(D,3) groups &lt;- km$cluster aggregate(dcom[,-1],list(groups),mean) ## Group.1 PSC ERC JxCat VOX CUP COMUNS Cs PP ## 1 1 0.1863542 0.2744703 0.2677018 0.06732752 0.08502995 0.04972617 0.03785314 0.03153684 ## 2 2 0.1181800 0.2942368 0.3690934 0.03522813 0.11051965 0.03187249 0.02097492 0.01989460 ## 3 3 0.2809031 0.2078552 0.1585323 0.10540031 0.05658615 0.07342902 0.07065427 0.04663963 fviz_cluster(km, data=X, repel = TRUE, # Avoid label overlapping show.clust.cent = TRUE, # Show cluster centers palette = &quot;jco&quot;, # Color palette see ?ggpubr::ggpar ggtheme = theme_minimal(), main = &quot;Factor map - kmeans&quot; ) ######### K-means: f kmeans() #help(hclust) X&lt;- as.data.frame(dmesa[,-c(1:5)]) D&lt;-dist(X) km &lt;- kmeans(D,3) groups &lt;- km$cluster aggregate(dmesa[,-c(1:5)],list(groups),mean) ## Group.1 PSC ERC JxCat VOX CUP COMUNS Cs PP ## 1 1 0.2247752 0.2363245 0.21084377 0.07789258 0.07415371 0.07671764 0.05770510 0.04158755 ## 2 2 0.1146650 0.2782561 0.37599566 0.03995657 0.10768523 0.03814870 0.02357438 0.02171835 ## 3 3 0.3742974 0.1674550 0.07518966 0.12054222 0.03628159 0.09006323 0.08501500 0.05115592 respca &lt;- PCA(X, graph=FALSE) Z &lt;- predict(respca, newdata=X)$coord[,1:2] plot(Z, pch=&quot;.&quot;, col=groups, main=&quot;meses segons 3 clusters&quot;) "],["seminaris-setmana-1.html", "Capítol 9 Seminaris Setmana 1 9.1 Programació amb R 9.2 Comentari Deure 1.", " Capítol 9 Seminaris Setmana 1 9.1 Programació amb R Introducció a la Programació amb R per al Mètodes Estadístics Aplicats en Ciències Polítiques. Dades pels projectes. 9.2 Comentari Deure 1. Veure aparatat deures: 14. "],["seminaris-setmana-2.html", "Capítol 10 Seminaris Setmana 2 10.1 Comentari dels projectes en grup 10.2 Paquets addicionals 10.3 Correcció deure 1 10.4 Comentari Deure 2", " Capítol 10 Seminaris Setmana 2 10.1 Comentari dels projectes en grup Formació de grups setmana 2022-02-02. Formar grups i pensar tema. Exploració de propostes de dades pel projecte 10.2 Paquets addicionals Revisió posada a apunt del R install.packages(&quot;stargazer&quot;) install.packages(&quot;ggcorrplot&quot;) 10.3 Correcció deure 1 Solució a laula 10.4 Comentari Deure 2 Veure aparatat deures: 14. "],["seminaris-setmana-3.html", "Capítol 11 Seminaris Setmana 3 11.1 Comentari dels projectes en grup 11.2 Correcció deure 2 11.3 Comentari Deure 3", " Capítol 11 Seminaris Setmana 3 11.1 Comentari dels projectes en grup 11.2 Correcció deure 2 Solució a laula 11.3 Comentari Deure 3 Veure aparatat deures: 14. "],["seminaris-setmana-4.html", "Capítol 12 Seminaris Setmana 4 12.1 Comentari Deure 4 12.2 Projectes en grup", " Capítol 12 Seminaris Setmana 4 12.1 Comentari Deure 4 Veure aparatat deures: 14. 12.2 Projectes en grup tutories per grups. "],["seminaris-setmana-5.html", "Capítol 13 Seminaris Setmana 5", " Capítol 13 Seminaris Setmana 5 Xerrada Justicia en la Inteligencia Artificial. "],["homework.html", "Capítol 14 Llista de problemes 14.1 Problema 1 14.2 Problema 2 14.3 Problema 3 14.4 Problema 4 14.5 Problema 5", " Capítol 14 Llista de problemes 14.1 Problema 1 NOTA: Descarrega la plantilla de solució problema 1 en Rmd. En el link https://griu.github.io/meacp_2021/data/dataXY.dat hi han les dues variables ESPVIDA i CALORIES del fitxer PAISOS.SAV (són lesperança de vida y les calories per habitant en diferents paisos del mon). Feu: Utiliza el program (Excel, SPSS o R) que coneguis. La lectura de les dades amb R seria dataXY&lt;-read.table(&#39;https://raw.githubusercontent.com/griu/griu.github.io/main/meacp_2021/data/dataXY.dat&#39;, header=TRUE, dec=&quot;,&quot;, sep=&quot;;&quot;) Una descripció breu univariant de cada una de les variables; summary(dataXY) ## CALORIES ESPVIDA ## Min. :1505 Min. :39.00 ## 1st Qu.:2248 1st Qu.:55.77 ## Median :2614 Median :67.55 ## Mean :2661 Mean :64.57 ## 3rd Qu.:3166 3rd Qu.:72.88 ## Max. :3947 Max. :79.50 Un diagrama de dispersió de ESPVIDA vs CALORIES. Comenta si sobserva o no associació entre aquests dues variables. library(ggplot2) ggplot(dataXY, aes(x=CALORIES, y=ESPVIDA)) + geom_point() Comenta si la associació observada justifica o no parlar de causalitat. 14.2 Problema 2 Considera les dades a PAISOS.SAV, lectura de dades en R: library(foreign) data &lt;- read.spss(&quot;https://griu.github.io/meacp_2021/data/PAISOS.SAV&quot;, use.value.labels = TRUE, to.data.frame = TRUE, use.missings =TRUE) Quins són els països que tenen menys de 47 anys desperança de vida? Quants països tenen menys dun terç de la seva població alfabetitzada? I daquests, quants tenen un PIB per càpita superior a 1.000 dòlars? Quina és la mitjana del nombre de diaris que es llegeixen al món? Hi ha diferències en la lectura de diaris segons nivell de desenvolupament humà? Creus que a Espanya sen llegeixen pocs? perquè? Quina és la mitjana dhabitants per metge? Quin és el valor daquesta mitjana en cada un dels tres nivells de desenvolupament humà en què shan classificat els països? Hi ha diferències significatives entre elles? En relació al fitxer de dades PAISOS.SAV, tria una variable Y del teu interès i descriu la variació de la mateixa emprant un altre variable del fitxer de dades. En aquest procés, ajusta un model de regressió lineal simple entre la variable depenent i la variable explicativa, descriu els resultats de la regressió lineal simple, i comprova que la hipòtesi de linealitat es plausible en aquestes dades. Si veus que la linealitat no es plausible, efectua la corresponent transformació prèvia de les variables. Recull els residus, I fes un gràfic dels residus vs. la variable depenent ajustada. Fes un breu resum de les conclusions que creus que es desprenen de la teva anàlisi. Explica també les limitacions de lanàlisi. 14.3 Problema 3 En relació a les dades de PAISOS.SAV. Investiga la variació de ESPVIDA en funció de CALORIES, controlant o no per altres variables explicatives. Inspecciona els residus de la regressió. Fes un breu resum de les conclusions que creus que es desprenen de la dependencia de ESPVIDA i CALORIES. 14.4 Problema 4 Considera les dades bank.sav (veure els fitxers de dades que hi ha a la web de lassignatura) de salaris de treballadors del sector de banca. Imagina que hi ha un plet en aquesta empresa sobre discriminació per raó de gènere. De fet, el salari actual dels homes és molt superior al de les dones. Fes les anàlisis de regressió simple i múltiple, amb les interpretacions i arguments corresponents, que aporten evidència empírica en defensa de lassociació que ha iniciat el plet contra lempresa. Dades: library(foreign) d &lt;- read.spss(&quot;https://griu.github.io/meacp_2021/www/data/bank2.sav&quot;, to.data.frame=TRUE) names(d) Inicialment fes un breu descriptiu (freqüències, mitjanes,) de les variables del fitxer segons siguin categòriques o contínues. Visualitza un scatterplot (gràfic de dispersió) de cadascuna de les variables contínues respecte a la variable del salari actual. Comenta la linealitat o no, de les relacions observades. Calcula la correlació de Pearson de cadascuna de les variables contínues i la variable salari actual. Transforma la variable Sexo a una variable numèrica. Utilitza una regressió lineal simple per tal de verificar que efectivament hi ha diferències salarials entre homes i dones. Explora ara diferents models lineals múltiples usant com a variable depenent Salari Actual i com a regressors del model la variable sexe i altres factors de control (Nivell educatiu, Mesos des del contracte, experiència prèvia,) . Un cop escollit el model anota quins son els coeficients del model, el seu nivell de significació, quin nivell dajust ha obtingut el model, això com lhistograma dels residus i el gràfics de dispersió dels valors ajustats sobre els residus. Comenta breument els diferents resultats Incorpora en el model la variable categòrica Categoria laboral i reporta els mateixos elements que en el punt anterior. Escriu quines son les conclusions principals que sextreuen del model pel que fa a la qüestió de la discriminació del salari. 14.5 Problema 5 Deure: Regressio Logistica Considera les dades de lenquesta postelectoral del CIS corresponent a les eleccions generals de 1986, fitxer CIS1542.SAV: library(foreign) d&lt;-read.spss(&quot;http://84.89.132.1/~satorra/dades/cis1542.sav&quot;, to.data.frame=TRUE) names(d) La variable dependent que vols explicar és ABST86, una variable dicotòmica. Considera com a variables explicatives les següents: MIDA_HAB, SEXE, EDAT, CASAT, ATURAT. Les dues últimes variables són categòriques. Considera la recodificació següent: CASAT, amb valor 1 si EST_CIV=2 i 0 en els altres casos ATURAT, amb valor 1 si SIT_LAB=2 i 0 en els altres casos Estima un model de regressió logística per tal dexplicar labstenció en funció daquestes 5 variables sociològiques. Treballa els següents punts: Quines de les variables incloses en el model són significatives (al 5% de significació)? Escriu la equació estimada que relaciona el logit de la probabilitat dabstenir-se amb les variables explicatives. És lineal aquesta equació? Escriu la equació estimada que relaciona la probabilitat dabstenir-se amb les variables explicatives. És lineal aquesta equació ? Segons el model estimat, quina probabilitat té dabstenir-se una noia soltera, que viu en una població de 60.000 habitants, que té 27 anys, que te una feina. Al mateix per una amiga seva, amb les mateixes característiques, però que està casada i ha perdut la seva feina. Considera ara les dones casades i que viuen en una població de 60.000 habitants. Calcula el grafic defectes sobre la probabilitat abstenció, de la varible Edat condicionat a si esta o no aturat (pots usar, si vols la funció visreg() vista a classe). El mateix que 5. pero pel grup dhomes. Comenta les principals diferencies o semblances entre els 2 gràfics anteriors. "]]
