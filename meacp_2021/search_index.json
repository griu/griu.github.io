[["index.html", "Diari de les Classes de Mètodes Estadístics Aplicats (21703). Curs 2020-2021 Introducció", " Diari de les Classes de Mètodes Estadístics Aplicats (21703). Curs 2020-2021 Ferran Carrascosa Mallafrè 2021-01-10 Introducció Aquesta web té com a objectiu donar suport als continguts de les clases de teoría y seminaris del curs 2020-2021 de Mètodes Estadístics Aplicats (21703). Els continguts de la web sestructuren de la següent forma: Diari dapunts de clase de teoria Diari dapunts dels seminaris Deures del curs "],["teoria-setmana-1-2020-01-13.html", "Capítol 1 Teoria Setmana 1 (2020-01-13) 1.1 Avaluació 1.2 Bibliografia 1.3 Introducció conceptes Estadística 1.4 Gender gap, at birth 1.5 With Arbuthnotts data, collected on years 1629 to 1710 1.6 Distribució duna variable, distribució normal, altres distribucions", " Capítol 1 Teoria Setmana 1 (2020-01-13) Discussió sobre: Logística del curs: Teoria i seminaris: Horaris Canals: Aula global, Collaborate, Web de curs El PDA Avaluació: Participació seminaris (15%), Treball (35%), Examen Final (50%) Disseny del curs: Conceptes, dades, programari Eina de treball: R 1.1 Avaluació 1.1.1 El treball Consulta la Guía del Treball de fi de curs. Consulta a lAula global els Exemples de treballs danys anteriors. 1.1.2 Exàmens Lexamen serà online. Consulta a lAula global els Exàmens danys anteriors. 1.1.3 Participació Cada setmana a la secció de la Llista de deures 4, es publicarà un deure que shaurà dentregar en una tasca de laula global. 1.2 Bibliografia Mètodes aplicats a Ciències polítiques AnalizaR Datos Políticos. Bookdown. 2020. Quantitative Politics with R. Bookdown. November 2019. Lab Guide to Quantitative Research Methods in Political Science, Public Policy &amp; Public Administration. Bookdown Quantitative Research Methods for Political Science, Public Policy and Public Administration: 4th Edition With Applications in R. Bookdown General R y Estadística R Markdown: The Definitive Guide. Chapman &amp; Hall/CRC; 2020. R Graphics Cookbook, OReilly Media, Inc. 2nd ed.; 2020. Data Visualization with R. 2018. R for Data Science. OReilly; 2017. (Castellano) An Introduction to Statistical Learning with applications in R. Springer; 2017. 1.3 Introducció conceptes Estadística Introducció a lassignatura. Llibres, la nostra calculadora de butxaca. Interacció entre Teoria (preguntes), Dades, Estadística (conceptes, no fórmules). Un exemple, per començar a rodar. 1.4 Gender gap, at birth Question: Is there a gender birth rate?. At birth, probability of a boy equal to the probability of a girl? What CIA says on this issue? (Wikipedia) CIA estimates that the current world wide sex ratio at birth is 107 boys to 100 girls, 107/207= 0.5169082 1.5 With Arbuthnotts data, collected on years 1629 to 1710 John Graunt was the first person to compile data that showed an excess of male births over female births. He also noticed spatial and temporal variation in the sex ratio, but the variation in his data is not significant. John Arbuthnott was the first person to demonstrate that the excess of male births is statistically significant. John Arbuthnot (1710) used these time series data on the ratios of male to female christenings in London from 1629-1710 to carry out the first known significance test, comparing observed data to a null hypothesis. Arbuthnot, J. 1710. An argument for divine providence. Philosophical Transactions 27:186-190. dat&lt;- read.table(&quot;http://84.89.132.1/~satorra/dades/arbuthnot.txt&quot;, header=TRUE) head(dat) ## year boys girls ## 1 1629 5218 4683 ## 2 1630 4858 4457 ## 3 1631 4422 4102 ## 4 1632 4994 4590 ## 5 1633 5158 4839 ## 6 1634 5035 4820 dim(dat) ## [1] 82 3 names(dat) ## [1] &quot;year&quot; &quot;boys&quot; &quot;girls&quot; attach(dat) ## The following objects are masked from dat (pos = 5): ## ## boys, girls, year ## The following objects are masked from dat (pos = 8): ## ## boys, girls, year ## The following objects are masked from dat (pos = 11): ## ## boys, girls, year ## The following objects are masked from dat (pos = 34): ## ## boys, girls, year mean(boys) ## [1] 5907.098 mean(girls) ## [1] 5534.646 mean(boys/girls) ## [1] 1.070748 total&lt;- boys+girls plot(year,total, col=&quot;blue&quot;, main=&quot;total birth along the years&quot;) mean(boys/(boys+girls)) ## [1] 0.5169751 require(stats) # for lowess, rpois, rnorm lines(year,lowess(total,f=1/6)$y, lty=3, lwd=4) boxplot(boys, girls, names=c(&quot;boys&quot;,&quot;girls&quot;), col=c(&quot;blue&quot;,&quot;magenta&quot;)) boysrate&lt;- boys/(boys+girls) plot(year, boysrate, ylim = c(.49,.53), col=&quot;blue&quot;) abline(h=0.5, col=&quot;red&quot;, lwd=3, lty=3) t&lt;- (mean(boysrate) - 0.5)/(sd(boysrate)/sqrt(length(boysrate))) t ## [1] 21.29243 t.test(boysrate, mu=0.5) ## ## One Sample t-test ## ## data: boysrate ## t = 21.292, df = 81, p-value &lt; 2.2e-16 ## alternative hypothesis: true mean is not equal to 0.5 ## 95 percent confidence interval: ## 0.5153889 0.5185614 ## sample estimates: ## mean of x ## 0.5169751 plot(year, boysrate, ylim = c(.49,.53), col=&quot;blue&quot;, main=&quot;Boysrate values with 95% confidence bound (green lines) &quot;) abline(h=0.5, col=&quot;red&quot;, lwd=3, lty=3) # Intervals abline(h=mean(boysrate), col=&quot;blue&quot;, lwd=.8) lines(year, rep(0.5153889, length(year)) , lty = &#39;dashed&#39;, col = &#39;green&#39;, lwd=3) lines(year, rep(0.5186, length(year)) , lty = &#39;dashed&#39;, col = &#39;green&#39;, lwd=3) # add fill n&lt;- length(year) polygon(c(rev(year), year), c( rev(rep(0.5153889, n )), rep(0.5186, n )), border = NA) 1.5.1 Now with recent USAs data, present day birth records in the United States source(&quot;http://www.openintro.org/stat/data/present.R&quot;) head(present) ## year boys girls ## 1 1940 1211684 1148715 ## 2 1941 1289734 1223693 ## 3 1942 1444365 1364631 ## 4 1943 1508959 1427901 ## 5 1944 1435301 1359499 ## 6 1945 1404587 1330869 dim(present) ## [1] 63 3 mean(present$boys/(present$boys+present$girls)) ## [1] 0.512516 boysrate&lt;- present$boys/(present$boys+present$girls) t.test(boysrate, mu=0.5) ## ## One Sample t-test ## ## data: boysrate ## t = 147, df = 62, p-value &lt; 2.2e-16 ## alternative hypothesis: true mean is not equal to 0.5 ## 95 percent confidence interval: ## 0.5123458 0.5126862 ## sample estimates: ## mean of x ## 0.512516 1.6 Distribució duna variable, distribució normal, altres distribucions Distribució duna variable quantitativa (variable numérica): anàlisi de variància. library(foreign) data= read.spss( &quot;http://84.89.132.1/~satorra/dades/PAISOS.SAV&quot;, use.value.labels = TRUE, to.data.frame = TRUE ) attach(data) ## The following objects are masked from data (pos = 5): ## ## AGRICULT, ALFAB, CALORIES, CONT, DIARIS, ESPVIDA, HABMETG, IDH, INDUST, ## NIVELL, PAIS, PIB, SANITAT, TV ## The following objects are masked from data (pos = 8): ## ## AGRICULT, ALFAB, CALORIES, CONT, DIARIS, ESPVIDA, HABMETG, IDH, INDUST, ## NIVELL, PAIS, PIB, SANITAT, TV ## The following objects are masked from data (pos = 11): ## ## AGRICULT, ALFAB, CALORIES, CONT, DIARIS, ESPVIDA, HABMETG, IDH, INDUST, ## NIVELL, PAIS, PIB, SANITAT, TV ## The following objects are masked from data (pos = 33): ## ## AGRICULT, ALFAB, CALORIES, CONT, DIARIS, ESPVIDA, HABMETG, IDH, INDUST, ## NIVELL, PAIS, PIB, SANITAT, TV names(data) ## [1] &quot;IDH&quot; &quot;NIVELL&quot; &quot;PAIS&quot; &quot;ESPVIDA&quot; &quot;PIB&quot; &quot;ALFAB&quot; &quot;CONT&quot; ## [8] &quot;CALORIES&quot; &quot;HABMETG&quot; &quot;DIARIS&quot; &quot;TV&quot; &quot;SANITAT&quot; &quot;AGRICULT&quot; &quot;INDUST&quot; ESPVIDA ## [1] 46.4 52.1 47.5 39.0 50.7 53.5 44.9 50.2 55.6 43.5 47.5 56.5 45.6 47.3 51.0 46.5 60.4 ## [18] 46.0 47.4 65.2 50.4 55.7 48.0 66.7 48.9 45.0 65.5 55.0 47.6 49.4 61.5 56.0 68.5 44.5 ## [35] 56.0 51.5 71.9 67.7 53.7 60.5 63.6 51.0 62.7 62.1 70.4 59.4 49.3 66.3 56.0 64.7 67.6 ## [52] 55.8 64.8 63.3 69.6 57.5 68.8 51.3 67.9 69.9 66.4 65.2 70.3 69.3 66.0 73.6 71.2 70.0 ## [69] 58.8 67.8 69.0 67.1 71.1 76.3 66.5 70.9 70.0 71.5 67.5 71.5 73.6 64.9 72.8 76.0 71.3 ## [86] 73.8 70.2 66.3 67.6 62.9 70.8 70.5 71.7 69.0 72.5 70.8 71.6 67.5 53.5 70.0 72.0 72.1 ## [103] 75.6 69.6 71.1 77.6 74.6 69.7 71.6 77.0 73.1 75.5 75.3 76.5 77.6 78.6 70.5 74.8 77.6 ## [120] 76.2 74.9 77.5 77.4 77.4 76.4 76.9 73.8 75.7 76.2 76.0 76.0 78.2 76.9 75.3 78.2 79.5 ## [137] 75.7 78.0 72.0 76.1 68.5 66.0 63.1 67.1 75.3 63.7 71.1 43.5 50.2 65.2 56.6 57.6 52.0 ## [154] 53.0 46.5 51.6 55.4 47.0 74.2 48.3 summary(ESPVIDA) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 39.00 55.67 67.60 64.50 72.58 79.50 hist(ESPVIDA, col=&quot;blue&quot;) boxplot(ESPVIDA, col=&quot;blue&quot;) 1.6.1 Valor estandarditzat duna variable # variable centrads head(ESPVIDA - mean(ESPVIDA)) ## [1] -18.10437 -12.40437 -17.00437 -25.50437 -13.80437 -11.00437 # variable estandarditzada head((ESPVIDA - mean(ESPVIDA))/sd(ESPVIDA)) ## [1] -1.715521 -1.175405 -1.611288 -2.416725 -1.308065 -1.042744 # Amb R head(scale(ESPVIDA)) ## [,1] ## [1,] -1.715521 ## [2,] -1.175405 ## [3,] -1.611288 ## [4,] -2.416725 ## [5,] -1.308065 ## [6,] -1.042744 1.6.2 Distribució Normal We now investigate the probability distribution that is most central to statistics: the normal distribution. If we are confident that our data are nearly normal, that opens the door to many powerful statistical methods. Here well describe this distribution and assess the normality of our data. Bitllet de 10 marcs: Carl Friedrich Gauss (1777 - Gotinga;1855) 1.6.2.1 Distribució de notes destudiants Veure exemple enllaç. 1.6.3 Exemple amb la variable diners en butxaca (estudiants de MQ III) Dades_enq_paper (diners en butxaca, genere): datadiners&lt;-read.table(&quot;http://84.89.132.1/~satorra/dades/ECP2019diners.txt&quot;, header=TRUE) names(datadiners) ## [1] &quot;diners&quot; &quot;genere&quot; attach(datadiners) ## The following objects are masked from datadiners (pos = 5): ## ## diners, genere ## The following objects are masked from datadiners (pos = 8): ## ## diners, genere ## The following objects are masked from datadiners (pos = 11): ## ## diners, genere ## The following objects are masked from datadiners (pos = 33): ## ## diners, genere summary(diners) ## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 0.000 1.000 7.995 16.249 21.625 100.000 boxplot(diners) hist(diners) boxplot(diners ~ genere, col=c(&quot;blue&quot;,&quot;violet&quot;)) aggregate(diners, list(genere), mean) ## Group.1 x ## 1 0 18.30667 ## 2 1 13.30833 Diners en butxaca: distribució normal? qqnorm(datadiners$diners) qqline(datadiners$diners ,col=&quot;red&quot;, lwd=3) 1.6.3.1 Log de diners en butxaca: distribució normal? qqnorm(log(datadiners$diners+ .1)) qqline(log(datadiners$diners +.1),col=&quot;red&quot;, lwd=3) 1.6.3.2 log de diners en butxaca (no zero): distribució normal? ind&lt;- datadiners$diners &gt; 0 qqnorm(log(datadiners$diners[ind])) qqline(log(datadiners$diners[ind]),col=&quot;red&quot;, lwd=3) 1.6.4 Altres distribucions univariants Distribucions univariants en R 1.6.4.1 Variables quantitatives i qualitatives Dades Enquesta Socrative d&lt;-matrix(scan(&quot;http://84.89.132.1/~satorra/dades/ECP2019enquestasocrativeG1.txt&quot;, what=&quot;character&quot;,skip=1),ncol=20,byrow=TRUE); data&lt;-d[-1,]; colnames(data)&lt;-d[1,]; table(data[,4]); ## ## av cd mai ## 12 13 7 round(100*prop.table(table(data[,4], data[,1]),2),1); ## ## 0 1 ## av 42.1 30.8 ## cd 36.8 46.2 ## mai 21.1 23.1 pie(table(data[,4]), main=&quot;fer-se el llit&quot;) ## interess assignatura aggregate(as.numeric(data[,7]), list(data[,4]), mean) ## Group.1 x ## 1 av 6.625000 ## 2 cd 5.923077 ## 3 mai 4.571429 ## tirada de dues monedes table(data[,14]) ## ## 0 1 2 3 ## 2 11 15 4 round(prop.table(table(data[,14])),2) ## ## 0 1 2 3 ## 0.06 0.34 0.47 0.12 "],["teoria-setmana-2-2020-01-20.html", "Capítol 2 Teoria Setmana 2 (2020-01-20) 2.1 Data Wrangling 2.2 Dplyr: mutate, group_by, summarise 2.3 Modelar: Regressió simple", " Capítol 2 Teoria Setmana 2 (2020-01-20) 2.1 Data Wrangling Per modelar conceptes estadístics, cal domar abans les dades (data wrangling). Aquest procés té 3 parts principals. Data Wrangling. Font: G.Glolemun y H.Wickham, 2017 2.1.1 Els data frames 2.1.1.1 Gapminder Per comprendre levolució de la riquesa i lesperança de vida de les persones a nivell de país i continent calen dades. Our mission is to fight devastating ignorance with a fact-based worldview everyone can understand.  Gapminder Hans Rosling de Gapminder feb.2006, va popularitzar Trendalyzer, en una famosa conferencia TED Talk (14,6M de visualitzacions). Trendalyzer, posteriorment adquirida por Google, permetia visualitzar fins a 5 dimensions. Actualment esta disponible en el següent enllaç. library(gapminder) library(knitr) class(gapminder) ## [1] &quot;tbl_df&quot; &quot;tbl&quot; &quot;data.frame&quot; head(gapminder) ## # A tibble: 6 x 6 ## country continent year lifeExp pop gdpPercap ## &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; ## 1 Afghanistan Asia 1952 28.8 8425333 779. ## 2 Afghanistan Asia 1957 30.3 9240934 821. ## 3 Afghanistan Asia 1962 32.0 10267083 853. ## 4 Afghanistan Asia 1967 34.0 11537966 836. ## 5 Afghanistan Asia 1972 36.1 13079460 740. ## 6 Afghanistan Asia 1977 38.4 14880372 786. dim(gapminder) ## [1] 1704 6 2.1.2 Importació de dades 2.1.2.1 Dades amb separador cat(paste0(readLines(&quot;www/data/mtcars.csv&quot;, n = 6), collapse=&quot;\\n&quot;)) ## &quot;mpg&quot;,&quot;cyl&quot;,&quot;disp&quot;,&quot;hp&quot;,&quot;drat&quot;,&quot;wt&quot;,&quot;qsec&quot;,&quot;vs&quot;,&quot;am&quot;,&quot;gear&quot;,&quot;carb&quot; ## 21,6,160,110,3.9,2.62,16.46,0,1,4,4 ## 21,6,160,110,3.9,2.875,17.02,0,1,4,4 ## 22.8,4,108,93,3.85,2.32,18.61,1,1,4,1 ## 21.4,6,258,110,3.08,3.215,19.44,1,0,3,1 ## 18.7,8,360,175,3.15,3.44,17.02,0,0,3,2 mtcars &lt;- read.table(&quot;www/data/mtcars.csv&quot;, dec=&quot;.&quot;,sep=&quot;,&quot;, header=TRUE) Los parámetros especificados son: dec: El separador decimal. En Europa se acostumbra a utilizar la coma , sep: El separador de columnas. Es habitual usar también ; y  cuando es un tabulador. header: Indica si la primera fila contiene el nombre de las variables o no. En el caso de mtcars (separador por comas) es más simple usar read.csv. mtcars &lt;- read.csv(&quot;www/data/mtcars.csv&quot;) dim(mtcars) ## [1] 32 11 Cuando el csv es europeo, , decimal y ; como separador, se utiliza read.csv2(). kable(head(mtcars)) mpg cyl disp hp drat wt qsec vs am gear carb 21.0 6 160 110 3.90 2.620 16.46 0 1 4 4 21.0 6 160 110 3.90 2.875 17.02 0 1 4 4 22.8 4 108 93 3.85 2.320 18.61 1 1 4 1 21.4 6 258 110 3.08 3.215 19.44 1 0 3 1 18.7 8 360 175 3.15 3.440 17.02 0 0 3 2 18.1 6 225 105 2.76 3.460 20.22 1 0 3 1 2.1.2.2 Texto con ancho fijo cat(paste0(readLines(&quot;www/data/fwf-sample.txt&quot;, n = 6), collapse=&quot;\\n&quot;)) ## John Smith WA 418-Y11-4111 ## Mary Hartford CA 319-Z19-4341 ## Evan Nolan IL 219-532-c301 Para leer texto de ancho fijo, se utiliza read.fwf(). fwf_sample &lt;- read.fwf(&quot;www/data/fwf-sample.txt&quot;, widths=c(20,10,12) , col.names=c(&quot;name&quot;, &quot;state&quot;, &quot;ssn&quot;)) widths: Son los anchos de cada variable. col.names: Nombres de las variables. 2.1.2.3 Leer Excel library(readxl) dataXlsx &lt;- read_excel(&quot;www/data/data.xlsx&quot;) dim(dataXlsx) ## [1] 19 6 2.1.2.4 Leer SPSS library(foreign) dataSAV &lt;- read.spss(&quot;http://psych.colorado.edu/~carey/Courses/PSYC7291/DataSets/SPSS/crime.sav&quot;, to.data.frame =TRUE, use.value.labels = TRUE) dim(dataSAV) ## [1] 50 8 2.1.2.5 Leer RData Leer objetos de R. load(&quot;www/data/rStateDataSold.RData&quot;) dim(rStateDataSold) ## [1] 192 8 2.1.2.6 Guardar RData Guardar varios objetos de R. save(dataXlsx, dataSAV, rStateDataSold, file=&quot;www/temp/EjemploSave2.RData&quot;) 2.1.3 Dades ordenades Datos ordenados es un conjunto de datos que ha sido estructurado de forma que cada variable es una columna y cada observación (o caso) es una fila. - H. Wickham 2013. Journal of Statistical Software Para resaltar la importancia de esta etapa, G.Glolemun y H.Wickham, 2017 utilizan las siguiente cita y su posterior adaptación. Todas las familias felices se parecen unas a otras, pero cada familia infeliz lo es a su manera.  León Tolstoy Todos los set de datos ordenados se parecen unos a otros, pero cada set de datos desordenado lo es a su manera  Hadley Wickham En la misma referencia, se explica tres reglas que hacen que un conjunto de datos sea ordenado: Cada variable debe tener su propia columna. Cada observación debe tener su propia fila. Cada valor debe tener su propia celda. También se utiliza la siguiente figura para visualizar mejor estas reglas. Imagen: Reglas que hacen que un conjunto de datos sea ordenado: las variables están en columnas, las observaciones en filas y los valores en celdas. (Fuente: G.Glolemun y H.Wickham, 2017 Com puedes ver, la definición de tidy data, equipara las columnas de la tabla con el concepto de Variable, así como las filas a observaciones, hecho que simplifica enormemente las posteriores fases de analisis de la información. 2.1.4 Transformació El universo de Tydiverse consiste en una colección de packages de R orientados al Data Science. Se recomienda la consulta del libro online R para Ciencia de Datos. El package dplyr, al igual que ggplot2, está desarrollado por Hadley Wickham. Este paquete, supone un cambio de filosofía en la forma de trabajar con los datos y se está transformando en un nuevo estándar en R. 2.1.4.1 Dplyr: arrange, filter, select arange: Ordena los registros de un data frame. filter: Filtra a partir de un conjunto condiciones lógicas. select: Selecciona las variables. Países asiáticos con PIB per cápita inferior a 1000 $ en 2007. suppressPackageStartupMessages(library(tidyverse)) pais07Sel &lt;- gapminder %&gt;% arrange(desc(lifeExp)) %&gt;% filter(continent==&#39;Asia&#39; &amp; gdpPercap &lt; 1000 &amp; year ==2007 ) %&gt;% dplyr::select(country,lifeExp,gdpPercap) kable(pais07Sel) country lifeExp gdpPercap Myanmar 62.069 944.0000 Afghanistan 43.828 974.5803 Observa que no necesitan de comillas para referirse a las variables. También utilizan el operador %&gt;% llamado pipe. Éste sustituye el parámetro de entrada de datos. De esta forma, permite escribir las operaciones de izquierda a derecha facilitando así su lectura. 2.2 Dplyr: mutate, group_by, summarise mutate: Crea o modifica las variables del data frame. group_by: Especifica una o varias variables de agrupación. summarise: define los agregados de las variables originales. Esperanza de vida y PIB per cápita medio por continente y año. continent_year &lt;- gapminder %&gt;% arrange(continent,year) %&gt;% mutate(lifeExp_total = lifeExp * pop , gdp_total = gdpPercap * pop) %&gt;% group_by(continent,year) %&gt;% dplyr::summarize(n_countries=n() , lifeExp = sum(lifeExp_total ) / sum(pop ) , gdp_capita = sum(gdp_total) / sum(pop) , pop = sum(pop)) kable(continent_year %&gt;% head(10)) continent year n_countries lifeExp gdp_capita pop Africa 1952 52 38.79973 1311.221 237640501 Africa 1957 52 40.94031 1444.952 264837738 Africa 1962 52 43.09925 1540.599 296516865 Africa 1967 52 45.17721 1774.847 335289489 Africa 1972 52 47.21229 2063.171 379879541 Africa 1977 52 49.20883 2244.799 433061021 Africa 1982 52 51.01744 2295.192 499348587 Africa 1987 52 52.82479 2180.764 574834110 Africa 1992 52 53.37292 2071.615 659081517 Africa 1997 52 53.28327 2098.865 743832984 Para la evolución de los continentes en ggplot2, es útil el geom_path() library(ggrepel) ggplot(continent_year, aes(x=gdp_capita , y=lifeExp , color =continent)) + geom_path() + scale_x_log10() + geom_text_repel(aes(label=year), size=2, color=&quot;black&quot;) + labs(title=&quot;Evolución continentes (ponderado)&quot;) Figura 2.1: Evolución de los continentes El gráfico muestra la traza que han recorrido los continentes en sus valores medios de PIB per cápita y Esperanza de vida. Se confirma la mayor progresión de Asia. Vemos que, como América y Europa, en media tienen un comportamiento bastante paralelo. Se observa como el recorrido de África, aunque partiendo de valores muy inferiores, ha sido positiva y ha incrementado de forma similar el resto de continentes. 2.2.1 Visualización Un simple gráfico ha brindado más información a la mente del analista de datos que cualquier otro dispositivo. - John Tukey 2.2.1.1 Estructura básica ggplot2 es un sistema coherente para hacer gráficos. suppressPackageStartupMessages(library(HistData)) ggplot(data= Galton, mapping = aes(x=parent, y= child)) + geom_point() Figura 2.2: Altura padres e hijos (Galton, 1885) La altura de los padres es la media entre la altura del padre y 1.08 veces la de la madre. En los datos hay 205 padres diferentes y 928 hijos. Los datos fueron tabulados y por lo tanto discretizado. Para visualizar los datos resulta útil introducir aleatoriedad con jitter. ggplot(data= Galton, mapping = aes(x=parent, y= child)) + geom_jitter() Figura 2.3: Jitter altura padres e hijos (Galton, 1885) Los componentes mínimos son: ggplot define el conjunto de datos en el parámetro data que debería contener todas las variables del gráfico. geom_&lt;función&gt;: Define el tipo de gráfico. Por ejemplo, geom_point es un gráfico de puntos. mapping: define mapeo de parámetros estéticos (x, y) a través de la función aes(). A diferencia de plot, ggplot permite asignar el gráfico a un objeto R. p1 &lt;- ggplot(Galton, aes(x=parent, y= child)) + geom_jitter() Posteriormente, puedes añadirle otros elementos gráficos. p1 &lt;- p1 + geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;)) + geom_abline(aes(intercept = 0, slope = 1, color = &quot;Diagonal y = x&quot;)) + labs(title = &quot;Relación altura padres e hijos (Galton, 1885)&quot; ,x = &quot;Media altura padres (pulgadas)&quot;, y = &quot;Altura hijos (pulgadas)&quot;) p1 Figura 2.4: Regresión Simple y recta diagonal altura padres e hijos (Galton, 1885) Si defines el mapeo de estéticos en ggplot ya no es necesario definirlos en los geoms. 2.2.1.2 Otros geoms Otros ejemplos de geoms con los datos de gapminder en 2007. library(ggrepel) suppressPackageStartupMessages(library(cowplot)) paises07 &lt;- as.data.frame(gapminder %&gt;% filter(year==2007)) # paises en 2007 p1 &lt;- ggplot(paises07, aes(x=lifeExp)) + geom_histogram() p2 &lt;- ggplot(paises07, aes(x=continent, fill=continent)) + geom_bar() p3 &lt;- ggplot(paises07, aes(y=lifeExp, fill=continent)) + geom_boxplot() p4 &lt;- ggplot(paises07 %&gt;% arrange(desc(lifeExp)) %&gt;% head(25), aes(x=gdpPercap, y=lifeExp)) + geom_point() + geom_label_repel(aes(label=country), size=3) # arrange two plots into one column plot_grid(p1, p2, p3, p4, labels = c(&quot;histograma&quot;,&quot;barras&quot;,&quot;boxplot&quot;,&quot;Etiquetas&quot;), ncol = 2) 2.2.1.3 Panel de datos facet_wrap() library(datos) p00 &lt;- ggplot(paises , aes(x=pib_per_capita , y=esperanza_de_vida , color=continente , size=poblacion , label=pais))+ geom_point() + scale_x_log10() + facet_wrap(~anio)+ labs(title=&quot;Paises en 2007&quot;) p00 Figura 2.5: Más facet_wrap() y facet_grid() 2.2.1.4 Etiquetas geom_label() paises07 &lt;- paises %&gt;% filter(anio == 2007) p07 &lt;- ggplot(paises07 , aes(x=pib_per_capita , y=esperanza_de_vida , color=continente , size=poblacion))+ geom_point() + scale_x_log10() + labs(title=&quot;Paises en 2007&quot;)+ geom_label(data=paises07 %&gt;% filter(pais==&quot;China&quot;) , nudge_y=2 , aes(label=pais) , size=4 , color=&quot;black&quot;) p07 Figura 2.6: Más geom_label() 2.2.1.5 Paleta colores scale_colour_brewer() p07 &lt;- p07 + scale_colour_brewer( palette = &quot;Dark2&quot;) p07 Figura 2.7: Más paletas COLORBREWER 2.2.1.6 Zoom coord_cartesian() p07 &lt;- p07 + coord_cartesian( xlim=c(300,5000) , ylim=c(38,45)) p07 Figura 2.8: Más coord_cartesian() 2.2.1.7 Temas theme_bw() p07 &lt;- p07 + theme_bw() p07 Figura 2.9: Más en ggtheme 2.2.1.8 Gráficos interactivos ggplotly() suppressPackageStartupMessages(library(plotly)) ggplotly(p00) Figura 2.10: Más R Plotly Mueve el ratón por encima del gráfico para identificar los países. Des de la leyenda puedes filtrar los continentes que se quieren mostrar. 2.3 Modelar: Regressió simple Origen del concepte de regressió aplicat. p1 &lt;- ggplot(data= Galton, mapping = aes(x=parent, y= child)) + geom_jitter()+ geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;)) + geom_abline(aes(intercept = 0, slope = 1, color = &quot;Diagonal y = x&quot;)) + labs(title = &quot;Relación altura padres e hijos (Galton, 1885)&quot; ,x = &quot;Media altura padres (pulgadas)&quot;, y = &quot;Altura hijos (pulgadas)&quot;) p1 Figura 2.11: Regresión Simple y recta diagonal altura padres e hijos (Galton, 1885) 2.3.0.1 Ingressos i Despeses Es una relació molt comú a la natura. data= read.table(&quot;http://84.89.132.1/~satorra/dades/M2013RegressioSamp.txt&quot;, header =T) names(data) ## [1] &quot;Lrenda&quot; &quot;Ldespeses&quot; &quot;Genere&quot; &quot;Vot&quot; head(data,4) ## Lrenda Ldespeses Genere Vot ## 1 9.477 4.503 1 1 ## 2 11.435 6.147 1 0 ## 3 10.686 4.961 0 0 ## 4 10.407 3.993 0 0 p1 &lt;- ggplot(data= data, mapping = aes(x=scale(Lrenda), y= scale(Ldespeses))) + geom_point() + geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;)) + geom_abline(aes(intercept = 0, slope = 1, color = &quot;Diagonal y = x&quot;)) + labs(title = &quot;Relació Ingresos i Despeses&quot; ,x = &quot;Log Ingresos Estandarditzat&quot;, y = &quot;Log Despeses Estandarditzat&quot;) p1 Figura 2.12: Regresión Simple y recta diagonal Ingressos y Despeses cor(data$Lrenda,data$Ldespeses) ## [1] 0.4385204 2.3.0.2 PAISOS.SAV Alerta! Correlació no indica sempre causalitat. Poden existir altres factors ocults amb un efecte sobre ambdós factors. library(foreign) data &lt;- read.spss( &quot;http://84.89.132.1/~satorra/dades/PAISOS.SAV&quot;, use.value.labels = TRUE, to.data.frame = TRUE ) names(data) ## [1] &quot;IDH&quot; &quot;NIVELL&quot; &quot;PAIS&quot; &quot;ESPVIDA&quot; &quot;PIB&quot; &quot;ALFAB&quot; &quot;CONT&quot; ## [8] &quot;CALORIES&quot; &quot;HABMETG&quot; &quot;DIARIS&quot; &quot;TV&quot; &quot;SANITAT&quot; &quot;AGRICULT&quot; &quot;INDUST&quot; dim(data) ## [1] 160 14 data &lt;- data %&gt;% select(PAIS, ESPVIDA, CALORIES, PIB, HABMETG , ALFAB) data %&gt;% summary() ## PAIS ESPVIDA CALORIES PIB HABMETG ## Length:160 Min. :39.00 Min. :1505 Min. : 70.0 Min. : 211.0 ## Class :character 1st Qu.:55.67 1st Qu.:2248 1st Qu.: 532.5 1st Qu.: 642.2 ## Mode :character Median :67.60 Median :2614 Median : 1715.0 Median : 2000.0 ## Mean :64.50 Mean :2661 Mean : 5778.5 Mean : 6709.6 ## 3rd Qu.:72.58 3rd Qu.:3166 3rd Qu.: 6337.5 3rd Qu.: 8901.5 ## Max. :79.50 Max. :3947 Max. :36730.0 Max. :50000.0 ## NA&#39;s :8 NA&#39;s :22 NA&#39;s :18 ## ALFAB ## Min. :12.40 ## 1st Qu.:54.50 ## Median :81.30 ## Mean :73.39 ## 3rd Qu.:94.35 ## Max. :99.00 ## Observem que dels 160 països, alguns tenen valors faltants en alguna de les variables. En següents sessions es parlará sobre altres enfocs posibles. De moment, un primer tractament és consisteix en filtrar els països amb valors faltants. data &lt;- na.omit(data) rownames(data)&lt;-NULL # reiniciem la numeracio de les files dim(data) ## [1] 120 6 p1 &lt;- ggplot(data= data, mapping = aes(x=scale(CALORIES), y= scale(ESPVIDA))) + geom_point() + geom_smooth(method=&#39;lm&#39;, se=FALSE, formula = y~x, aes(color = &quot;lm&quot;)) + labs(title = &quot;Relació Calories i Esperança de vida&quot; ,x = &quot;Calories por habitant&quot;, y = &quot;ESperança de vida (anys)&quot;) p1 Figura 2.13: Regresión Simple y recta diagonal Calories i Esperança de vida 2.3.1 Regressió simple reg1&lt;- lm(ESPVIDA ~ CALORIES, data=data) summary(reg1) ## ## Call: ## lm(formula = ESPVIDA ~ CALORIES, data = data) ## ## Residuals: ## Min 1Q Median 3Q Max ## -19.0797 -5.0123 0.0774 5.4410 14.6255 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 27.060569 3.135144 8.631 3.35e-14 *** ## CALORIES 0.013896 0.001136 12.232 &lt; 2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 7.107 on 118 degrees of freedom ## Multiple R-squared: 0.5591, Adjusted R-squared: 0.5553 ## F-statistic: 149.6 on 1 and 118 DF, p-value: &lt; 2.2e-16 Estandarditzem les variables i comparem models amb stargazer. reg1s &lt;- lm(scale(ESPVIDA) ~ scale(CALORIES), data=data) # install.packages(&quot;stargazer&quot;) library(stargazer) stargazer(reg1, reg1s, type=&#39;text&#39;) ## ## =========================================================== ## Dependent variable: ## ---------------------------- ## ESPVIDA scale(ESPVIDA) ## (1) (2) ## ----------------------------------------------------------- ## CALORIES 0.014*** ## (0.001) ## ## scale(CALORIES) 0.748*** ## (0.061) ## ## Constant 27.061*** -0.000 ## (3.135) (0.061) ## ## ----------------------------------------------------------- ## Observations 120 120 ## R2 0.559 0.559 ## Adjusted R2 0.555 0.555 ## Residual Std. Error (df = 118) 7.107 0.667 ## F Statistic (df = 1; 118) 149.611*** 149.611*** ## =========================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 Observa que \\(0.748^2=0.559\\) . 2.3.1.1 Residus versus predicció plot(reg1,1) data$PAIS[c(34,32,9)] ## [1] &quot;Mauritania &quot; &quot;Guinea &quot; &quot;Guinea Bissau &quot; reg2=lm(ESPVIDA ~ CALORIES + ALFAB, data=data ) anova(reg1,reg2) ## Analysis of Variance Table ## ## Model 1: ESPVIDA ~ CALORIES ## Model 2: ESPVIDA ~ CALORIES + ALFAB ## Res.Df RSS Df Sum of Sq F Pr(&gt;F) ## 1 118 5959.5 ## 2 117 2852.7 1 3106.8 127.42 &lt; 2.2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 stargazer(reg1,reg2, type=&#39;text&#39;) ## ## ===================================================================== ## Dependent variable: ## ------------------------------------------------- ## ESPVIDA ## (1) (2) ## --------------------------------------------------------------------- ## CALORIES 0.014*** 0.007*** ## (0.001) (0.001) ## ## ALFAB 0.278*** ## (0.025) ## ## Constant 27.061*** 25.403*** ## (3.135) (2.183) ## ## --------------------------------------------------------------------- ## Observations 120 120 ## R2 0.559 0.789 ## Adjusted R2 0.555 0.785 ## Residual Std. Error 7.107 (df = 118) 4.938 (df = 117) ## F Statistic 149.611*** (df = 1; 118) 218.659*** (df = 2; 117) ## ===================================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 plot(reg2,1) data$PAIS[c(6,9,105)] ## [1] &quot;Uganda &quot; &quot;Guinea Bissau &quot; &quot;Kuwait &quot; plot(data %&gt;% select(ESPVIDA, CALORIES, PIB, HABMETG, ALFAB)) corr_select &lt;- data %&gt;% select(ESPVIDA, CALORIES, PIB, HABMETG, ALFAB) %&gt;% cor(use=&quot;pairwise.complete.obs&quot;) %&gt;% round(3) kable(corr_select) ESPVIDA CALORIES PIB HABMETG ALFAB ESPVIDA 1.000 0.748 0.629 -0.739 0.839 CALORIES 0.748 1.000 0.616 -0.605 0.619 PIB 0.629 0.616 1.000 -0.378 0.524 HABMETG -0.739 -0.605 -0.378 1.000 -0.648 ALFAB 0.839 0.619 0.524 -0.648 1.000 library(ggcorrplot) corr_select %&gt;% ggcorrplot(type = &quot;lower&quot;, lab = TRUE, show.legend = F) # Transformation of variables (linearizing regression) data &lt;- data %&gt;% mutate( LPIB = log(PIB) ,Lhabmetges = log(HABMETG) ) plot(data %&gt;% select(ESPVIDA, CALORIES, LPIB, Lhabmetges, ALFAB)) corr_log_select &lt;- data %&gt;% select(ESPVIDA, CALORIES, PIB, LPIB, HABMETG, Lhabmetges, ALFAB) %&gt;% cor(use=&quot;pairwise.complete.obs&quot;) %&gt;% round(3) corr_log_select %&gt;% ggcorrplot(type = &quot;lower&quot;, lab = TRUE, show.legend = F) reg3 &lt;- lm(ESPVIDA ~ CALORIES + LPIB + Lhabmetges +ALFAB, data=data) stargazer(reg1, reg2, reg3, type=&#39;text&#39;) ## ## ============================================================================================== ## Dependent variable: ## -------------------------------------------------------------------------- ## ESPVIDA ## (1) (2) (3) ## ---------------------------------------------------------------------------------------------- ## CALORIES 0.014*** 0.007*** 0.001 ## (0.001) (0.001) (0.001) ## ## LPIB 1.821*** ## (0.452) ## ## Lhabmetges -2.388*** ## (0.523) ## ## ALFAB 0.278*** 0.165*** ## (0.025) (0.026) ## ## Constant 27.061*** 25.403*** 55.475*** ## (3.135) (2.183) (7.637) ## ## ---------------------------------------------------------------------------------------------- ## Observations 120 120 120 ## R2 0.559 0.789 0.857 ## Adjusted R2 0.555 0.785 0.852 ## Residual Std. Error 7.107 (df = 118) 4.938 (df = 117) 4.098 (df = 115) ## F Statistic 149.611*** (df = 1; 118) 218.659*** (df = 2; 117) 172.404*** (df = 4; 115) ## ============================================================================================== ## Note: *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01 2.3.2 Regressió lineal simple \\[ Y = \\beta_0 + \\beta_1x + \\epsilon \\] La \\(\\beta_0\\) terme independent La \\(\\beta_1\\) coeficient de regressió La esperança, \\(E(Y)=\\beta_0+\\beta_1E(x)\\) El coeficient, \\(\\beta_1\\) és un increment en el valor esperat de \\(Y\\) dun augmenta unitari en la variable X El \\(\\epsilon\\) és un terme de pertorbació, variable estadística \\(\\epsilonN(0,\\sigma^2)\\), valor esperat zero i variància constant. Noteu que la variància de \\(\\epsilon\\) representa la intensitat de variació de Y al voltant de la recta de regressió \\(Y=\\beta_0+\\beta_1x\\). Ajust de la regressió: \\[ Y = b_0 + b_1x + \\epsilon \\] \\(b_0=27.061\\), \\(b_1=0.014\\), \\(b_0\\) i \\(b_1\\) són estimacions de \\(\\beta_0\\) i \\(\\beta_1\\) respectivament. Totes les estimacions estan subjectes a un error tipus (standard error). En el nostre exemple: lerror tipus de lestimació ´de \\(beta_1=0.014\\) és \\(0.001\\). Coeficient de determinació múltiple, \\(R^2=0.559\\) és a dir, \\(55.9%\\) de la variació de \\(Y\\) és deguda a la variable X. 2.3.3 Regressió lineal múltiple \\[ Y = \\beta_0 + \\beta_1x_1 + \\beta_2x_2 + \\epsilon \\] El \\(\\beta_0\\) terme independent La \\(\\beta_1\\), \\(\\beta_2\\) coeficients de regressió parcial La Esperança: \\(E(Y)=\\beta_0+\\beta_1E(x_1)+\\beta_2E(x_2)\\) \\(\\beta_2\\) és un increment en el valor esperat de \\(Y\\) dun augment unitari en la variable \\(X_2\\) quan \\(X_1\\) es manté constant. Idem per \\(\\beta_1\\) (versus \\(X_2\\)) \\(\\epsilon\\) terme de perturbació, variable estadística \\(\\epsilonN(0,\\sigma^2)\\), valor esperat zero i variància constant. Noteu que la variància de \\(\\epsilon\\) representa la intensitat de variació de Y al voltant de la recta de regressió \\(Y=\\beta_0+\\beta_1x_1+\\beta_2x_2\\). Regressió estimada: \\[ Y = b_0 + b_1x_1 + b_2x_2 \\] Els coeficients: \\(b_0=25.403\\); \\(b_1=0.007\\); \\(b_2=0.278\\) El \\(R^2=0.044\\) és un \\(4.4%\\) de variació de \\(Y\\) ve explicada per la variació conjunta de \\(X_1\\) i \\(X_2\\). "],["seminaris-setmana-1-2020-01-13.html", "Capítol 3 Seminaris Setmana 1 (2020-01-13) 3.1 Programació amb R 3.2 Comentari Deure 1.", " Capítol 3 Seminaris Setmana 1 (2020-01-13) 3.1 Programació amb R Introducció a la Programació amb R per al Mètodes Estadístics Aplicats en Ciències Polítiques. Dades pels projectes. 3.2 Comentari Deure 1. Veure aparatat deures: 4. "],["homework.html", "Capítol 4 Llista de Deures 4.1 Deure 1 4.2 Deure 2", " Capítol 4 Llista de Deures 4.1 Deure 1 NOTA: Descarrega la plantilla de solució deure 1 en Rmd. En el link https://griu.github.io/meacp_2021/data/dataXY.dat hi han les dues variables ESPVIDA i CALORIES del fitxer PAISOS.SAV (són lesperança de vida y les calories per habitant en diferents paisos del mon). Feu: Utiliza el program (Excel, SPSS o R) que coneguis. La lectura de les dades amb R seria dataXY&lt;-read.table(&#39;https://raw.githubusercontent.com/griu/griu.github.io/main/meacp_2021/data/dataXY.dat&#39;, header=TRUE, dec=&quot;,&quot;, sep=&quot;;&quot;) Una descripció breu univariant de cada una de les variables; summary(dataXY) ## CALORIES ESPVIDA ## Min. :1505 Min. :39.00 ## 1st Qu.:2248 1st Qu.:55.77 ## Median :2614 Median :67.55 ## Mean :2661 Mean :64.57 ## 3rd Qu.:3166 3rd Qu.:72.88 ## Max. :3947 Max. :79.50 Un diagrama de dispersió de ESPVIDA vs CALORIES. Comenta si sobserva o no associació entre aquests dues variables. library(ggplot2) ggplot(dataXY, aes(x=CALORIES, y=ESPVIDA)) + geom_point() Comenta si la associació observada justifica o no parlar de causalitat. 4.2 Deure 2 Considera les dades a PAISOS.SAV, lectura de dades en R: library(foreign) data &lt;- read.spss(&quot;https://griu.github.io/meacp_2021/data/PAISOS.SAV&quot;, use.value.labels = TRUE, to.data.frame = TRUE, use.missings =TRUE) Quins són els països que tenen menys de 47 anys desperança de vida? Quants països tenen menys dun terç de la seva població alfabetitzada? I daquests, quants tenen un PIB per càpita superior a 1.000 dòlars? Quina és la mitjana del nombre de diaris que es llegeixen al món? Hi ha diferències en la lectura de diaris segons nivell de desenvolupament humà? Creus que a Espanya sen llegeixen pocs? perquè? Quina és la mitjana dhabitants per metge? Quin és el valor daquesta mitjana en cada un dels tres nivells de desenvolupament humà en què shan classificat els països? Hi ha diferències significatives entre elles? En relació al fitxer de dades PAISOS.SAV, tria una variable Y del teu interès i descriu la variació de la mateixa emprant un altre variable del fitxer de dades. En aquest procés, ajusta un model de regressió lineal simple entre la variable depenent i la variable explicativa, descriu els resultats de la regressió lineal simple, i comprova que la hipòtesi de linealitat es plausible en aquestes dades. Si veus que la linealitat no es plausible, efectua la corresponent transformació prèvia de les variables. Recull els residus, I fes un gràfic dels residus vs. la variable depenent ajustada. Fes un breu resum de les conclusions que creus que es desprenen de la teva anàlisi. Explica també les limitacions de lanàlisi. "]]
